import{a7 as rf,M as cf,be as Q1,F as e1,a as K,k as Xf,E as pe,aC as ge,aL as ye,ak as c1,aB as Ee,c3 as r0,c4 as ve,af as F1,ao as N1,m as R1,au as Sf,A as o0,aq as D1,av as we,b as Kf,c5 as c0,p as l0,I as h0,aU as u0,ag as t1,h as d1,c6 as ke,_ as Ce,c7 as Le,c8 as $1,c9 as Ae,a6 as m0,a3 as J1,bl as b0,bP as p0,ax as l1,ca as g0,az as y0,a4 as E0,j as Qf,cb as v0,cc as w0,c as Se,a8 as k0,o as C0,cd as X1,aD as L0,aQ as xe,w as Te,ay as A0,G as Pe,ce as S0,bg as Ie,i as h1,cf as x0,cg as K1,d as T0,z as P0,N as I0}from"./index-XZA1-3MU.js";import{i as u1,u as F0,g as Fe,a as N0,f as m1,C as R0,w as kf,s as Ne}from"./page-eb81Un_i.js";import{I as b1,s as gf}from"./button-aS2SE0kp.js";function D0(d,f){for(let e=d.length,t=e-1;t>=0;--t)f(d[t],t,d)}function M1(d){try{const f=d.play();f instanceof Promise&&f.catch(rf)}catch(f){console.error(f)}}class M0{constructor(){this.observer=new IntersectionObserver(f=>{for(const e of f){const t=e.target;for(const s in this.byGroups){if(this.intersectionLockedGroups[s])continue;const i=this.byGroups[s].find(a=>a.el===t);if(i){if(e.isIntersecting)this.visible.add(i),this.checkAnimation(i,!1);else{this.visible.delete(i),this.checkAnimation(i,!0);const a=i.animation;i.type==="lottie"&&a.clearCache()}break}}}}),this.visible=new Set,this.overrideIdleGroups=new Set,this.byGroups={},this.byPlayer=new Map,this.lockedGroups={},this.onlyOnePlayableGroup="",this.intersectionLockedGroups={},this.videosLocked=!1,Q1.addEventListener("change",f=>{this.checkAnimations2(f)})}toggleMediaPause(f){f?this.videosLocked&&(this.videosLocked=!1,this.checkAnimations2()):(this.videosLocked=!0,this.checkAnimations2())}setOverrideIdleGroup(f,e){e?this.overrideIdleGroups.add(f):this.overrideIdleGroups.delete(f)}getAnimations(f){const e=[];for(const t in this.byGroups)for(const s of this.byGroups[t])s.el===f&&e.push(s);return e}removeAnimation(f){const{el:e,animation:t}=f;!f.controlled&&f.type!=="video"&&t.remove();const s=this.byGroups[f.group];s&&(e1(s,f),s.length||delete this.byGroups[f.group]),this.observer.unobserve(e),this.visible.delete(f),this.byPlayer.delete(t)}removeAnimationByPlayer(f){const e=this.byPlayer.get(f);e&&this.removeAnimation(e)}addAnimation(f){var c;const{animation:e,group:t="",observeElement:s,controlled:i,liteModeKey:a,type:n}=f;if(t==="none"||this.byPlayer.has(e))return;const o={el:s,animation:e,group:t,controlled:i,liteModeKey:a,type:n};i&&typeof i!="boolean"&&i.onClean(()=>{this.removeAnimationByPlayer(e)}),o.type==="lottie"&&!K.settings.stickers.loop&&e.loop&&(e.loop=K.settings.stickers.loop),((c=this.byGroups)[t]??(c[t]=[])).push(o),this.observer.observe(o.el),this.byPlayer.set(e,o)}checkAnimations(f,e,t,s){if(e!==void 0&&!this.byGroups[e])return;const i=e!==void 0?[e]:Object.keys(this.byGroups);for(const a of i){if(s&&this.intersectionLockedGroups[a])continue;const n=this.byGroups[a];D0(n,o=>{this.checkAnimation(o,f,t)})}}checkAnimations2(f){this.checkAnimations(f,void 0,void 0,!0)}checkAnimation(f,e,t){const{el:s,animation:i,group:a}=f;if(t||!this.lockedGroups[a]&&!u1(s)){(!f.controlled||t)&&this.removeAnimation(f);return}e||this.onlyOnePlayableGroup&&this.onlyOnePlayableGroup!==a||f.type==="video"&&this.videosLocked?i.paused||i.pause():i.paused&&this.visible.has(f)&&i.autoplay&&(!this.onlyOnePlayableGroup||this.onlyOnePlayableGroup===a)&&(!Q1.isIdle||this.overrideIdleGroups.has(f.group))&&M1(i)}getOnlyOnePlayableGroup(){return this.onlyOnePlayableGroup}setOnlyOnePlayableGroup(f=""){this.onlyOnePlayableGroup=f}lockGroup(f){this.lockedGroups[f]=!0}unlockGroup(f){delete this.lockedGroups[f],this.checkAnimations(void 0,f)}refreshGroup(f){const e=this.byGroups[f];e?.length&&(e.forEach(t=>{this.observer.unobserve(t.el)}),Xf(()=>{e.forEach(t=>{this.observer.observe(t.el)})}))}lockIntersectionGroup(f){this.intersectionLockedGroups[f]=!0}unlockIntersectionGroup(f){delete this.intersectionLockedGroups[f],this.refreshGroup(f)}toggleIntersectionGroup(f,e){e?this.lockIntersectionGroup(f):this.unlockIntersectionGroup(f)}setAutoplay(f,e){let t=!1;return this.byPlayer.forEach((s,i)=>{s.liteModeKey===e&&(t=!0,i.autoplay=f?i._autoplay:!1,i.loop=f?K.settings.stickers.loop&&i._loop:!1)}),t}setLoop(f){let e=!1;return this.byPlayer.forEach((t,s)=>{s._loop&&s.loop!==f&&(t.type==="lottie"||t.type==="video")&&(e=!0,s.loop=f,s.autoplay=s._autoplay)}),e}}const sf=new M0;cf&&(cf.animationIntersector=sf);const Y1=typeof ImageBitmap<"u";class s1{constructor(){this.cache=new Map}static createCache(){const f={frames:new Map,framesNew:new Map,framesURLs:new Map,clearCache:()=>{f.framesNew.forEach(e=>{e.close?.()}),f.frames.clear(),f.framesNew.clear(),f.framesURLs.clear()},counter:0};return f}getCache(f){let e=this.cache.get(f);return e||this.cache.set(f,e=s1.createCache()),++e.counter,e}releaseCache(f){const e=this.cache.get(f);e&&!--e.counter&&this.cache.delete(f)}getCacheCounter(f){return this.cache.get(f)?.counter}generateName(f,e,t,s,i){return[f,e,t,i||""].filter(Boolean).join("-")}}const _1=new s1;function Re(d,f,e){let t=N1(window.devicePixelRatio,1,2);return t>1&&!e&&(d>90&&f>90?!c1&&R1.isMobile&&(t=1):(d>60&&f>60||ge)&&(t=Math.max(1.5,t-1.5))),t}function O1(d,f,e,t,s,i){d.globalCompositeOperation="source-atop",d.fillStyle=typeof f=="string"?f:`rgb(${f[0]}, ${f[1]}, ${f[2]})`,d.fillRect(e,t,s,i),d.globalCompositeOperation="source-over"}const df=class df extends pe{constructor({el:f,worker:e,options:t}){super(!0),this.reqId=0,this.width=0,this.height=0,this.paused=!0,this.direction=1,this.speed=1,this.autoplay=!0,this.loop=!0,this.group="",this.cachingDelta=0,this.playedTimes=0,this.reqId=++df.reqId,this.el=f,this.worker=e;for(const a in t)this.hasOwnProperty(a)&&(this[a]=t[a]);this._loop=this.loop,this._autoplay=this.autoplay,this.initFrame=t.initFrame,this.color=t.color,this.textColor=t.textColor,this.name=t.name,this.skipFirstFrameRendering=t.skipFirstFrameRendering,this.toneIndex=t.toneIndex,this.raw=!1,this.liteModeKey=t.liteModeKey,this.name&&(this.cacheName=df.CACHE.generateName(this.name,this.width,this.height,this.color,this.toneIndex));let s;t.skipRatio!==void 0?s=t.skipRatio:(ge||ye||c1&&!Ee&&!r0)&&this.width<100&&this.height<100&&!t.needUpscale&&(s=.5),this.skipDelta=s!==void 0?1/s|0:1;const i=Re(this.width,this.height,t.needUpscale);this.width=Math.round(this.width*i),this.height=Math.round(this.height*i),t.noCache||(c1&&this.width>100&&this.height>100?this.cachingDelta=2:this.width<100&&this.height<100?this.cachingDelta=1/0:this.cachingDelta=4),this.canvas||(this.canvas=this.el.map(()=>{const a=document.createElement("canvas");return a.classList.add("rlottie"),a.width=this.width,a.height=this.height,a.dpr=i,a})),this.contexts=this.canvas.map(a=>a.getContext("2d")),(!Y1||this.raw)&&(this.imageData=new ImageData(this.width,this.height),ve&&(this.clamped=new Uint8ClampedArray(this.width*this.height*4))),this.name?this.cache=df.CACHE.getCache(this.cacheName):this.cache=s1.createCache()}setSize(f,e){this.width=f,this.height=e,this.canvas.forEach(t=>{t.width=f,t.height=e})}clearCache(){this.cachingDelta!==1/0&&(this.cacheName&&this.cache.counter>1||this.cache.clearCache())}sendQuery(f,e){this.worker.sendQuery([f.shift(),this.reqId,...f],e)}loadFromData(f){this.sendQuery(["loadFromData",f,this.width,this.height,this.toneIndex,this.raw])}play(){this.paused&&(this.paused=!1,this.setMainLoop())}pause(f=!0){this.paused||(this.paused=!0,f&&(clearTimeout(this.rafId),this.rafId=void 0))}resetCurrentFrame(){return this.curFrame=this.initFrame??(this.direction===1?this.minFrame:this.maxFrame)}stop(f=!0){this.pause();const e=this.resetCurrentFrame();f&&this.requestFrame(e)}restart(){this.stop(!1),this.play()}playOrRestart(){this.paused&&(this.curFrame===this.maxFrame?this.restart():this.play())}setSpeed(f){this.speed!==f&&(this.speed=f,this.paused||this.setMainLoop())}setDirection(f){this.direction!==f&&(this.direction=f,this.paused||this.setMainLoop())}remove(){this.pause(),this.sendQuery(["destroy"]),this.cacheName&&df.CACHE.releaseCache(this.cacheName),this.dispatchEvent("destroy"),this.cleanup()}applyColor(f){O1(f,this.color||F1.getPropertyAsColor(this.textColor),0,0,this.width,this.height)}applyColorForAllContexts(){!this.color&&!this.textColor||this.contexts.forEach(f=>{this.applyColor(f)})}renderFrame2(f,e){try{f instanceof Uint8ClampedArray&&this.imageData.data.set(f),this.contexts.forEach((t,s)=>{let i=this.cache.framesNew.get(e);if(f instanceof Uint8ClampedArray?s>0&&(i=this.canvas[0]):i=f,!i){const a=document.createElement("canvas");a.width=t.canvas.width,a.height=t.canvas.height,a.getContext("2d").putImageData(this.imageData,0,0),this.cache.framesNew.set(e,a),i=a}this.overrideRender&&this.renderedFirstFrame?this.overrideRender(i||this.imageData):i?(t.clearRect(0,0,i.width,i.height),t.drawImage(i,0,0)):t.putImageData(this.imageData,0,0),(this.color||this.textColor)&&this.applyColor(t),this.renderedFirstFrame||(this.renderedFirstFrame=!0)}),this.dispatchEvent("enterFrame",e)}catch(t){console.error("RLottiePlayer renderFrame error:",t,this.width,this.height),this.autoplay=!1,this.pause()}}renderFrame(f,e){if(this.cachingDelta&&(e%this.cachingDelta||!e)&&(f instanceof Uint8ClampedArray&&!this.cache.frames.has(e)?this.cache.frames.set(e,new Uint8ClampedArray(f)):Y1&&f instanceof ImageBitmap&&!this.cache.framesNew.has(e)&&this.cache.framesNew.set(e,f)),this.frInterval){const s=Date.now(),i=s-this.frThen;if(i<0){const a=this.frInterval>-i?-i%this.frInterval:this.frInterval;this.rafId&&clearTimeout(this.rafId),this.rafId=window.setTimeout(()=>{this.renderFrame2(f,e)},a);return}}this.renderFrame2(f,e)}requestFrame(f){const e=this.cache.frames.get(f),t=this.cache.framesNew.get(f);t?this.renderFrame(t,f):e?this.renderFrame(e,f):(this.clamped&&!this.clamped.length&&(this.clamped=new Uint8ClampedArray(this.width*this.height*4)),this.sendQuery(["renderFrame",f],this.clamped?[this.clamped.buffer]:void 0))}onLap(){return++this.playedTimes,typeof this.loop=="number"&&this.playedTimes>=this.loop&&(this.loop=this.autoplay=this._loop=this._autoplay=!1),this.loop?!0:(this.clearCache(),this.pause(!1),!1)}mainLoopForwards(){const{skipDelta:f,maxFrame:e}=this,t=this.curFrame+f>e?this.curFrame=this.loop?this.minFrame:this.maxFrame:this.curFrame+=f;return this.requestFrame(t),t+f>e?this.onLap():!0}mainLoopBackwards(){const{skipDelta:f,minFrame:e}=this,t=this.curFrame-f<e?this.curFrame=this.loop?this.maxFrame:this.minFrame:this.curFrame-=f;return this.requestFrame(t),t-f<e?this.onLap():!0}setMainLoop(){clearTimeout(this.rafId),this.rafId=void 0,this.frInterval=1e3/this.fps/this.speed*this.skipDelta,this.frThen=Date.now()-this.frInterval;const f=(this.direction===1?this.mainLoopForwards:this.mainLoopBackwards).bind(this);this.currentMethod=f,this.frameListener&&this.listenerResults.enterFrame!==void 0&&this.frameListener(this.curFrame)}playPart(f){this.pause();const{from:e,to:t,callback:s}=f;return this.curFrame=e-1,this.playToFrame({frame:t,direction:t>e?1:-1,callback:s})}playToFrame(f){this.pause();const{frame:e,speed:t,callback:s,direction:i}=f;this.setDirection(i===void 0?this.curFrame>e?-1:1:i),t!==void 0&&this.setSpeed(t);const a=[this.curFrame,e];this.direction===-1&&a.reverse(),this.loop=!1,this.setMinMax(a[0],a[1]),this.playToFrameOnFrameCallback&&this.removeEventListener("enterFrame",this.playToFrameOnFrameCallback),s&&(this.playToFrameOnFrameCallback=n=>{n===e&&(this.removeEventListener("enterFrame",this.playToFrameOnFrameCallback),s())},this.addEventListener("enterFrame",this.playToFrameOnFrameCallback)),this.play()}setColor(f,e){typeof f=="string"?this.textColor=f:this.color=f,e&&this.paused&&this.applyColorForAllContexts()}setMinMax(f=0,e=this.frameCount-1){this.minFrame=f,this.maxFrame=e}async onLoad(f,e){this.frameCount=f,this.fps=e,this.setMinMax(),this.initFrame!==void 0&&(this.initFrame=N1(this.initFrame,this.minFrame,this.maxFrame));const t=this.resetCurrentFrame();if(this.fps<60&&this.skipDelta!==1){const s=60/e;this.skipDelta=this.skipDelta/s|0}this.frInterval=1e3/this.fps/this.speed*this.skipDelta,this.frThen=Date.now()-this.frInterval,!this.skipFirstFrameRendering&&this.requestFrame(t),this.dispatchEvent("ready"),this.addEventListener("enterFrame",()=>{this.dispatchEvent("firstFrame"),!this.canvas[0].parentNode&&this.el&&!this.overrideRender&&this.el.forEach((s,i)=>s.append(this.canvas[i])),this.frameListener=()=>{if(this.paused||!this.currentMethod)return;const s=Date.now();this.frThen=s+this.frInterval,!this.currentMethod()&&!this.loop&&this.autoplay&&(this.autoplay=!1)},this.addEventListener("enterFrame",this.frameListener),this.group==="none"&&this.autoplay&&this.play()},{once:!0})}};df.CACHE=_1,df.reqId=0;let of=df;class _0 extends pe{constructor(f){super(),this.worker=f,this.worker.onerror=e=>{try{this.dispatchEvent("workerError",e),this.cleanup(),this.terminate()}catch{}},this.worker.onmessage=e=>{this.dispatchEvent(e.data.queryMethodListener,...e.data.queryMethodArguments)}}postMessage(f){this.worker.postMessage(f)}terminate(){this.worker.terminate()}sendQuery(f,e){this.worker.postMessage({queryMethod:f.shift(),queryMethodArguments:f},ve?e:void 0)}}const qf=typeof WebAssembly<"u";class O0{constructor(){this.loadPromise=qf?void 0:Promise.reject(Sf("NO_WASM")),this.loaded=!1,this.workersLimit=o0.threads,this.players={},this.playersByCacheName={},this.workers=[],this.curWorkerNum=0,this.log=D1("LOTTIE",we.Error),this.onPlayerLoaded=(f,e,t)=>{const s=this.players[f];if(!s){this.log.warn("onPlayerLoaded on destroyed player:",f,e);return}this.log.debug("onPlayerLoaded"),s.onLoad(e,t)},this.onFrame=(f,e,t)=>{const s=this.players[f];if(!s){this.log.warn("onFrame on destroyed player:",f,e);return}s.clamped!==void 0&&t instanceof Uint8ClampedArray&&(s.clamped=t),s.renderFrame(t,e)},this.onPlayerError=(f,e)=>{const t=this.players[f];if(!t)return;sf.getAnimations(t.el[0]).forEach(i=>{sf.removeAnimation(i)})},K.addEventListener("theme_changed",()=>{for(const f in this.players)this.players[f].applyColorForAllContexts()})}getAnimation(f){for(const e in this.players)if(this.players[e].el.includes(f))return this.players[e];return null}loadLottieWorkers(){return this.loadPromise?this.loadPromise:this.loadPromise=new Promise((f,e)=>{let t=this.workersLimit;for(let s=0;s<this.workersLimit;++s){const i=new Worker(new URL(""+new URL("rlottie.worker-Z4CzoTfp.js",import.meta.url).href,import.meta.url),{type:"module"}),a=this.workers[s]=new _0(i);a.addEventListener("ready",()=>{this.log("worker #"+s+" ready"),a.addEventListener("frame",this.onFrame),a.addEventListener("loaded",this.onPlayerLoaded),a.addEventListener("error",this.onPlayerError),--t,t||(this.log("workers ready"),f(),this.loaded=!0)},{once:!0}),a.addEventListener("workerError",n=>{e("rlottie load error: "+n.message),this.loaded=!1},{once:!0})}})}makeAssetUrl(f){return"assets/tgs/"+f+".json"}loadAnimationAsAsset(f,e){return this.loadAnimationFromURL(f,this.makeAssetUrl(e))}loadAnimationDataFromURL(f,e="blob"){return qf?(this.loadLottieWorkers(),fetch(f).then(t=>!t.headers||t.headers.get("content-type")==="application/octet-stream"?t.arrayBuffer().then(s=>Kf.invokeCrypto("gzipUncompress",s)).then(s=>c0(s,"")):t[e]())):this.loadPromise}loadAnimationFromURLManually(f){const e=this.makeAssetUrl(f);return this.loadAnimationDataFromURL(e).then(t=>s=>this.loadAnimationFromURLNext(t,s,e))}loadAnimationFromURL(f,e){return this.loadAnimationDataFromURL(e).then(t=>this.loadAnimationFromURLNext(t,f,e))}loadAnimationFromURLNext(f,e,t){const s=Object.assign(e,{animationData:f,needUpscale:!0});return s.name||(s.name=t),this.loadAnimationWorker(s)}waitForFirstFrame(f){return Promise.race([new Promise(e=>{f.addEventListener("firstFrame",e,{once:!0})}),l0(2500)]).then(()=>f)}async loadAnimationWorker(f){if(!qf)return this.loadPromise;this.loaded||await this.loadLottieWorkers();const{middleware:e,group:t=""}=f;if(e&&!e())throw Sf("MIDDLEWARE");if(f.sync){const a=of.CACHE.generateName(f.name,f.width,f.height,f.color,f.toneIndex),n=this.playersByCacheName[a];if(n?.size)return Promise.resolve(n.entries().next().value[0])}const s=Array.isArray(f.container)?f.container:[f.container];if((!f.width||!f.height)&&(f.width=parseInt(s[0].style.width),f.height=parseInt(s[0].style.height)),!f.width||!f.height)throw new Error("No size for sticker!");f.group=t;const i=this.initPlayer(s,f);return sf.addAnimation({animation:i,group:t,observeElement:i.el[0],controlled:e,liteModeKey:f.liteModeKey,type:"lottie"}),f.middleware?.onDestroy(()=>{i.remove()}),i}onDestroy(f){delete this.players[f]}destroyWorkers(){qf&&(this.workers.forEach((f,e)=>{f.terminate(),this.log("worker #"+e+" terminated")}),this.log("workers destroyed"),this.workers.length=0,this.curWorkerNum=0,this.loaded=!1,this.loadPromise=void 0)}initPlayer(f,e){var n;const t=new of({el:f,worker:this.workers[this.curWorkerNum++],options:e}),{reqId:s,cacheName:i}=t;this.players[s]=t;const a=i?(n=this.playersByCacheName)[i]??(n[i]=new Set):void 0;return i&&a.add(t),this.curWorkerNum>=this.workers.length&&(this.curWorkerNum=0),t.addEventListener("destroy",()=>{this.onDestroy(s),a.delete(t)&&!a.size&&delete this.playersByCacheName[i]}),t.loadFromData(e.animationData),t}}const p1=new O0;cf.lottieLoader=p1;function De(d,f){if(typeof f=="string"){d.textContent=f;return}const e=d.firstChild;e?d.lastChild===e?e.replaceWith(f):(d.textContent="",d.append(f)):d.append(f)}function j0(d,f){return Array.isArray(d)||(d=[d]),f?d.forEach(e=>e.setAttribute("disabled","true")):d.forEach(e=>e.removeAttribute("disabled")),()=>j0(d,!f)}function Me(d,f=!1,e=!0){if(!(h0&&(!f||document.activeElement.tagName!=="INPUT"&&!document.activeElement.isContentEditable)))if(e&&d.focus(),d instanceof HTMLInputElement){const t=d.value.length;d.selectionStart=t,d.selectionEnd=t}else{const t=document.createRange();t.selectNodeContents(d),t.collapse(!1);const s=window.getSelection();s.removeAllRanges(),s.addRange(t)}}window.placeCaretAtEnd=Me;class B0{constructor(f,e){this.items=new Map,this.locked=!1,this.observer=new IntersectionObserver(t=>{if(this.locked)return;const s=[];t.forEach((i,a)=>{const n=i.target;if(this.items.get(n)===i.isIntersecting)return;this.items.set(n,i.isIntersecting);const o={target:n,visible:i.isIntersecting,entry:i,index:a};s.push(o)}),s.forEach(i=>{f(i)})},e)}getVisible(){const f=[];return this.items.forEach((e,t)=>{e&&f.push(t)}),f}clearVisible(){const f=this.getVisible();for(const e of f)this.items.set(e,!1)}isVisible(f){return this.items.get(f)}disconnect(){this.observer.disconnect(),this.items.clear()}refresh(){this.observer.disconnect();const f=[...this.items.keys()];for(const e of f)this.observer.observe(e)}refreshVisible(){const f=this.getVisible();for(const e of f)this.observer.unobserve(e);for(const e of f)this.observer.observe(e)}observe(f){this.items.set(f,!1),this.observer.observe(f)}unobserve(f){this.observer.unobserve(f),this.items.delete(f)}unlock(){this.locked=!1}unlockAndRefresh(){this.unlock(),this.refresh()}lock(){this.locked=!0}}function _e(d,f){const e=[];let t=-1;for(;(t=d.findIndex(f))!==-1;)e.push(d.splice(t,1)[0]);return e}function U0(d,f){const e=d.findIndex(f);return e!==-1?d.splice(e,1)[0]:void 0}const V0=8,z0=new Set(["NO_ENTRY_FOUND","STORAGE_OFFLINE","MIDDLEWARE","NO_AUTO_DOWNLOAD"]);class q0{constructor(f=V0){this.parallelLimit=f,this.queueId=0,this.queue=[],this.inProcess=new Set,this.lockPromise=null,this.unlockResolve=null,this.log=D1("LL",we.Error),this.processQueue=u0(()=>this._processQueue(),8,!1)}clear(){this.inProcess.clear(),this.queue.length=0}lock(){this.lockPromise||(this.lockPromise=new Promise((f,e)=>{this.unlockResolve=f}))}unlock(){this.unlockResolve&&(this.unlockResolve(),this.unlockResolve=this.lockPromise=null,this.processQueue())}async processItem(f){if(!this.lockPromise){this.inProcess.add(f);try{await this.loadItem(f)}catch(e){z0.has(e?.type)||this.log.error("loadMediaQueue error:",e)}this.inProcess.delete(f),this.processQueue()}}loadItem(f){return f.load()}getItem(){return this.queue.shift()}addElement(f,e){this.queue[f](e),this.processQueue()}_processQueue(f){if(!(!this.queue.length||this.lockPromise||this.parallelLimit>0&&this.inProcess.size>=this.parallelLimit))do{if(f?e1(this.queue,f):f=this.getItem(),f)this.processItem(f);else break;f=null}while(this.inProcess.size<this.parallelLimit&&this.queue.length)}push(f){this.addElement("push",f)}unshift(f){this.addElement("unshift",f)}}class H0 extends q0{constructor(f){super(f),this.queue=[],this.inProcess=new Set}lock(){super.lock(),this.intersector.lock()}unlock(){super.unlock(),this.intersector.unlock()}unlockAndRefresh(){super.unlock(),this.intersector.unlockAndRefresh()}clear(){super.clear(),this.intersector.disconnect()}refresh(){this.intersector.refresh()}loadItem(f){return f.load(f.div)}addElement(f,e){if(this.queue.find(s=>s.div===e.div&&s.load===e.load))return!1;for(const s of this.inProcess)if(s.div===e.div&&s.load===e.load)return!1;return this.queue[f](e),!0}setProcessQueueTimeout(){this.intersectorTimeout??(this.intersectorTimeout=window.setTimeout(()=>{this.intersectorTimeout=void 0,this.processQueue()},0))}push(f){super.push(f)}unshift(f){super.unshift(f)}delete(f){_e(this.queue,e=>e.div===f.div),this.unobserve(f)}observe(f){this.intersector.observe(f.div)}unobserve(f){this.intersector.unobserve(f.div)}}class G0 extends H0{constructor(f,e){super(f),this.onVisibilityChange=({target:t,visible:s})=>{_e(this.queue,i=>i.div===t).forEach(i=>{s&&(i.wasSeen=!0),i.visible=s;const a=this.queue.findIndex(n=>!n.visible);this.queue.splice(Math.max(0,a),0,i)}),this.setProcessQueueTimeout()},this.intersector=new B0(this.onVisibilityChange),!e&&F0(()=>{this.lock()},()=>{this.unlockAndRefresh()})}getItem(){return U0(this.queue,f=>f.wasSeen)}async processItem(f){await super.processItem(f),this.intersector.unobserve(f.div)}addElement(f,e){return super.addElement(f,e)?(this.observe(e),e.wasSeen??(e.wasSeen=!1),!0):!1}setAllSeen(){this.queue.forEach(f=>{f.wasSeen=!0}),this.setProcessQueueTimeout()}}function W0(d){const f="AACAAAAHAAALMAAAQASTAVAAAZaacaaaahaaalmaaaqastava.az0123456789-,";let e="M";for(let t=0,s=d.length;t<s;++t){const i=d[t];i>=192?e+=f[i-128-64]:(i>=128?e+=",":i>=64&&(e+="-"),e+=""+(i&63))}return e+="z",e}let yf,Ff;function Q0(d){yf||(yf=document.createElement("canvas"),Ff=yf.getContext("2d"));const f=d.getContext("2d"),e=20*(d.dpr??1),t=e,s=e,i=(d.width-t)/2,n=d.height-s-0,o=f.getImageData(i,n,t,s).data;let c=0,h=0,p=0,g=0;for(let r=0;r<o.length;r+=4)c+=o[r],h+=o[r+1],p+=o[r+2],g+=o[r+3];yf.width=yf.height=e;const m=new Uint8ClampedArray([c*255/g,h*255/g,p*255/g,255]),u=`rgba(${m[0]}, ${m[1]}, ${m[2]}, ${m[3]})`;return Ff.fillStyle=u,Ff.fillRect(0,0,e,e),Ff.fillStyle="rgba(112, 117, 121, 0.3)",Ff.fillRect(0,0,e,e),yf.toDataURL("image/jpeg")}const g1=new Set;function $0({pip:d,middleware:f}){const e=document.createElement("video");return d||(e.disablePictureInPicture=!0),e.setAttribute("playsinline","true"),g1.add(e),f?.onDestroy(async()=>{g1.delete(e),await Fe(),e.src="",e.load()}),e}window.createdVideos=g1;const J0="DECODER_ERROR_NOT_SUPPORTED: Audio configuration specified 2 channels, but FFmpeg thinks the file contains 1 channels";function X0(d){return d.code===4&&d.message===J0}function K0(d){try{const f=d.target,e=f.error;if(!e||e.message.includes("URL safety check"))return console.warn("will ignore video error",d),!0;const t=X0(e);if(t&&!f.triedFixingChromeBug){let s;const i=f.src;return i.includes("/stream/")?s=i+"?_crbug1250841":s=K.managers.appDocsManager.fixChromiumMp4(i),t1(s,a=>{f.triedFixingChromeBug=!0,f.src!==a&&(f.src=a,f.load())}),!0}else t&&console.error("chrome video error",d)}catch{}return!1}function Oe(d,f=d.HAVE_METADATA,e){return new Promise((t,s)=>{if(d.readyState>=f){t();return}const i=ye&&!e?"loadeddata":"canplay",a="error",n=()=>{d.removeEventListener(a,o),t()},o=c=>{K0(c)||(d.removeEventListener(i,n),d.removeEventListener(a,o),s(d.error))};d.addEventListener(i,n,{once:!0}),d.addEventListener(a,o)})}const Z1={},fe=(d,f)=>{d instanceof HTMLImageElement||d instanceof HTMLVideoElement?d.src=f:d instanceof SVGImageElement?d.setAttributeNS(null,"href",f):d.style.backgroundImage="url("+f+")"};function $f(d,f,e,t,s){if(s&&(t=!1),t??(t=s===void 0),!f){console.error("renderImageFromUrl: no url?",d,f),e?.();return}const i=d instanceof HTMLVideoElement;if(Z1[f]&&t||i){if(d&&fe(d,f),e){if(i)return Oe(d).then(e);e?.()}}else{const a=d instanceof HTMLImageElement,n=a?d:new Image,o=()=>{!a&&d&&fe(d,f),Z1[f]=!0,s?.(n),e?.()},c=h=>{h.message.includes("cannot be decoded")||console.error("Render image from url failed:",h,f,n,h.message,n.naturalWidth),e?.()};return n.decoding="async",n.src=f,n.decode().then(o,c)}}function je(d,f,e,t){return new Promise(s=>{$f(d,f,s,e,t)})}function Be(d){const f=d.length,e=new Uint8Array(Math.ceil(f/2));let t=0;f%2&&(e[t++]=parseInt(d.charAt(0),16));for(let s=t;s<f;s+=2)e[t++]=parseInt(d.substr(s,2),16);return e}function Y0(d,f="image/jpeg"){return`data:${f};base64,${btoa(String.fromCharCode(...d))}`}function Z0(d){return d instanceof Uint8Array?d:typeof d=="string"?new TextEncoder().encode(d):new Uint8Array(d)}const ft="ffd8ffe000104a46494600010100000100010000ffdb004300281c1e231e19282321232d2b28303c64413c37373c7b585d4964918099968f808c8aa0b4e6c3a0aadaad8a8cc8ffcbdaeef5ffffff9bc1fffffffaffe6fdfff8ffdb0043012b2d2d3c353c76414176f8a58ca5f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8ffc00011080000000003012200021101031101ffc4001f0000010501010101010100000000000000000102030405060708090a0bffc400b5100002010303020403050504040000017d01020300041105122131410613516107227114328191a1082342b1c11552d1f02433627282090a161718191a25262728292a3435363738393a434445464748494a535455565758595a636465666768696a737475767778797a838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae1e2e3e4e5e6e7e8e9eaf1f2f3f4f5f6f7f8f9faffc4001f0100030101010101010101010000000000000102030405060708090a0bffc400b51100020102040403040705040400010277000102031104052131061241510761711322328108144291a1b1c109233352f0156272d10a162434e125f11718191a262728292a35363738393a434445464748494a535455565758595a636465666768696a737475767778797a82838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae2e3e4e5e6e7e8e9eaf2f3f4f5f6f7f8f9faffda000c03010002110311003f00",et=Be(ft),tt=Be("ffd9");function Ld(d){const f="base64,",e=d.slice(d.indexOf(f)+f.length),t=[...atob(e)].map(s=>s.charCodeAt(0));return new Uint8Array(t)}function dt(d,f=!1){let e;!f&&d[0]===1?(e=new Uint8Array(et.concat(Array.from(d.slice(3)),tt)),e[164]=d[1],e[166]=d[2]):e=Z0(d);let t;return f?t=Ee?"image/png":"image/webp":t="image/jpeg",Y0(e,t)}function Ue(d,f,e=!1){return dt(f.bytes,e)}const y1=[];let ee=!1;function st(d,f="push"){if(!d.items.length)return Promise.resolve([]);const e=d.promise=d1();return y1[f](d),Ve(),e}function Ve(){if(!ee){const d=y1.shift();it(d).finally(()=>{ee=!1,y1.length&&Ve()})}}function it(d){if(!d.items.length)return d.promise.resolve([]),Promise.resolve([]);const f=d.items.slice(),e=[];return new Promise((t,s)=>{const i=async()=>{const a=performance.now();do{await Fe();const n=d.process.apply(d.context,f.shift());let o;if(n instanceof Promise)try{o=await n}catch(c){s(c);return}else o=n;e.push(o)}while(f.length>0&&performance.now()-a<6);f.length>0?Xf(i):t(e)};Xf(i)}).then(d.promise.resolve.bind(d.promise),d.promise.reject.bind(d.promise))}const at=2,nt=2;let E1,ze;ke?E1=Promise.resolve():E1=Ce(()=>import("./fastBlur-iN9VGk7U.js"),__vite__mapDeps([]),import.meta.url).then(d=>{ze=d.default});function rt(d,f,e,t=document.createElement("canvas")){t.width=d.width,t.height=d.height;const s=t.getContext("2d",{alpha:!1});return ke?(s.filter=`blur(${f}px)`,s.drawImage(d,-f*2,-f*2,t.width+f*4,t.height+f*4)):(s.drawImage(d,0,0),ze(s,0,0,t.width,t.height,f,e)),t}const Hf=new Map,ot=150;function ct(d,f=at,e=nt){if(!d)throw"no dataUri for blur: "+d;Hf.size>ot&&Hf.clear();const t=document.createElement("canvas");t.className="canvas-thumbnail";let s=Hf.get(d);if(s)t.width=s.canvas.width,t.height=s.canvas.height,s.promise.then(()=>{t.getContext("2d").drawImage(s.canvas,0,0,t.width,t.height)});else{const i=new Promise(a=>{E1.then(()=>{const n=new Image;n.onload=()=>{st({items:[[n,f,e,t]],context:null,process:rt},"unshift").then(()=>{a()})},n.src=d})});Hf.set(d,s={canvas:t,promise:i})}return{...s,canvas:t}}function lt(d,f,e,t=Ue(d,f,!1)){let s,i;if(!e)s=new Image,i=je(s,t);else{const a=ct(t,typeof e=="number"?e:void 0);s=a.canvas,i=a.promise}return s.classList.add("thumbnail"),{image:s,loadPromise:i}}const Af={};function qe(d,f,e,t){const s=Le(d.id,f),i=Af[s];return i&&i.width>=e&&i.height>=t}let Cf,v1;const ht=()=>{K.addEventListener("theme_changed",()=>{K.managers.thumbsStorage.clearColoredStickerThumbs();for(const d in Af){const[,f]=d.split("-");f&&isNaN(+f)&&delete Af[d]}}),Cf=document.createElement("canvas"),v1=Cf.getContext("2d")};async function te(d,f,e){const t=Le(d.id,e),{width:s,height:i}=f;if(qe(d,e,s,i))return;const a=Af[t]={width:s,height:i},n=await K.managers.thumbsStorage.getStickerCachedThumb(d.id,e);if(Af[t]!==a||n&&n.w>=s&&n.h>=i)return;typeof e=="string"&&(Cf||ht(),Cf.width=s,Cf.height=i,v1.drawImage(f,0,0,s,i),O1(v1,F1.getProperty(e),0,0,s,i),f=Cf);const c=await new Promise(h=>{f.toBlob(p=>h(p))});if(Af[t]===a){if(!c){console.error("trying to save sticker preview with no blob",arguments);debugger;return}K.managers.thumbsStorage.saveStickerPreview(d.id,c,s,i,e)}}let de=0;function ut(d){let f;const e=d?.type;if(e){const t=`${$1}_${de++}.${e.split("/")[1]}`;["image/jpeg","image/png","image/bmp"].indexOf(e)>=0?f="photo"+t:e.indexOf("audio/")===0||["video/ogg"].indexOf(e)>=0?f="audio"+t:e.indexOf("video/")===0?f="video"+t:f="document"+t}else f=`upload-${$1}_${de++}`;return f}function mt(d,f){return{_:"inputDocumentFileLocation",id:d.id,access_hash:d.access_hash,file_reference:d.file_reference,thumb_size:f}}function He(d,f,e,t){const s=mt(d,f?.type);let i;return f?._==="photoSize"?i=d.sticker?"image/webp":d.mime_type.startsWith("image/")?d.mime_type:"image/jpeg":i=d.mime_type||"application/octet-stream",{dcId:d.dc_id,location:s,size:f?f.size:d.size,mimeType:i,fileName:d.file_name,queueId:e,onlyCache:t}}function Ge(d,f,e,t){const s=d._==="document";if(!f||f._==="photoSizeEmpty")throw new Error("photoSizeEmpty!");const i=!!((f._==="photoSize"||f._==="photoSizeProgressive")&&d.access_hash&&d.file_reference),a={_:s?"inputDocumentFileLocation":"inputPhotoFileLocation",id:d.id,access_hash:d.access_hash,file_reference:d.file_reference,thumb_size:f.type};return{dcId:d.dc_id,location:a,size:i?f.size:void 0,mimeType:"image/jpeg",queueId:e,onlyCache:t}}function We(d){return{dcId:0,location:d,size:0,mimeType:"image/jpeg"}}function bt(d){const f=We({_:"inputWebFileLocation",access_hash:d.access_hash,url:d.url});return f.size=d.size,f.mimeType=d.mime_type,f}function pt(d){return!!(d&&(d._==="webDocument"||d._==="webDocumentNoProxy"))}function Qe(d){return Ae(d.location,d)}function gt(d){const{media:f,thumb:e,queueId:t,onlyCache:s}=d;let i;return f._==="document"?i=He(f,e,t,s):f._==="photo"?i=Ge(f,e,t,s):pt(f)?i=bt(f):m0(f)&&(i=We(f)),i.downloadId=d.downloadId,{fileName:Qe(i),downloadOptions:i}}function yt(d,f,e){const t=document.createElement("a");t.href=d,t.download=f,t.target="_blank",t.style.position="absolute",t.style.top="1px",t.style.left="1px",document.body.append(t);try{const s=document.createEvent("MouseEvents");s.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(s)}catch(s){console.error("Download click error",s);try{t.click()}catch{window.open(d,"_blank")}}setTimeout(()=>{t.remove(),e&&e()},100)}class Et{constructor(){this.downloads={},this.progress={}}construct(f){this.managers=f,K.addEventListener("download_progress",e=>{const t=this.downloads[e.fileName];t?.main?.notifyAll&&(this.progress[e.fileName]=e,t.main.notifyAll(e))})}getNewDeferred(f,e){const t=d1();let s=this.downloads[f];if(!s)s=this.downloads[f]={main:t},t.cancel=()=>{const a=Sf("DOWNLOAD_CANCELED");this.managers.apiFileManager.cancelDownload(f),t.reject(a),t.cancel=rf},t.catch(()=>{this.clearDownload(f,e)}).finally(()=>{delete this.progress[f]});else{const a=s.main;["cancel","addNotifyListener","notify","notifyAll"].forEach(n=>{a[n]&&(t[n]=a[n].bind(a))})}return e==="disc"&&t.catch(rf).finally(()=>{this.clearDownload(f,e)}),s[e]=t}getNewDeferredForUpload(f,e){const t=this.getNewDeferred(f);return e.then(t.resolve.bind(t),t.reject.bind(t)),t.finally(()=>{this.clearDownload(f)}),t}clearDownload(f,e){const t=this.downloads[f];if(!t)return;delete t[e];const s=Object.keys(t).length;(!s||t.main&&s===1)&&delete this.downloads[f]}getUpload(f){let e=this.getDownload(f);return e||(e=this.getNewDeferred(f),this.managers.appMessagesManager.getUploadPromise(f).then(e.resolve.bind(e),e.reject.bind(e)),e)}d(f,e,t){let s=this.getDownload(f,t);return s||(s=this.getNewDeferred(f,t),e().then(s.resolve.bind(s),s.reject.bind(s)),s)}download(f){const e=Qe(f);return this.d(e,()=>this.managers.apiFileManager.download(f),"blob")}downloadMedia(f,e="blob",t){const{downloadOptions:s,fileName:i}=gt(f);return this.d(i,()=>{let a;return e==="url"?a=this.managers.apiFileManager.downloadMediaURL:e==="void"?a=this.managers.apiFileManager.downloadMediaVoid:a=this.managers.apiFileManager.downloadMedia,t?t.then(()=>a(f)):a(f)},e)}downloadMediaURL(f){return this.downloadMedia(f,"url")}downloadMediaVoid(f){return this.downloadMedia(f,"void")}upload(f,e,t){return e||(e=ut(f)),t||(t=this.managers.apiFileManager.upload({file:f,fileName:e})),this.getNewDeferredForUpload(e,t)}getDownload(f,e){const t=this.downloads[f];return t&&t[e]}downloadToDisc(f,e){const t=f.media,s=t._==="document";!s&&!f.thumb&&(f.thumb=t.sizes.slice().pop());const i=""+(Math.random()*2147483647|0),a=`download/${i}`;f.downloadId=i;const n=Kf.pingServiceWorkerWithIframe(),o=this.downloadMedia(f,"disc",n);if(e)return o;const c=document.createElement("iframe");c.hidden=!0,n.then(()=>{c.src=a,document.body.append(c)});let h,p=!1;const g=()=>{p||(p=!0,h=c,e1(o.listeners,g))};return o.addNotifyListener(g),o.then(m=>{if(!m)return;const u=URL.createObjectURL(m),r=s?He(t):Ge(t,f.thumb),y=f.media.file_name||Ae(r.location);yt(u,r.fileName||y,()=>{URL.revokeObjectURL(u)})}).catch(rf).finally(()=>{p||g(),setTimeout(()=>{h?.remove()},1e3)}),o}}const Nf=new Et;cf&&(cf.appDownloadManager=Nf);function se(d,f=0,e=0,t=!1,s=!1){window.devicePixelRatio>1&&(f*=2,e*=2);let i=d.sizes||d.thumbs,a={_:"photoSizeEmpty",type:J1};if(s&&i&&d._!=="photo"&&(i=i.concat({_:"photoSize",w:d.w,h:d.h,size:d.size,type:J1})),i?.length){for(let n=0,o=i.length;n<o;++n){const c=i[n];if(!("w"in c)&&!("h"in c))continue;a=c;const h=b0(c.w,c.h,f,e);if(h.width>=f||h.height>=e)break}t&&a._==="photoSizeEmpty"&&i[0]._==="photoStrippedSize"&&(a=i[0])}return a}function $e(d){return d.video_thumbs?.[0]}function vt(d){return Lt(Ct(d)).join("-")}const wt=/\uFE0F/g,kt="‍",Ct=d=>d.indexOf(kt)<0?d.replace(wt,""):d;function Lt(d){const f=[];let e=0,t=0,s=0;for(;s<d.length;)e=d.charCodeAt(s++),t?(f.push((65536+(t-55296<<10)+(e-56320)).toString(16)),t=0):e>55296&&e<=56319?t=e:f.push(e.toString(16));return f.length&&f[0].length===2&&(f[0]="00"+f[0]),f}function At(d){const f=d.match(/[\uDFFB-\uDFFF]/);return f?5-(57343-f[0].charCodeAt(0)):0}const St=new Map([["FT","🏴‍☠"]]);function Ad(d){return St.get(d)??String.fromCharCode(55356,56741+d.charCodeAt(0),55356,56741+d.charCodeAt(1))}function Sd(d){return d.split("-").reduce((f,e)=>f+String.fromCodePoint(parseInt(e,16)),"")}const ie=()=>({cleaned:!1,inner:[],onCleanCallbacks:[]}),xt=Sf("MIDDLEWARE");class Tt{constructor(){this.details=ie(),this.onDestroyCallbacks=[],this.onDestroy=f=>{if(this.destroyed)return f();this.onDestroyCallbacks.push(f)}}clean(){const f=this.details;f.cleaned=!0,f.inner.splice(0,f.inner.length).forEach(e=>e.destroy()),f.onCleanCallbacks.splice(0,f.onCleanCallbacks.length).forEach(e=>e()),f.middleware=void 0,this.details=ie()}destroy(){this.destroyed=!0,this.clean(),this.onDestroyCallbacks.splice(0,this.onDestroyCallbacks.length).forEach(f=>f()),this.parent&&(e1(this.parent.details.inner,this),this.parent=void 0)}createMiddlewareForDetails(f,e){const t=()=>!f.cleaned&&(!e||e());return t.create=()=>{if(!t())throw xt;const s=j1();return s.parent=this,f.inner.push(s),s},t.onClean=s=>{if(!t())return s();f.onCleanCallbacks.push(s)},t.onDestroy=this.onDestroy,t}get(f){const e=this.details;return e.cleaned?this.createMiddlewareForDetails(e):f?this.createMiddlewareForDetails(e,f):e.middleware??(e.middleware=this.createMiddlewareForDetails(e))}}function j1(){return new Tt}function Pt(d,f){let e=!1,t;return(...s)=>{t=s,e||(e=!0,d(()=>{e=!1,f(...t)}))}}function It(d){return Pt(Xf,d)}const Je=document.createElement("div");Je.classList.add("emoji-animation-container");function Ft({size:d,stickerSize:f,doc:e,middleware:t,target:s,side:i,skipRatio:a,play:n,managers:o,fullThumb:c,withRandomOffset:h,relativeEffect:p,loopEffect:g,onUnmount:m,scrollable:u,textColor:r}){const y=document.createElement("div");y.classList.add("emoji-animation"),y.style.width=d+"px",y.style.height=d+"px";let w;const C=()=>{v.destroy();const b=w;w=void 0,b?.remove(),y.remove(),R&&u.container.removeEventListener("scroll",R),b&&m?.()},v=t?.create()??j1();t=v.get();const x=V1({div:y,doc:e,middleware:t,withThumb:!1,needFadeIn:!1,loop:!!g,width:f||d,height:f||d,play:n,group:"none",skipRatio:a,managers:o,fullThumb:c,isEffect:!0,textColor:r}).then(({render:b})=>b).then(b=>{if(!t())throw b.remove(),Sf("MIDDLEWARE");return w=b,w.addEventListener("enterFrame",E=>{(!g&&E===w.maxFrame||!u1(s))&&C()}),w.addEventListener("destroy",C),p0&&w.addEventListener("firstFrame",()=>{navigator.vibrate(100)},{once:!0}),w.addEventListener("firstFrame",()=>{j()},{once:!0}),w}),S=b=>{const E=Math.random()*b*2;return E>b?-E%b:E},l=h?S(16):0,q=h?S(4):0,j=()=>{if(!u1(s)){C();return}const b=s.getBoundingClientRect(),E=b.width/200,L=i==="center"?0:16*(i==="right"?1:-1)*E,z=i==="center"?0:0*E,B=i==="right"?b.right:b.left,$=b.top,J=(i==="center"?(b.width-d)/2:i==="right"?-d:0)+L+l,Q=(b.height-d)/2+z+q,k=B+J,M=$+Q;if(M<=-d||M>=l1.height){C();return}p?(i!=="center"?y.style[i]=Math.abs(L)*-1+"px":y.style.left=J+"px",y.style.top=Q+"px"):(y.style.top=M+"px",y.style.left=k+"px")};let R;return u&&(R=It(j),u.container.addEventListener("scroll",R)),p?(y.classList.add("is-relative"),s.parentElement.append(y)):Je.append(y),{animationDiv:y,stickerPromise:x}}function Nt(d,f){d.isSeeking=!0,d.currentTime=f}const B1=g0,Rt=B1;async function U1(d){const f=d.firstElementChild;if(!f)throw d.src="",d.load(),new Error("leak");const e=d.paused;if(f.remove(),d.load(),!d.childElementCount&&!d.src)throw new Error("leak");return e?Nt(d,1e-4):M1(d),Mt(d,Oe(d))}async function Dt(d,f=!d.getVideoPlaybackQuality().totalVideoFrames){if(f)return U1(d)}async function Mt(d,f){if(!B1)return f;const e=i=>{i.then(s.resolve.bind(s),s.reject.bind(s))},t=()=>e(Dt(d)),s=d1();try{await f}catch{t();return}if(d.getVideoPlaybackQuality().totalVideoFrames||d.readyState>d.HAVE_METADATA){s.resolve();return}return d.addEventListener("timeupdate",t,{once:!0}),s}const Rf=["seeked","canplay","canplaythrough","seeking"],_t=Rf.length,ae=new WeakMap,w1=new WeakMap;function ne(d){const{type:f,target:e}=d;if(!(e instanceof HTMLVideoElement)||e.readyState>e.HAVE_METADATA||e.isSeeking)return;let t=ae.get(e);if(t||ae.set(e,t={events:new Set}),!t.events.has(f)&&(t.events.add(f),t.events.size===_t)){const s=Array.from(t.events),i=Rf.indexOf(s[0]),a=Rf.slice(i).concat(Rf.slice(0,i));if(!y0(s,a))return;const n=w1.get(e);n?(n(),w1.delete(e)):U1(e).catch(rf)}}function Ot(d,f){return d.addEventListener(f,ne,!0),()=>d.removeEventListener(f,ne,!0)}function Xe(d){if(!B1)return;const f=Rf.map(e=>Ot(d,e));return()=>{f.forEach(e=>e())}}Xe(document);const jt=1+.245*2,Gf={},Jf={},re=(d,f,e)=>{const t=()=>{d.removeEventListener("animationend",t),f(),clearTimeout(s)};d.addEventListener("animationend",t);const s=setTimeout(t,e)},Ef=d=>{const f=d.childElementCount;return f?d.firstElementChild.classList.contains("premium-sticker-lock")&&f===1:!0},oe=d=>{let f=d.firstElementChild;return f&&f.classList.contains("premium-sticker-lock")&&(f=f.nextElementSibling),f};async function V1({doc:d,div:f,middleware:e,loadStickerMiddleware:t,lazyLoadQueue:s,exportLoad:i,group:a,play:n,onlyThumb:o,emoji:c,width:h,height:p,withThumb:g,loop:m,loadPromises:u,needFadeIn:r,needUpscale:y,skipRatio:w,static:C,managers:v=K.managers,fullThumb:x,isOut:S,noPremium:l,withLock:q,relativeEffect:j,loopEffect:R,isCustomEmoji:b,syncedVideo:E,liteModeKey:L,isEffect:z,textColor:B,scrollable:$,showPremiumInfo:J}){const Q=arguments[0];f=Array.isArray(f)?f:[f],L??(L="stickers_panel"),b&&(c=d.stickerEmojiRaw);const k=d.sticker;if(k===1&&(C=!0),!h&&!p){const A=R1.active,_=c?A.emojiSticker:d.animated?A.animatedSticker:A.staticSticker,D=E0(d.w,d.h).aspectFitted(_);h=D.width,p=D.height}k===2&&p1.loadLottieWorkers(),m=!!(!c||b)&&m,f.forEach(A=>{A.dataset.docId=""+d.id,c&&(A.dataset.stickerEmoji=c),A.classList.add("media-sticker-wrapper")}),n&&L&&!Qf.isAvailable(L)&&!b&&!z&&(n=!1,m=!1);let M;const N=(A=M?.type)=>M=Kf.getCacheContext(d,A),H=!C&&(k===2||k===3),G=$e(d);S!==void 0&&G&&!S&&f.forEach(A=>A.classList.add("reflect-x"));const U=G&&q;if(U){const A=Gf[d.id];f.forEach(_=>{_.classList.add("is-premium-sticker"),_.append(b1("premium_lock","premium-sticker-lock")),A&&_.style.setProperty("--lock-url",`url(${A})`)})}if(C&&k!==1){const A=se(d,h,p,!1);N(A.type)}else N(x?.type);const Of=d.attributes.find(A=>A._==="documentAttributeCustomEmoji");!Of||!Of.pFlags.text_color?B=void 0:B||(B="primary-text-color");const Y=c&&!b?At(c):-1,H1=Y===-1?B??Y:Y,Pf=M.downloaded&&!r,a0=H,G1=k===2||k===3?Kf.getStickerCachedThumb(d.id,H1):void 0,lf={render:void 0,load:void 0,width:h,height:p};let ff=d1(),hf=!1;if((d.thumbs?.length||G1)&&Ef(f[0])&&(!Pf||a0||o)&&g!==!1){let A=G1||d.thumbs[0];const _=(D,V)=>{Ef(D)?gf.mutateElement(D,()=>{Ef(D)&&(V.classList.add("media-sticker","thumbnail"),D.append(V)),ff.resolve()}):ff.resolve()};if("url"in A)hf=!0,f.forEach(D=>{const V=new Image;$f(V,A.url,()=>_(D,V))});else if("bytes"in A){if(A._==="photoPathSize"){A.bytes.length||(A=d.thumbs.find(I=>I.bytes?.length)||A);const D=W0(A.bytes),V="http://www.w3.org/2000/svg",F=document.createElementNS(V,"svg");F.classList.add("rlottie-vector","media-sticker","thumbnail"),F.setAttributeNS(null,"viewBox",`0 0 ${d.w||512} ${d.h||512}`);const T=document.createElementNS(V,"path");T.setAttributeNS(null,"d",D),F.append(T),f.forEach((I,W)=>I.append(W>0?F.cloneNode(!0):F)),hf=!0,ff.resolve()}else if(Y<=0){const D=()=>{f.forEach(V=>{const F=new Image,T=Ue(d,A,!0);$f(F,T,()=>_(V,F))})};v0||d.pFlags.stickerThumbConverted||M.url?(hf=!0,D()):(hf=!0,w0.convert("main-"+d.id,A.bytes).then(V=>{if(v.appDocsManager.saveWebPConvertedStrippedThumb(d.id,V),A.bytes=V,d.pFlags.stickerThumbConverted=!0,e&&!e()||!Ef(f[0])){ff.resolve();return}D()}).catch(()=>ff.resolve()))}}else if((k===2&&Y<=0||k===3)&&(g||o)){const D=async()=>{if(!Ef(f[0])||e&&!e()){ff.resolve();return}const V=(F,T,I)=>{if(!Ef(F)||e&&!e()){ff.resolve();return}I?$f(T,I,()=>_(F,T)):_(F,T)};N(),f.forEach(F=>{if(M.url)V(F,new Image,M.url);else if("bytes"in A){const T=lt(d,A,!0);T.loadPromise.then(()=>V(F,T.image,""))}else Nf.downloadMediaURL({media:d,thumb:A}).then(async T=>V(F,new Image,T))})};if(s&&o)return s.push({div:f[0],load:D}),ff.resolve(),lf;D(),A.url&&(hf=!0)}}if(u&&hf&&u.push(ff),o)return lf;const jf=Sf("MIDDLEWARE"),n1=async()=>{if(e&&!e())throw jf;if(k===2&&!C){const A=await Nf.downloadMedia({media:d,queueId:s?.queueId,thumb:x});if(e&&!e())throw jf;const _=await p1.loadAnimationWorker({container:f[0],loop:m,autoplay:n,animationData:A,width:h,height:p,name:"doc"+d.id,needUpscale:y,skipRatio:w,toneIndex:Y,sync:b,middleware:t??e,group:a,liteModeKey:L||void 0,textColor:b?void 0:B}),D=U?()=>{var T;const F=Gf[T=d.id]??(Gf[T]=Q0(_.canvas[0]));f.forEach(I=>I.style.setProperty("--lock-url",`url(${F})`))}:void 0,V=(F,T)=>{let I=oe(F);I=I!==T&&I,r!==!1&&(r=(r||!I||I.tagName==="svg")&&Qf.isAvailable("animations"));const W=()=>{I&&I!==T&&I.tagName!=="DIV"&&I.remove()};r?gf.mutate(()=>{T&&T.classList.add("fade-in"),I&&I.classList.add("fade-out"),re(T||I,()=>{gf.mutate(()=>{T&&T.classList.remove("fade-in"),W()})},400)}):I&&gf.mutate(W)};return _.addEventListener("firstFrame",()=>{const F=_.canvas[0];(g!==!1||b)&&te(d,F,H1),U&&D(),b||f.forEach((T,I)=>{V(T,_.canvas[I])})},{once:!0}),c&&v.appStickersManager.preloadAnimatedEmojiStickerAnimation(c),_}else if(C||k===3){const A=H&&E,_=A?_1.generateName(""+d.id,0,0,void 0,void 0):void 0,D=Jf[_];if(D)return D;const F=(A?f.slice(0,1):f).map(()=>{let W;if(C)W=new Image;else{const X=W=$0({middleware:e});if(X.muted=!0,n&&(X.autoplay=!0),m&&(X.loop=!0),X._autoplay=n||!1,X._loop=m||!1,m&&typeof m=="number"){let ef=function(){tf>this.currentTime&&++uf===m&&(this.autoplay=!1,this.loop=!1,this.pause(),X.removeEventListener("timeupdate",ef)),this.timeUpdatedTimes=(this.timeUpdatedTimes||0)+1,tf=this.currentTime},tf=0,uf=0;X.addEventListener("timeupdate",ef),e.onClean(()=>{X.removeEventListener("timeupdate",ef)})}}return W.classList.add("media-sticker"),W}),T=f.map((W,X)=>{const ef=oe(W);return ef!==F[X]&&ef});r!==!1&&(r=(r||!Pf||(C?T[0]:!T[0]||T[0].tagName==="svg"))&&Qf.isAvailable("animations")),r&&F.forEach(W=>W.classList.add("fade-in"));const I=new Promise(async(W,X)=>{const ef=async()=>{if(e&&!e()){X(jf);return}const tf=F.length,uf=[],n0=(mf,O,Z)=>{gf.mutateElement(mf,()=>{if(e&&!e()){X(jf);return}if(!O){(!A||!H)&&Z?.remove();return}const Bf=O instanceof HTMLVideoElement;if(Bf){const{videoWidth:bf,videoHeight:Uf}=O,If=bf/Uf;let Vf=h*window.devicePixelRatio,zf=p*window.devicePixelRatio;if(If<1?Vf=zf*If:zf=Vf/If,!qe(d,Y,Vf,zf)){const pf=document.createElement("canvas");pf.width=Vf,pf.height=zf,pf.getContext("2d").drawImage(O,0,0,pf.width,pf.height),te(d,pf,Y)}}if(A){W(O);return}if(Bf&&Rt&&(w1.set(O,()=>{const bf=()=>{U1(O).catch(rf)};if(!Z||!(Z instanceof HTMLImageElement)){const Uf=document.createElement("div");V1({...Q,div:Uf,static:!0,exportLoad:void 0,needFadeIn:!1,lazyLoadQueue:void 0}).then(({render:If})=>If).finally(()=>{gf.mutateElement(O,()=>{e()&&mf.append(...Array.from(Uf.children)),O.remove(),bf()})})}else O.replaceWith(Z),bf()}),O.duration<1||O.getVideoPlaybackQuality().totalVideoFrames<10)){const bf=Xe(O);e.onClean(bf)}mf.append(O),r?(Z&&Z.classList.add("fade-out"),re(O,()=>{O.classList.remove("fade-in"),Z?.remove()},400)):Z?.remove(),H&&sf.addAnimation({animation:O,observeElement:mf,group:a,controlled:e,liteModeKey:L||void 0,type:"video"}),uf.push(O)===tf&&W(uf)})};N();let W1;f.forEach((mf,O)=>{const Z=F[O],Bf=()=>n0(mf,Z,T[O]);Z&&(W1=je(Z,M.url)),W1.then(Bf)})};if(N(),M.url)ef();else{let tf;if(k!==1&&C){const uf=se(d,h,p,!1);tf=Nf.downloadMediaURL({media:d,thumb:uf,queueId:s?.queueId})}else tf=Nf.downloadMediaURL({media:d,queueId:s?.queueId});tf.then(ef,X)}});return _&&(Jf[_]=I,t&&I.finally(()=>{t()||delete Jf[_]})),I}};if(i&&(i===1&&(!Pf||H)||i===2))return lf.load=n1,lf;const r1=s&&(!Pf||H)?(s.push({div:f[0],load:n1}),Promise.resolve()):n1();return Pf&&C&&(ff=r1,u?.push(ff)),k===2&&G&&S!==void 0&&!l&&Bt({container:f[0],doc:d,managers:v,middleware:e,isOut:S,width:h,loadPromise:r1,relativeEffect:j,loopEffect:R,scrollable:$,showPremiumInfo:J}),lf.render=r1,lf}function Bt({container:d,doc:f,managers:e,middleware:t,isOut:s,width:i,loadPromise:a,relativeEffect:n,loopEffect:o,scrollable:c,showPremiumInfo:h}){e.appStickersManager.preloadSticker(f.id,!0),N0(d,async p=>{const g=Qf.isAvailable("effects_premiumstickers")||n;if(Se(p),!p.isTrusted&&!g)return;if(d.dataset.playing||!g){h?.();return}d.dataset.playing="1",await a;const{animationDiv:m,stickerPromise:u}=Ft({doc:f,middleware:t,side:s?"right":"left",size:i*jt,target:d,play:!0,fullThumb:$e(f),relativeEffect:n,loopEffect:o,scrollable:c});s!==void 0&&!s&&m.classList.add("reflect-x"),u.then(r=>{r.addEventListener("destroy",()=>{delete d.dataset.playing})})})}function Ke(d,f,e,t=d.getBoundingClientRect(),s=f.getBoundingClientRect()){let{top:i,right:a,bottom:n,left:o}=s;if(e){const g=f.querySelector(".sticky");g&&(i=g.getBoundingClientRect().bottom)}if(t.top>=n||t.bottom<=i||t.right<=o||t.left>=a)return null;const c={top:!1,right:!1,bottom:!1,left:!1,vertical:0,horizontal:0},h=l1.width,p=l1.height;return{rect:{top:t.top<i&&i!==0?(c.top=!0,++c.vertical,i):t.top,right:t.right>a&&a!==h?(c.right=!0,++c.horizontal,a):t.right,bottom:t.bottom>n&&n!==p?(c.bottom=!0,++c.vertical,n):t.bottom,left:t.left<o&&o!==0?(c.left=!0,++c.horizontal,o):t.left},overflow:c}}window.getVisibleRect=Ke;function Ut({overflowElement:d,overflowRect:f,selector:e,extraSize:t,extraMinLength:s,elements:i}){f??(f=d.getBoundingClientRect()),i??(i=Array.from(d.querySelectorAll(e))),t&&(f={top:f.top-t,right:f.right+t,bottom:f.bottom+t,left:f.left-t});const a=[],n=[],o=[];let c=!1;for(const h of i){const p=h.getBoundingClientRect(),g=Ke(h,d,!1,p,f),m=!!g;let u;m?(c=!0,u=n):c?u=o:u=a,u.push({element:h,rect:p,visibleRect:g})}return s&&(n.unshift(...a.splice(Math.max(0,a.length-s),s)),n.push(...o.splice(0,s))),{invisibleTop:a,visible:n,invisibleBottom:o}}const k1=new WeakMap,ce=new ResizeObserver(d=>{for(const f of d)k1.get(f.target).setDimensionsFromRect(f.contentRect)}),Wf=new G0,f1=class f1 extends HTMLElement{constructor(){super(),this.classList.add("custom-emoji-renderer"),this.canvas=document.createElement("canvas"),this.canvas.classList.add("custom-emoji-canvas"),this.context=this.canvas.getContext("2d"),this.append(this.canvas),this.playersSynced=new Map,this.textColored=new Set,this.clearedElements=new WeakSet,this.customEmojis=new Map,this.animationGroup="EMOJI",this.isCanvasClean=!1}connectedCallback(){if(Mf.has(this))return;const f=this.observeResizeElement??this.canvas;k1.set(f,this),ce.observe(f),Mf.add(this),this.connectedCallback=void 0}disconnectedCallback(){this.isConnected||!this.auto||(this.destroy?.(),this.disconnectedCallback=void 0)}destroy(){const f=this.observeResizeElement??this.canvas;k1.delete(f),ce.unobserve(f),this.customEmojis.forEach(e=>{e.forEach(t=>{t.clear()})}),Mf.delete(this),this.playersSynced.clear(),this.middlewareHelper?.clean(),this.customEmojis.clear(),this.textColored.clear(),this.destroy=this.lastPausedVideo=void 0}getOffsets(f=new Map){if(!this.playersSynced.size)return f;const e=k0(this,"scrollable")||this.offsetParent;if(!e)return f;const t=e.getBoundingClientRect(),s=this.getBoundingClientRect();for(const i of this.playersSynced.keys()){const a=Array.from(i),n=this.isSelectable?a.map(h=>h.placeholder):a,{visible:o}=Ut({overflowElement:e,overflowRect:t,elements:n,extraSize:this.size.height*2.5}),c=o.map(({rect:h})=>{const p=h.top-s.top,g=h.left-s.left;return{top:p,left:g,width:h.width}});c.length&&f.set(i,c)}return f}clearCanvas(){if(this.isCanvasClean)return;const{context:f,canvas:e}=this;f.clearRect(0,0,e.width,e.height),this.isCanvasClean=!0}render(f){const{context:e,canvas:t,isDimensionsSet:s}=this;s||this.setDimensionsFromRect(void 0,!1),this.isCanvasClean=!1;const{width:i,height:a,dpr:n}=t;for(const[o,c]of f){const h=this.playersSynced.get(o),p=vf.get(h)||(h instanceof HTMLVideoElement?h:void 0);if(!p)continue;const g=p instanceof ImageData;let m,u;h instanceof HTMLVideoElement?(m=this.size.width*n,u=this.size.height*n):(m=p.width,u=p.height);const r=Math.round(c[0].width*n);r!==m&&(m=r,u=r);const y=i-m,w=this.textColored.has(o)?F1.getProperty(this.textColor):void 0;!this.clearedElements.has(o)&&!this.isSelectable&&(this.isSelectable?o.forEach(C=>{C.lastChildWas??(C.lastChildWas=C.lastChild),De(C,C.firstChild)}):o.forEach(C=>{C.replaceChildren()}),this.clearedElements.add(o)),c.forEach(({top:C,left:v})=>{C=Math.round(C*n),v=Math.round(v*n),!(v<0||v>y)&&(g?e.putImageData(p,v,C):e.drawImage(p,v,C,m,u),w&&O1(e,w,v,C,m,u))})}}checkForAnyFrame(){for(const f of this.playersSynced.values())if(vf.has(f)||f instanceof HTMLVideoElement)return!0;return!1}remove(){super.remove()}setDimensionsFromRect(f=this.lastRect,e=!0){const{canvas:t}=this,{dpr:s}=t;if(this.lastRect!==f&&(this.lastRect=f),!f||!s||this.ignoreSettingDimensions)return;const{width:i,height:a}=f,n=Math.floor(Math.round(i*s)),o=Math.floor(Math.round(a*s));t.width===n&&t.height===o||(t.width=n,t.height=o,this.isDimensionsSet=!0,this.isCanvasClean=!0,this.observeResizeElement&&(this.canvas.style.setProperty("width",i+"px","important"),this.canvas.style.setProperty("height",a+"px","important")),(this.forceRenderAfterSize||this.isSelectable&&e)&&(this.forceRenderAfterSize=void 0,this.forceRender()))}forceRender(){this.isDimensionsSet&&(C1(new Set([this]))||this.clearCanvas())}add({addCustomEmojis:f,lazyLoadQueue:e,onlyThumb:t,withThumb:s}){const i=this;if(f.forEach((g,m)=>{let u=this.customEmojis.get(m);u?this.clearedElements.delete(u):this.customEmojis.set(m,u=new Set);for(const r of g)u.has(r)?g.delete(r):(r.clean=!1,r.renderer=i,r.elements=u,r.middlewareHelper=this.middlewareHelper.get().create(),u.add(r),r.lastChildWas&&!r.lastChildWas.parentNode&&r.append(r.lastChildWas));g.size||f.delete(m)}),!f.size)return;const a=!!(!e&&e!==!1&&Wf),n=Array.from(f.keys()),o=K.managers,c=this.middlewareHelper.get(),h=this.size;return o.appEmojiManager.getCachedCustomEmojiDocuments(n).then(g=>{if(c&&!c())return;const m=[],u=(x,S)=>{const l=x.id,q=f.get(l),j=i.customEmojis.get(l),R=Array.from(q),b=x.sticker===2,E=R[0].static||x.mime_type==="video/webm"&&!C0,L=(b||x.sticker===3&&this.isSelectable)&&!t&&!E,z=x.attributes.find(N=>N._==="documentAttributeCustomEmoji");z&&z.pFlags.text_color&&i.textColored.add(j);const B=[],$=V1({div:R,doc:x,width:h.width,height:h.height,loop:!0,play:Vt,managers:o,isCustomEmoji:!0,group:"none",loadPromises:B,middleware:c,exportLoad:a||e===!1?2:1,needFadeIn:!1,loadStickerMiddleware:L&&c?c.create().get(()=>!!k.middlewares.size):void 0,static:E,onlyThumb:t,withThumb:s??(i.clearedElements.has(j)?!1:void 0),syncedVideo:this.isSelectable,textColor:i.textColor});S&&$.then(()=>S.push(...B));const J={elements:q},Q=R[0].readyPromise;if(Q&&$.then(({render:N})=>{if(!N){Q.resolve();return}N.then(()=>Q.resolve(),Q.reject.bind(Q))}),x.sticker===1||t||E)return this.isSelectable&&(J.onRender=()=>Promise.all(B).then(()=>{c&&!c()||R.forEach(N=>{const{placeholder:H}=N;H.src=N.firstElementChild.src})})),$.then(N=>({...N,...J}));J.onRender=N=>Promise.all(B).then(()=>{if(c&&!c()||!x.animated)return;const H=Array.isArray(N)?N:[N],G=Array.isArray(H)?H[0]:H;if(R.forEach((U,Of)=>{const Y=H[Of]||H[0];U.player=Y,k&&(U.syncedPlayer=k,U.paused?U.syncedPlayer.pausedElements.add(U):Y.paused&&Y.play()),(U.isConnected||c?.())&&sf.addAnimation({animation:U,group:U.renderer.animationGroup,observeElement:U.placeholder??U,controlled:!0,type:"emoji"})}),(G instanceof of||G instanceof HTMLVideoElement&&this.isSelectable)&&(k.player=G,i.playersSynced.set(j,G)),G instanceof of&&(G.group=i.animationGroup,G.overrideRender??(G.overrideRender=U=>{vf.set(G,U)})),L){const U=Re(this.size.width,this.size.height);i.canvas.dpr=U,Ht()}});let k;const M=[l,h.width,h.height].join("-");if(L){k=wf.get(M),k||(k={player:void 0,middlewares:new Set,pausedElements:new Set,key:M},wf.set(M,k));for(const N of q){const H=N.middlewareHelper.get();k.middlewares.add(H),H.onClean(()=>{if(N.clear(),k.middlewares.delete(H),!k.middlewares.size){if(k.player){const G=vf.get(k.player);if(G&&(G.close?.(),vf.delete(k.player)),vf.delete(k.player),k.player instanceof of)k.player.overrideRender=rf,k.player.remove();else if(k.player instanceof HTMLVideoElement){const U=_1.generateName(""+N.docId,0,0,void 0,void 0);delete Jf[U]}k.player=void 0}wf.get(k.key)===k&&wf.delete(k.key)&&!wf.size&&Gt()}})}}return $.then(N=>({...N,...J}))},r=[],y=g.map((x,S)=>{if(!x){r.push(n[S]);return}return u(x,m)}).filter(Boolean),w=r.length?o.appEmojiManager.getCustomEmojiDocuments(r).then(x=>c&&!c()?[]:x.filter(Boolean).map(S=>u(S))):Promise.resolve([]),C=x=>Promise.all(x).then(S=>{const l=S.map(({load:q,onRender:j,elements:R})=>{if(!q)return;const b=()=>q().then(j);if(a)R.forEach(E=>{Wf.push({div:E,load:()=>(R.forEach(L=>{Wf.delete({div:L})}),b())})});else return b()});return Promise.all(l)}),v=()=>{if(c&&!c())return;const x=C(y),S=w.then(l=>C(l));return Promise.all([x,S])};return e?e.push({div:i.canvas,load:v}):v(),Promise.all(y).then(()=>Promise.all(m)).then(()=>{})})}setTextColor(f){this.textColor=f}static create(f){const e=new f1;e.animationGroup=f.animationGroup,e.size=f.customEmojiSize||R1.active.customEmoji,e.isSelectable=f.isSelectable,e.textColor=f.textColor,e.observeResizeElement=f.observeResizeElement,f.wrappingDraft&&(e.contentEditable="false",e.style.height="inherit");let t=f.middleware;return t?(e.middlewareHelper=t.create(),t=e.middlewareHelper.get(),t.onDestroy(()=>{e.destroy?.()})):(e.auto=!0,e.middlewareHelper=j1()),e}};f1.globalLazyLoadQueue=Wf;let xf=f1;const Vt=!0;let Df;const Mf=new Set,wf=new Map,vf=new Map,C1=(d=Mf)=>{const e=Array.from(d).filter(s=>s.isConnected&&s.checkForAnyFrame()&&!s.ignoreSettingDimensions);if(!e.length)return!1;const t=e.map(s=>{const i=[...s.playersSynced.values()].reduce((n,o)=>n+ +!!o.paused,0);if(s.playersSynced.size===i)return;const a=s.getOffsets();if(a.size)return[s,a]}).filter(Boolean);for(const[s]of t)s.clearCanvas();for(const[s,i]of t)s.render(i);return!0},zt=60,qt=1e3/zt,Ht=()=>{Df||(Df=window.setInterval(C1,qt),C1())},Gt=()=>{Df&&(clearInterval(Df),Df=void 0)};window.syncedPlayers=wf;window.emojiRenderers=Mf;customElements.define("custom-emoji-renderer-element",xf);function L1(d){return d.replace(/&/g,"&amp;").replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,f=>{const e=f.charCodeAt(0),t=f.charCodeAt(1);return"&#"+((e-55296)*1024+(t-56320)+65536)+";"}).replace(/([^\#-~| |!])/g,f=>"&#"+f.charCodeAt(0)+";").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Wt(d){return Array.from(d.childNodes).map(f=>f.nodeType===f.TEXT_NODE?L1(f.textContent):f.outerHTML).join("")}function Qt(d,f){return d.closest(`[${f}]`)}function $t(d,f){return d.closest(f)}function Ye(d,f){const e=document.getSelection(),t=e[f?"anchorNode":"focusNode"],s=e[f?"anchorOffset":"focusOffset"];return!m1(t,d)&&t!==d?{selection:e}:{...Jt(d,t,s),selection:e}}function Jt(d,f,e){if(f===d){const t=d.childNodes,s=t.length;s&&e>=s?(f=t[s-1],e=(f.textContent||f.alt||"").length):(f=t[e],e=0)}return{node:f,offset:e}}const Xt=new Set(["messageEntityBold","messageEntityItalic","messageEntityCode","messageEntityPre","messageEntityUnderline","messageEntityStrike","messageEntityBlockquote","messageEntitySpoiler"]);function Kt(d){for(let f=0;f<d.length;++f){const e=d[f];let t=-1;do if(t=d.findIndex((s,i)=>Xt.has(s._)&&i!==f&&s._===e._&&s.offset-e.length===e.offset),t!==-1){const s=d[t];e.length+=s.length,d.splice(t,1)}while(t!==-1)}}function Ze(d){d.sort((f,e)=>f.offset-e.offset||e.length-f.length)}const P="\uFEFF",A1={bold:{match:'[style*="bold"], [style*="font-weight: 700"], [style*="font-weight: 600"], [style*="font-weight:700"], [style*="font-weight:600"], b, strong',entityName:"messageEntityBold"},underline:{match:'[style*="underline"], u, ins',entityName:"messageEntityUnderline"},italic:{match:'[style*="italic"], i, em',entityName:"messageEntityItalic"},monospace:{match:'[style*="monospace"], [face*="monospace"], pre',entityName:"messageEntityCode"},strikethrough:{match:'[style*="line-through"], [style*="strikethrough"], strike, del, s',entityName:"messageEntityStrike"},link:{match:"A:not(.follow)",entityName:"messageEntityTextUrl"},mentionName:{match:"A.follow",entityName:"messageEntityMentionName"},spoiler:{match:'[style*="spoiler"]',entityName:"messageEntitySpoiler"},quote:{match:'[style*="quote"], .quote',entityName:"messageEntityBlockquote"}},Yt='[style*="table-cell"], th, td',Zt=new Set(["DIV","P","BR","LI","SECTION","H6","H5","H4","H3","H2","H1","TR","OL","UL","BLOCKQUOTE"]),fd=new RegExp(P,"g"),nf="";function le(d,f,e,t){const s=d.parentElement;for(const i in A1){const a=A1[i],n=s.closest(a.match+', [contenteditable="true"]');if(n?.getAttribute("contenteditable")!==null)continue;let o;a.entityName==="messageEntityCode"&&(o=s.closest("[data-language]"))?e.push({_:"messageEntityPre",language:o.dataset.language||"",offset:t.offset,length:f.length}):a.entityName==="messageEntityTextUrl"?e.push({_:a.entityName,url:n.href,offset:t.offset,length:f.length}):a.entityName==="messageEntityMentionName"?e.push({_:a.entityName,offset:t.offset,length:f.length,user_id:n.dataset.follow.toUserId()}):e.push({_:a.entityName,offset:t.offset,length:f.length})}}function he(d){const{length:f}=d;return!f||d[f-1]===nf&&f===nf.length}function S1(d,f,e,t,s,i,a={offset:0}){if(d.nodeType===d.TEXT_NODE){let r=d.nodeValue;r=r.replace(fd,""),r?(a.isInQuote&&r.endsWith(`