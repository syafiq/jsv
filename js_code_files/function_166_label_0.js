EditorUi.prototype.initCanvas=function(){var b=this.editor.graph;b.timerAutoScroll=!0;b.getPagePadding=function(){return new mxPoint(Math.max(0,Math.round((b.container.offsetWidth-34)/b.view.scale)),Math.max(0,Math.round((b.container.offsetHeight-34)/b.view.scale)))};b.view.getBackgroundPageBounds=function(){var Y=this.graph.getPageLayout(),p=this.graph.getPageSize();return new mxRectangle(this.scale*(this.translate.x+Y.x*p.width),this.scale*(this.translate.y+Y.y*p.height),this.scale*Y.width*p.width,
this.scale*Y.height*p.height)};b.getPreferredPageSize=function(Y,p,E){Y=this.getPageLayout();p=this.getPageSize();return new mxRectangle(0,0,Y.width*p.width,Y.height*p.height)};var e=null,k=this;if(this.editor.isChromelessView()){this.chromelessResize=e=mxUtils.bind(this,function(Y,p,E,Q){if(null!=b.container&&!b.isViewer()){E=null!=E?E:0;Q=null!=Q?Q:0;var Z=b.pageVisible?b.view.getBackgroundPageBounds():b.getGraphBounds(),W=mxUtils.hasScrollbars(b.container),X=b.view.translate,da=b.view.scale,la=
mxRectangle.fromRectangle(Z);la.x=la.x/da-X.x;la.y=la.y/da-X.y;la.width/=da;la.height/=da;X=b.container.scrollTop;var pa=b.container.scrollLeft,ma=8<=document.documentMode?20:14;if(8==document.documentMode||9==document.documentMode)ma+=3;var qa=b.container.offsetWidth-ma;ma=b.container.offsetHeight-ma;Y=Y?Math.max(.3,Math.min(p||1,qa/la.width)):da;p=(qa-Y*la.width)/2/Y;var za=0==this.lightboxVerticalDivider?0:(ma-Y*la.height)/this.lightboxVerticalDivider/Y;W&&(p=Math.max(p,0),za=Math.max(za,0));if(W||
Z.width<qa||Z.height<ma)b.view.scaleAndTranslate(Y,Math.floor(p-la.x),Math.floor(za-la.y)),b.container.scrollTop=X*Y/da,b.container.scrollLeft=pa*Y/da;else if(0!=E||0!=Q)Z=b.view.translate,b.view.setTranslate(Math.floor(Z.x+E/da),Math.floor(Z.y+Q/da))}});this.chromelessWindowResize=mxUtils.bind(this,function(){this.chromelessResize(!1)});var l=mxUtils.bind(this,function(){this.chromelessWindowResize(!1)});mxEvent.addListener(window,"resize",l);this.destroyFunctions.push(function(){mxEvent.removeListener(window,
"resize",l)});this.editor.addListener("resetGraphView",mxUtils.bind(this,function(){this.chromelessResize(!0)}));this.actions.get("zoomIn").funct=mxUtils.bind(this,function(Y){b.zoomIn();this.chromelessResize(!1)});this.actions.get("zoomOut").funct=mxUtils.bind(this,function(Y){b.zoomOut();this.chromelessResize(!1)});if("0"!=urlParams.toolbar){var B=JSON.parse(decodeURIComponent(urlParams["toolbar-config"]||"{}"));this.chromelessToolbar=document.createElement("div");this.chromelessToolbar.style.position=
"fixed";this.chromelessToolbar.style.overflow="hidden";this.chromelessToolbar.style.boxSizing="border-box";this.chromelessToolbar.style.whiteSpace="nowrap";this.chromelessToolbar.style.padding="10px 10px 8px 10px";this.chromelessToolbar.style.left=b.isViewer()?"0":"50%";mxClient.IS_IE||mxClient.IS_IE11?(this.chromelessToolbar.style.backgroundColor="#ffffff",this.chromelessToolbar.style.border="3px solid black"):this.chromelessToolbar.style.backgroundColor="#000000";mxUtils.setPrefixedStyle(this.chromelessToolbar.style,
"borderRadius","16px");mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"transition","opacity 600ms ease-in-out");var q=mxUtils.bind(this,function(){var Y=mxUtils.getCurrentStyle(b.container);b.isViewer()?this.chromelessToolbar.style.top="0":this.chromelessToolbar.style.bottom=(null!=Y?parseInt(Y["margin-bottom"]||0):0)+(null!=this.tabContainer?20+parseInt(this.tabContainer.style.height):20)+"px"});this.editor.addListener("resetGraphView",q);q();var D=0;q=mxUtils.bind(this,function(Y,p,E){D++;
var Q=document.createElement("span");Q.style.paddingLeft="8px";Q.style.paddingRight="8px";Q.style.cursor="pointer";mxEvent.addListener(Q,"click",Y);null!=E&&Q.setAttribute("title",E);Y=document.createElement("img");Y.setAttribute("border","0");Y.setAttribute("src",p);Y.style.width="36px";Y.style.filter="invert(100%)";Q.appendChild(Y);this.chromelessToolbar.appendChild(Q);return Q});if(null!=B.backBtn){var N=Graph.sanitizeLink(B.backBtn.url);null!=N&&q(mxUtils.bind(this,function(Y){window.location.href=
N;mxEvent.consume(Y)}),Editor.backImage,mxResources.get("back",null,"Back"))}if(this.isPagesEnabled()){var S=q(mxUtils.bind(this,function(Y){this.actions.get("previousPage").funct();mxEvent.consume(Y)}),Editor.previousImage,mxResources.get("previousPage")),F=document.createElement("div");F.style.fontFamily=Editor.defaultHtmlFont;F.style.display="inline-block";F.style.verticalAlign="top";F.style.fontWeight="bold";F.style.marginTop="8px";F.style.fontSize="14px";F.style.color=mxClient.IS_IE||mxClient.IS_IE11?
"#000000":"#ffffff";this.chromelessToolbar.appendChild(F);var K=q(mxUtils.bind(this,function(Y){this.actions.get("nextPage").funct();mxEvent.consume(Y)}),Editor.nextImage,mxResources.get("nextPage")),R=mxUtils.bind(this,function(){null!=this.pages&&1<this.pages.length&&null!=this.currentPage&&(F.innerText="",mxUtils.write(F,mxUtils.indexOf(this.pages,this.currentPage)+1+" / "+this.pages.length))});S.style.paddingLeft="0px";S.style.paddingRight="4px";K.style.paddingLeft="4px";K.style.paddingRight=
"0px";var d=mxUtils.bind(this,function(){null!=this.pages&&1<this.pages.length&&null!=this.currentPage?(K.style.display="",S.style.display="",F.style.display="inline-block"):(K.style.display="none",S.style.display="none",F.style.display="none");R()});this.editor.addListener("resetGraphView",d);this.editor.addListener("pageSelected",R)}q(mxUtils.bind(this,function(Y){this.actions.get("zoomOut").funct();mxEvent.consume(Y)}),Editor.zoomOutImage,mxResources.get("zoomOut")+" (Alt+Mousewheel)");q(mxUtils.bind(this,
function(Y){this.actions.get("zoomIn").funct();mxEvent.consume(Y)}),Editor.zoomInImage,mxResources.get("zoomIn")+" (Alt+Mousewheel)");q(mxUtils.bind(this,function(Y){b.isLightboxView()?(1==b.view.scale?this.lightboxFit():b.zoomTo(1),this.chromelessResize(!1)):this.chromelessResize(!0);mxEvent.consume(Y)}),Editor.zoomFitImage,mxResources.get("fit"));var f=null,g=null,u=mxUtils.bind(this,function(Y){null!=f&&(window.clearTimeout(f),f=null);null!=g&&(window.clearTimeout(g),g=null);f=window.setTimeout(mxUtils.bind(this,
function(){mxUtils.setOpacity(this.chromelessToolbar,0);f=null;g=window.setTimeout(mxUtils.bind(this,function(){this.chromelessToolbar.style.display="none";g=null}),600)}),Y||200)}),x=mxUtils.bind(this,function(Y){null!=f&&(window.clearTimeout(f),f=null);null!=g&&(window.clearTimeout(g),g=null);this.chromelessToolbar.style.display="";mxUtils.setOpacity(this.chromelessToolbar,Y||30)});if("1"==urlParams.layers){this.layersDialog=null;var A=q(mxUtils.bind(this,function(Y){if(null!=this.layersDialog)this.layersDialog.parentNode.removeChild(this.layersDialog),
this.layersDialog=null;else{this.layersDialog=b.createLayersDialog(null,!0);mxEvent.addListener(this.layersDialog,"mouseleave",mxUtils.bind(this,function(){this.layersDialog.parentNode.removeChild(this.layersDialog);this.layersDialog=null}));var p=A.getBoundingClientRect();mxUtils.setPrefixedStyle(this.layersDialog.style,"borderRadius","5px");this.layersDialog.style.position="fixed";this.layersDialog.style.fontFamily=Editor.defaultHtmlFont;this.layersDialog.style.width="160px";this.layersDialog.style.padding=
"4px 2px 4px 2px";this.layersDialog.style.left=p.left+"px";this.layersDialog.style.bottom=parseInt(this.chromelessToolbar.style.bottom)+this.chromelessToolbar.offsetHeight+4+"px";mxClient.IS_IE||mxClient.IS_IE11?(this.layersDialog.style.backgroundColor="#ffffff",this.layersDialog.style.border="2px solid black",this.layersDialog.style.color="#000000"):(this.layersDialog.style.backgroundColor="#000000",this.layersDialog.style.color="#ffffff",mxUtils.setOpacity(this.layersDialog,80));p=mxUtils.getCurrentStyle(this.editor.graph.container);
this.layersDialog.style.zIndex=p.zIndex;document.body.appendChild(this.layersDialog);this.editor.fireEvent(new mxEventObject("layersDialogShown"))}mxEvent.consume(Y)}),Editor.layersImage,mxResources.get("layers")),H=b.getModel();H.addListener(mxEvent.CHANGE,function(){A.style.display=1<H.getChildCount(H.root)?"":"none"})}("1"!=urlParams.openInSameWin||navigator.standalone)&&this.addChromelessToolbarItems(q);null==this.editor.editButtonLink&&null==this.editor.editButtonFunc||q(mxUtils.bind(this,function(Y){null!=
this.editor.editButtonFunc?this.editor.editButtonFunc():"_blank"==this.editor.editButtonLink?this.editor.editAsNew(this.getEditBlankXml()):b.openLink(this.editor.editButtonLink,"editWindow");mxEvent.consume(Y)}),Editor.editImage,mxResources.get("edit"));if(null!=this.lightboxToolbarActions)for(d=0;d<this.lightboxToolbarActions.length;d++){var P=this.lightboxToolbarActions[d];P.elem=q(P.fn,P.icon,P.tooltip)}if(null!=B.refreshBtn){var M=null==B.refreshBtn.url?null:Graph.sanitizeLink(B.refreshBtn.url);
q(mxUtils.bind(this,function(Y){null!=M?window.location.href=M:window.location.reload();mxEvent.consume(Y)}),Editor.refreshImage,mxResources.get("refresh",null,"Refresh"))}null!=B.fullscreenBtn&&window.self!==window.top&&q(mxUtils.bind(this,function(Y){B.fullscreenBtn.url?b.openLink(B.fullscreenBtn.url):b.openLink(window.location.href);mxEvent.consume(Y)}),Editor.fullscreenImage,mxResources.get("openInNewWindow",null,"Open in New Window"));(B.closeBtn&&window.self===window.top||b.lightbox&&("1"==
urlParams.close||this.container!=document.body))&&q(mxUtils.bind(this,function(Y){"1"==urlParams.close||B.closeBtn?window.close():(this.destroy(),mxEvent.consume(Y))}),Editor.closeImage,mxResources.get("close")+" (Escape)");this.chromelessToolbar.style.display="none";b.isViewer()||mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"transform","translate(-50%,0)");b.container.appendChild(this.chromelessToolbar);mxEvent.addListener(b.container,mxClient.IS_POINTER?"pointermove":"mousemove",mxUtils.bind(this,
function(Y){mxEvent.isTouchEvent(Y)||(mxEvent.isShiftDown(Y)||x(30),u())}));mxEvent.addListener(this.chromelessToolbar,mxClient.IS_POINTER?"pointermove":"mousemove",function(Y){mxEvent.consume(Y)});mxEvent.addListener(this.chromelessToolbar,"mouseenter",mxUtils.bind(this,function(Y){b.tooltipHandler.resetTimer();b.tooltipHandler.hideTooltip();mxEvent.isShiftDown(Y)?u():x(100)}));mxEvent.addListener(this.chromelessToolbar,"mousemove",mxUtils.bind(this,function(Y){mxEvent.isShiftDown(Y)?u():x(100);
mxEvent.consume(Y)}));mxEvent.addListener(this.chromelessToolbar,"mouseleave",mxUtils.bind(this,function(Y){mxEvent.isTouchEvent(Y)||x(30)}));var G=b.getTolerance();b.addMouseListener({startX:0,startY:0,scrollLeft:0,scrollTop:0,mouseDown:function(Y,p){this.startX=p.getGraphX();this.startY=p.getGraphY();this.scrollLeft=b.container.scrollLeft;this.scrollTop=b.container.scrollTop},mouseMove:function(Y,p){},mouseUp:function(Y,p){mxEvent.isTouchEvent(p.getEvent())&&Math.abs(this.scrollLeft-b.container.scrollLeft)<
G&&Math.abs(this.scrollTop-b.container.scrollTop)<G&&Math.abs(this.startX-p.getGraphX())<G&&Math.abs(this.startY-p.getGraphY())<G&&(0<parseFloat(k.chromelessToolbar.style.opacity||0)?u():x(30))}})}this.editor.editable||this.addChromelessClickHandler()}else if(this.editor.extendCanvas){var ia=b.view.validate;b.view.validate=function(){if(null!=this.graph.container&&mxUtils.hasScrollbars(this.graph.container)){var Y=this.graph.getPagePadding(),p=this.graph.getPageSize();this.translate.x=Y.x-(this.x0||
0)*p.width;this.translate.y=Y.y-(this.y0||0)*p.height}ia.apply(this,arguments)};if(!b.isViewer()){var ja=b.sizeDidChange;b.sizeDidChange=function(){if(null!=this.container&&mxUtils.hasScrollbars(this.container)){var Y=this.getPageLayout(),p=this.getPagePadding(),E=this.getPageSize(),Q=Math.ceil(2*p.x+Y.width*E.width),Z=Math.ceil(2*p.y+Y.height*E.height),W=b.minimumGraphSize;if(null==W||W.width!=Q||W.height!=Z)b.minimumGraphSize=new mxRectangle(0,0,Q,Z);Q=p.x-Y.x*E.width;p=p.y-Y.y*E.height;this.autoTranslate||
this.view.translate.x==Q&&this.view.translate.y==p?ja.apply(this,arguments):(this.autoTranslate=!0,this.view.x0=Y.x,this.view.y0=Y.y,Y=b.view.translate.x,E=b.view.translate.y,b.view.setTranslate(Q,p),b.container.scrollLeft+=Math.round((Q-Y)*b.view.scale),b.container.scrollTop+=Math.round((p-E)*b.view.scale),this.autoTranslate=!1)}else this.fireEvent(new mxEventObject(mxEvent.SIZE,"bounds",this.getGraphBounds()))}}}var ha=b.view.getBackgroundPane(),ba=b.view.getDrawPane();b.cumulativeZoomFactor=1;
var oa=null,sa=null,J=null,V=null,T=null,ca=function(Y){null!=oa&&window.clearTimeout(oa);0<=Y&&window.setTimeout(function(){if(!b.isMouseDown||V)oa=window.setTimeout(mxUtils.bind(this,function(){b.isFastZoomEnabled()&&(null!=b.view.backgroundPageShape&&null!=b.view.backgroundPageShape.node&&(mxUtils.setPrefixedStyle(b.view.backgroundPageShape.node.style,"transform-origin",null),mxUtils.setPrefixedStyle(b.view.backgroundPageShape.node.style,"transform",null)),ba.style.transformOrigin="",ha.style.transformOrigin=
"",mxClient.IS_SF?(ba.style.transform="scale(1)",ha.style.transform="scale(1)",window.setTimeout(function(){ba.style.transform="";ha.style.transform=""},0)):(ba.style.transform="",ha.style.transform=""),b.view.getDecoratorPane().style.opacity="",b.view.getOverlayPane().style.opacity="");var p=new mxPoint(b.container.scrollLeft,b.container.scrollTop),E=mxUtils.getOffset(b.container),Q=b.view.scale,Z=0,W=0;null!=sa&&(Z=b.container.offsetWidth/2-sa.x+E.x,W=b.container.offsetHeight/2-sa.y+E.y);b.zoom(b.cumulativeZoomFactor,
null,b.isFastZoomEnabled()?20:null);b.view.scale!=Q&&(null!=J&&(Z+=p.x-J.x,W+=p.y-J.y),null!=e&&k.chromelessResize(!1,null,Z*(b.cumulativeZoomFactor-1),W*(b.cumulativeZoomFactor-1)),!mxUtils.hasScrollbars(b.container)||0==Z&&0==W||(b.container.scrollLeft-=Z*(b.cumulativeZoomFactor-1),b.container.scrollTop-=W*(b.cumulativeZoomFactor-1)));null!=T&&ba.setAttribute("filter",T);b.cumulativeZoomFactor=1;T=V=sa=J=oa=null}),null!=Y?Y:b.isFastZoomEnabled()?k.wheelZoomDelay:k.lazyZoomDelay)},0)};b.lazyZoom=
function(Y,p,E,Q){Q=null!=Q?Q:this.zoomFactor;(p=p||!b.scrollbars)&&(sa=new mxPoint(b.container.offsetLeft+b.container.clientWidth/2,b.container.offsetTop+b.container.clientHeight/2));Y?.15>=this.view.scale*this.cumulativeZoomFactor?this.cumulativeZoomFactor*=(this.view.scale+.05)/this.view.scale:(this.cumulativeZoomFactor*=Q,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*100)/100/this.view.scale):.15>=this.view.scale*this.cumulativeZoomFactor?this.cumulativeZoomFactor*=
(this.view.scale-.05)/this.view.scale:(this.cumulativeZoomFactor/=Q,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*100)/100/this.view.scale);this.cumulativeZoomFactor=Math.max(.05,Math.min(this.view.scale*this.cumulativeZoomFactor,160))/this.view.scale;b.isFastZoomEnabled()&&(null==T&&""!=ba.getAttribute("filter")&&(T=ba.getAttribute("filter"),ba.removeAttribute("filter")),J=new mxPoint(b.container.scrollLeft,b.container.scrollTop),Y=p||null==sa?b.container.scrollLeft+