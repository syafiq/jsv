`+s.getProgramInfoLog(i);s.deleteShader(e),s.deleteShader(t),this.timeHandle=s.getUniformLocation(i,"time"),this.deltaTimeHandle=s.getUniformLocation(i,"deltaTime"),this.sizeHandle=s.getUniformLocation(i,"size"),this.resetHandle=s.getUniformLocation(i,"reset"),this.radiusHandle=s.getUniformLocation(i,"r"),this.seedHandle=s.getUniformLocation(i,"seed"),this.noiseScaleHandle=s.getUniformLocation(i,"noiseScale"),this.noiseSpeedHandle=s.getUniformLocation(i,"noiseSpeed"),this.dampingMultHandle=s.getUniformLocation(i,"dampingMult"),this.velocityMultHandle=s.getUniformLocation(i,"velocityMult"),this.forceMultHandle=s.getUniformLocation(i,"forceMult"),this.longevityHandle=s.getUniformLocation(i,"longevity"),this.maxVelocityHandle=s.getUniformLocation(i,"maxVelocity"),this.noiseMovementHandle=s.getUniformLocation(i,"noiseMovement"),this.colorHandle=s.getUniformLocation(i,"color"),s.clearColor(0,0,0,0),s.viewport(0,0,this.canvas.width,this.canvas.height),s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),this.inited=!0,this.lastDrawTime=Date.now()}init(){return Xs(this.compileShaders(),e=>{this._init(...e),this.draw()})}destroy(){this.buffer&&(this.context.deleteBuffer(this.buffer[0]),this.context.deleteBuffer(this.buffer[1])),this.buffer=null,this.context.deleteProgram(this.program),this.program=null}static create({width:e,height:t,middleware:s,animationGroup:i,multiply:n,config:a}){const r=++this.createdIndex,l=new cr,{canvas:c}=l,d=r%4===1,h=r%4===2,u=r%4===3,p=[d&&"rotate(180deg)",h&&"scaleX(-1)",u&&"scaleY(-1)"].filter(Boolean);return p.length&&(c.style.transform=p.join(" ")),ut.addAnimation({animation:l,group:i,observeElement:l.canvas,controlled:s,type:"dots"}),{dotRenderer:l,readyResult:e&&(l.resize(e,t,n,a),l.init())}}};cr.shaderTexts={},cr.createdIndex=-1;let oc=cr;function Dp(o){const{mediaSpoiler:e,reveal:t,destroyAfter:s}=o;vt({element:e,forwards:t,className:"is-revealing",duration:250,onTransitionEnd:()=>{t&&s&&(e.remove(),e.middlewareHelper.destroy())}})}function Ub(o){const{mediaSpoiler:e,event:t}=o;if(X(t),e.classList.contains("is-revealing"))return;const s=e.parentElement.querySelector("video");s&&!e.parentElement.querySelector(".video-play")&&(s.autoplay=!0,Pi(s)),Dp({mediaSpoiler:e,reveal:!0,destroyAfter:!0})}function u0(o){const{middleware:e,image:t}=o;if(!e())return;t.classList.add("media-spoiler-thumbnail");const s=document.createElement("div");s.classList.add("media-spoiler-container"),s.middlewareHelper=e.create();const{dotRenderer:i,readyResult:n}=oc.create({...o,middleware:s.middlewareHelper.get()});return s.append(t,i.canvas),{container:s,readyResult:n}}async function eu(o){const{media:e}=o,s=(e.sizes||e.thumbs).find(l=>l._==="photoStrippedSize");if(!s)return;const{image:i,loadPromise:n}=lp(e,s,!0);await n;const{container:a,readyResult:r}=u0({...o,image:i});return r instanceof Promise&&await r,a}function Df({messages:o,attachmentDiv:e,middleware:t,uploading:s,lazyLoadQueue:i,isOut:n,chat:a,loadPromises:r,autoDownload:l,managers:c=C.managers,animationGroup:d}){const h=[];for(const f of o){const y=Hs(f,!0),v=y._==="photo"?ji(y,480,480):{w:y.w,h:y.h};h.push({size:v,media:y,message:f})}Ob({container:e,items:h.map(f=>({w:f.size.w,h:f.size.h})),maxWidth:Fe.active.album.width,minWidth:100,spacing:1,forMedia:!0});const{width:u,height:p}=e.style,m=parseInt(u),g=parseInt(p);h.forEach((f,y)=>{const{size:v,media:b,message:w}=f,I=!!w.media.pFlags?.spoiler,L=e.children[y];L.dataset.mid=""+w.mid,L.dataset.peerId=""+w.peerId;const M=L.firstElementChild,P=b._==="photo";let E;if(P?E=Ns({photo:b,message:w,container:M,boxWidth:0,boxHeight:0,isOut:n,lazyLoadQueue:i,middleware:t,size:v,loadPromises:r,autoDownloadSize:l.photo,managers:c}):E=On({doc:b,container:M,message:w,boxWidth:0,boxHeight:0,withTail:!1,isOut:n,lazyLoadQueue:i,middleware:t,loadPromises:r,autoDownload:l,managers:c,noAutoplayAttribute:I}),E&&r?.push(E),I){const k=(E||Promise.resolve()).then(async()=>{if(!t())return;const{width:A,height:x}=L.style,T=+A.slice(0,-1)/100*m,O=+x.slice(0,-1)/100*g,F=await eu({media:b,animationGroup:d,middleware:t,width:T,height:O});t()&&M.append(F)});r?.push(k)}})}const p0={Á:"A",Ă:"A",Ắ:"A",Ặ:"A",Ằ:"A",Ẳ:"A",Ẵ:"A",Ǎ:"A",Â:"A",Ấ:"A",Ậ:"A",Ầ:"A",Ẩ:"A",Ẫ:"A",Ä:"A",Ǟ:"A",Ȧ:"A",Ǡ:"A",Ạ:"A",Ȁ:"A",À:"A",Ả:"A",Ȃ:"A",Ā:"A",Ą:"A",Å:"A",Ǻ:"A",Ḁ:"A","Ⱥ":"A",Ã:"A","Ꜳ":"AA",Æ:"AE",Ǽ:"AE",Ǣ:"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY",Ḃ:"B",Ḅ:"B",Ɓ:"B",Ḇ:"B","Ƀ":"B",Ƃ:"B",Ć:"C",Č:"C",Ç:"C",Ḉ:"C",Ĉ:"C",Ċ:"C",Ƈ:"C","Ȼ":"C",Ď:"D",Ḑ:"D",Ḓ:"D",Ḋ:"D",Ḍ:"D",Ɗ:"D",Ḏ:"D",ǲ:"D",ǅ:"D",Đ:"D",Ƌ:"D",Ǳ:"DZ",Ǆ:"DZ",É:"E",Ĕ:"E",Ě:"E",Ȩ:"E",Ḝ:"E",Ê:"E",Ế:"E",Ệ:"E",Ề:"E",Ể:"E",Ễ:"E",Ḙ:"E",Ë:"E",Ė:"E",Ẹ:"E",Ȅ:"E",È:"E",Ẻ:"E",Ȇ:"E",Ē:"E",Ḗ:"E",Ḕ:"E",Ę:"E","Ɇ":"E",Ẽ:"E",Ḛ:"E","Ꝫ":"ET",Ḟ:"F",Ƒ:"F",Ǵ:"G",Ğ:"G",Ǧ:"G",Ģ:"G",Ĝ:"G",Ġ:"G",Ɠ:"G",Ḡ:"G",Ǥ:"G",Ḫ:"H",Ȟ:"H",Ḩ:"H",Ĥ:"H","Ⱨ":"H",Ḧ:"H",Ḣ:"H",Ḥ:"H",Ħ:"H",Í:"I",Ĭ:"I",Ǐ:"I",Î:"I",Ï:"I",Ḯ:"I",İ:"I",Ị:"I",Ȉ:"I",Ì:"I",Ỉ:"I",Ȋ:"I",Ī:"I",Į:"I",Ɨ:"I",Ĩ:"I",Ḭ:"I","Ꝺ":"D","Ꝼ":"F","Ᵹ":"G","Ꞃ":"R","Ꞅ":"S","Ꞇ":"T","Ꝭ":"IS",Ĵ:"J","Ɉ":"J",Ḱ:"K",Ǩ:"K",Ķ:"K","Ⱪ":"K","Ꝃ":"K",Ḳ:"K",Ƙ:"K",Ḵ:"K","Ꝁ":"K","Ꝅ":"K",Ĺ:"L","Ƚ":"L",Ľ:"L",Ļ:"L",Ḽ:"L",Ḷ:"L",Ḹ:"L","Ⱡ":"L","Ꝉ":"L",Ḻ:"L",Ŀ:"L","Ɫ":"L",ǈ:"L",Ł:"L",Ǉ:"LJ",Ḿ:"M",Ṁ:"M",Ṃ:"M","Ɱ":"M",Ń:"N",Ň:"N",Ņ:"N",Ṋ:"N",Ṅ:"N",Ṇ:"N",Ǹ:"N",Ɲ:"N",Ṉ:"N","Ƞ":"N",ǋ:"N",Ñ:"N",Ǌ:"NJ",Ó:"O",Ŏ:"O",Ǒ:"O",Ô:"O",Ố:"O",Ộ:"O",Ồ:"O",Ổ:"O",Ỗ:"O",Ö:"O",Ȫ:"O",Ȯ:"O",Ȱ:"O",Ọ:"O",Ő:"O",Ȍ:"O",Ò:"O",Ỏ:"O",Ơ:"O",Ớ:"O",Ợ:"O",Ờ:"O",Ở:"O",Ỡ:"O",Ȏ:"O","Ꝋ":"O","Ꝍ":"O",Ō:"O",Ṓ:"O",Ṑ:"O",Ɵ:"O",Ǫ:"O",Ǭ:"O",Ø:"O",Ǿ:"O",Õ:"O",Ṍ:"O",Ṏ:"O",Ȭ:"O",Ƣ:"OI","Ꝏ":"OO",Ɛ:"E",Ɔ:"O",Ȣ:"OU",Ṕ:"P",Ṗ:"P","Ꝓ":"P",Ƥ:"P","Ꝕ":"P","Ᵽ":"P","Ꝑ":"P","Ꝙ":"Q","Ꝗ":"Q",Ŕ:"R",Ř:"R",Ŗ:"R",Ṙ:"R",Ṛ:"R",Ṝ:"R",Ȑ:"R",Ȓ:"R",Ṟ:"R","Ɍ":"R","Ɽ":"R","Ꜿ":"C",Ǝ:"E",Ś:"S",Ṥ:"S",Š:"S",Ṧ:"S",Ş:"S",Ŝ:"S",Ș:"S",Ṡ:"S",Ṣ:"S",Ṩ:"S","ẞ":"SS",Ť:"T",Ţ:"T",Ṱ:"T",Ț:"T","Ⱦ":"T",Ṫ:"T",Ṭ:"T",Ƭ:"T",Ṯ:"T",Ʈ:"T",Ŧ:"T","Ɐ":"A","Ꞁ":"L",Ɯ:"M","Ʌ":"V","Ꜩ":"TZ",Ú:"U",Ŭ:"U",Ǔ:"U",Û:"U",Ṷ:"U",Ü:"U",Ǘ:"U",Ǚ:"U",Ǜ:"U",Ǖ:"U",Ṳ:"U",Ụ:"U",Ű:"U",Ȕ:"U",Ù:"U",Ủ:"U",Ư:"U",Ứ:"U",Ự:"U",Ừ:"U",Ử:"U",Ữ:"U",Ȗ:"U",Ū:"U",Ṻ:"U",Ų:"U",Ů:"U",Ũ:"U",Ṹ:"U",Ṵ:"U","Ꝟ":"V",Ṿ:"V",Ʋ:"V",Ṽ:"V","Ꝡ":"VY",Ẃ:"W",Ŵ:"W",Ẅ:"W",Ẇ:"W",Ẉ:"W",Ẁ:"W","Ⱳ":"W",Ẍ:"X",Ẋ:"X",Ý:"Y",Ŷ:"Y",Ÿ:"Y",Ẏ:"Y",Ỵ:"Y",Ỳ:"Y",Ƴ:"Y",Ỷ:"Y","Ỿ":"Y",Ȳ:"Y","Ɏ":"Y",Ỹ:"Y",Ź:"Z",Ž:"Z",Ẑ:"Z","Ⱬ":"Z",Ż:"Z",Ẓ:"Z",Ȥ:"Z",Ẕ:"Z",Ƶ:"Z",Ĳ:"IJ",Œ:"OE","ᴀ":"A","ᴁ":"AE",ʙ:"B","ᴃ":"B","ᴄ":"C","ᴅ":"D","ᴇ":"E","ꜰ":"F",ɢ:"G",ʛ:"G",ʜ:"H",ɪ:"I",ʁ:"R","ᴊ":"J","ᴋ":"K",ʟ:"L","ᴌ":"L","ᴍ":"M",ɴ:"N","ᴏ":"O",ɶ:"OE","ᴐ":"O","ᴕ":"OU","ᴘ":"P",ʀ:"R","ᴎ":"N","ᴙ":"R","ꜱ":"S","ᴛ":"T","ⱻ":"E","ᴚ":"R","ᴜ":"U","ᴠ":"V","ᴡ":"W",ʏ:"Y","ᴢ":"Z",á:"a",ă:"a",ắ:"a",ặ:"a",ằ:"a",ẳ:"a",ẵ:"a",ǎ:"a",â:"a",ấ:"a",ậ:"a",ầ:"a",ẩ:"a",ẫ:"a",ä:"a",ǟ:"a",ȧ:"a",ǡ:"a",ạ:"a",ȁ:"a",à:"a",ả:"a",ȃ:"a",ā:"a",ą:"a","ᶏ":"a",ẚ:"a",å:"a",ǻ:"a",ḁ:"a","ⱥ":"a",ã:"a","ꜳ":"aa",æ:"ae",ǽ:"ae",ǣ:"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay",ḃ:"b",ḅ:"b",ɓ:"b",ḇ:"b","ᵬ":"b","ᶀ":"b",ƀ:"b",ƃ:"b",ɵ:"o",ć:"c",č:"c",ç:"c",ḉ:"c",ĉ:"c",ɕ:"c",ċ:"c",ƈ:"c","ȼ":"c",ď:"d",ḑ:"d",ḓ:"d","ȡ":"d",ḋ:"d",ḍ:"d",ɗ:"d","ᶑ":"d",ḏ:"d","ᵭ":"d","ᶁ":"d",đ:"d",ɖ:"d",ƌ:"d",ı:"i","ȷ":"j",ɟ:"j",ʄ:"j",ǳ:"dz",ǆ:"dz",é:"e",ĕ:"e",ě:"e",ȩ:"e",ḝ:"e",ê:"e",ế:"e",ệ:"e",ề:"e",ể:"e",ễ:"e",ḙ:"e",ë:"e",ė:"e",ẹ:"e",ȅ:"e",è:"e",ẻ:"e",ȇ:"e",ē:"e",ḗ:"e",ḕ:"e","ⱸ":"e",ę:"e","ᶒ":"e","ɇ":"e",ẽ:"e",ḛ:"e","ꝫ":"et",ḟ:"f",ƒ:"f","ᵮ":"f","ᶂ":"f",ǵ:"g",ğ:"g",ǧ:"g",ģ:"g",ĝ:"g",ġ:"g",ɠ:"g",ḡ:"g","ᶃ":"g",ǥ:"g",ḫ:"h",ȟ:"h",ḩ:"h",ĥ:"h","ⱨ":"h",ḧ:"h",ḣ:"h",ḥ:"h",ɦ:"h",ẖ:"h",ħ:"h",ƕ:"hv",í:"i",ĭ:"i",ǐ:"i",î:"i",ï:"i",ḯ:"i",ị:"i",ȉ:"i",ì:"i",ỉ:"i",ȋ:"i",ī:"i",į:"i","ᶖ":"i",ɨ:"i",ĩ:"i",ḭ:"i","ꝺ":"d","ꝼ":"f","ᵹ":"g","ꞃ":"r","ꞅ":"s","ꞇ":"t","ꝭ":"is",ǰ:"j",ĵ:"j",ʝ:"j","ɉ":"j",ḱ:"k",ǩ:"k",ķ:"k","ⱪ":"k","ꝃ":"k",ḳ:"k",ƙ:"k",ḵ:"k","ᶄ":"k","ꝁ":"k","ꝅ":"k",ĺ:"l",ƚ:"l",ɬ:"l",ľ:"l",ļ:"l",ḽ:"l","ȴ":"l",ḷ:"l",ḹ:"l","ⱡ":"l","ꝉ":"l",ḻ:"l",ŀ:"l",ɫ:"l","ᶅ":"l",ɭ:"l",ł:"l",ǉ:"lj",ſ:"s","ẜ":"s",ẛ:"s","ẝ":"s",ḿ:"m",ṁ:"m",ṃ:"m",ɱ:"m","ᵯ":"m","ᶆ":"m",ń:"n",ň:"n",ņ:"n",ṋ:"n","ȵ":"n",ṅ:"n",ṇ:"n",ǹ:"n",ɲ:"n",ṉ:"n",ƞ:"n","ᵰ":"n","ᶇ":"n",ɳ:"n",ñ:"n",ǌ:"nj",ó:"o",ŏ:"o",ǒ:"o",ô:"o",ố:"o",ộ:"o",ồ:"o",ổ:"o",ỗ:"o",ö:"o",ȫ:"o",ȯ:"o",ȱ:"o",ọ:"o",ő:"o",ȍ:"o",ò:"o",ỏ:"o",ơ:"o",ớ:"o",ợ:"o",ờ:"o",ở:"o",ỡ:"o",ȏ:"o","ꝋ":"o","ꝍ":"o","ⱺ":"o",ō:"o",ṓ:"o",ṑ:"o",ǫ:"o",ǭ:"o",ø:"o",ǿ:"o",õ:"o",ṍ:"o",ṏ:"o",ȭ:"o",ƣ:"oi","ꝏ":"oo",ɛ:"e","ᶓ":"e",ɔ:"o","ᶗ":"o",ȣ:"ou",ṕ:"p",ṗ:"p","ꝓ":"p",ƥ:"p","ᵱ":"p","ᶈ":"p","ꝕ":"p","ᵽ":"p","ꝑ":"p","ꝙ":"q",ʠ:"q","ɋ":"q","ꝗ":"q",ŕ:"r",ř:"r",ŗ:"r",ṙ:"r",ṛ:"r",ṝ:"r",ȑ:"r",ɾ:"r","ᵳ":"r",ȓ:"r",ṟ:"r",ɼ:"r","ᵲ":"r","ᶉ":"r","ɍ":"r",ɽ:"r","ↄ":"c","ꜿ":"c",ɘ:"e",ɿ:"r",ś:"s",ṥ:"s",š:"s",ṧ:"s",ş:"s",ŝ:"s",ș:"s",ṡ:"s",ṣ:"s",ṩ:"s",ʂ:"s","ᵴ":"s","ᶊ":"s","ȿ":"s",ɡ:"g",ß:"ss","ᴑ":"o","ᴓ":"o","ᴝ":"u",ť:"t",ţ:"t",ṱ:"t",ț:"t","ȶ":"t",ẗ:"t","ⱦ":"t",ṫ:"t",ṭ:"t",ƭ:"t",ṯ:"t","ᵵ":"t",ƫ:"t",ʈ:"t",ŧ:"t","ᵺ":"th",ɐ:"a","ᴂ":"ae",ǝ:"e","ᵷ":"g",ɥ:"h","ʮ":"h","ʯ":"h","ᴉ":"i",ʞ:"k","ꞁ":"l",ɯ:"m",ɰ:"m","ᴔ":"oe",ɹ:"r",ɻ:"r",ɺ:"r","ⱹ":"r",ʇ:"t",ʌ:"v",ʍ:"w",ʎ:"y","ꜩ":"tz",ú:"u",ŭ:"u",ǔ:"u",û:"u",ṷ:"u",ü:"u",ǘ:"u",ǚ:"u",ǜ:"u",ǖ:"u",ṳ:"u",ụ:"u",ű:"u",ȕ:"u",ù:"u",ủ:"u",ư:"u",ứ:"u",ự:"u",ừ:"u",ử:"u",ữ:"u",ȗ:"u",ū:"u",ṻ:"u",ų:"u","ᶙ":"u",ů:"u",ũ:"u",ṹ:"u",ṵ:"u","ᵫ":"ue","ꝸ":"um","ⱴ":"v","ꝟ":"v",ṿ:"v",ʋ:"v","ᶌ":"v","ⱱ":"v",ṽ:"v","ꝡ":"vy",ẃ:"w",ŵ:"w",ẅ:"w",ẇ:"w",ẉ:"w",ẁ:"w","ⱳ":"w",ẘ:"w",ẍ:"x",ẋ:"x","ᶍ":"x",ý:"y",ŷ:"y",ÿ:"y",ẏ:"y",ỵ:"y",ỳ:"y",ƴ:"y",ỷ:"y","ỿ":"y",ȳ:"y",ẙ:"y","ɏ":"y",ỹ:"y",ź:"z",ž:"z",ẑ:"z",ʑ:"z","ⱬ":"z",ż:"z",ẓ:"z",ȥ:"z",ẕ:"z","ᵶ":"z","ᶎ":"z",ʐ:"z",ƶ:"z","ɀ":"z",ﬀ:"ff",ﬃ:"ffi",ﬄ:"ffl",ﬁ:"fi",ﬂ:"fl",ĳ:"ij",œ:"oe",ﬆ:"st","ₐ":"a","ₑ":"e","ᵢ":"i","ⱼ":"j","ₒ":"o","ᵣ":"r","ᵤ":"u","ᵥ":"v","ₓ":"x",Ё:"YO",Й:"I",Ц:"TS",У:"U",К:"K",Е:"E",Н:"N",Г:"G",Ш:"SH",Щ:"SCH",З:"Z",Х:"H",Ъ:"",ё:"yo",й:"i",ц:"ts",у:"u",к:"k",е:"e",н:"n",г:"g",ш:"sh",щ:"sch",з:"z",х:"h",ъ:"",Ф:"F",Ы:"I",В:"V",А:"A",П:"P",Р:"R",О:"O",Л:"L",Д:"D",Ж:"ZH",Э:"E",ф:"f",ы:"i",в:"v",а:"a",п:"p",р:"r",о:"o",л:"l",д:"d",ж:"zh",э:"e",Я:"Ya",Ч:"CH",С:"S",М:"M",И:"I",Т:"T",Ь:"",Б:"B",Ю:"YU",я:"ya",ч:"ch",с:"s",м:"m",и:"i",т:"t",ь:"",б:"b",ю:"yu"},m0=/[`~!@#$%^&*()\-_=+\[\]\\|{}'";:\/?.>,<]+/g,g0=/^\s+|\s$/g,f0={й:"q",ц:"w",у:"e",к:"r",е:"t",н:"y",г:"u",ш:"i",щ:"o",з:"p",х:"[",ъ:"]",ф:"a",ы:"s",в:"d",а:"f",п:"g",р:"h",о:"j",л:"k",д:"l",ж:";",э:"'",я:"z",ч:"x",с:"c",м:"v",и:"b",т:"n",ь:"m",б:",",ю:".",".":"/"};function Hb(o){return o.replace(m0,"").replace(g0,"")}function y0(o){return o.toLowerCase().replace(/[\wа-я]/g,e=>f0[e]??e)}function v0(o){return o.replace(/[^A-Za-z0-9]/g,e=>p0[e]??e)}function b0(o="",e={}){const t=e.includeTag&&o.charAt(0)==="%",s=o;return e.clearBadChars&&(o=Hb(o)),e.latinize&&(o=v0(o)),e.ignoreCase&&(o=o.toLowerCase()),t&&(o="%"+o),e.latinize&&(o+=""+y0(s)),o}C.addEventListener("document_downloading",o=>{Array.from(document.querySelectorAll(`.document[data-doc-id="${o}"]`)).forEach(t=>{t.querySelector(".preloader-container.manual")&&hs(t)})});async function lc({message:o,withTime:e,fontWeight:t,voiceAsMusic:s,showSender:i,searchContext:n,loadPromises:a,autoDownloadSize:r,lazyLoadQueue:l,sizeType:c,managers:d=C.managers,cacheContext:h,fontSize:u,getSize:p,canTranscribeVoice:m}){t??(t=500),c??(c=""),u??(u=16);const g=r===0,f=o.media.document||o.media.webpage.document,y=o?.uploadingFileName;if(f.type==="audio"||f.type==="voice"||f.type==="round"){const K=new eg;return K.withTime=e,K.message=o,K.noAutoDownload=g,K.lazyLoadQueue=l,K.loadPromises=a,m&&f.type==="voice"&&(K.transcriptionState=0),K.getSize=p,s&&(K.voiceAsMusic=s),n&&(K.searchContext=n),i&&(K.showSender=i),K.dataset.fontWeight=""+t,K.dataset.fontSize=""+u,K.dataset.sizeType=c,await K.render(),K}const v=f.file_name?f.file_name.split("."):"";let b="";b=v.length>1&&Array.isArray(v)?Hb(v.pop().split(" ",1)[0].toLowerCase()):"file";const w=document.createElement("div");w.classList.add("document",`ext-${b}`),w.dataset.docId=""+f.id,w.doc=f;const S=document.createElement("div");S.classList.add("document-ico");let I;const L=!!h;h=L?h:fe.getCacheContext(f);let P=!1;if(f.thumbs?.length||o.pFlags.is_outgoing&&h.url&&f.type==="photo"){w.classList.add("document-with-thumb"),P=!0;const K=[];if(o.pFlags.is_outgoing&&["photo","video"].includes(f.type)&&h.url)S.innerHTML=`<img src="${h.url}">`,K.push(S.firstElementChild);else{performance.now();const ee=await Ns({photo:f,message:null,container:S,boxWidth:54,boxHeight:54,loadPromises:a,withoutPreloader:!0,lazyLoadQueue:l,size:ji(f,54,54,!0),managers:d});S.style.width=S.style.height="",ee.images.thumb&&K.push(ee.images.thumb),ee.images.full&&K.push(ee.images.full)}K.forEach(ee=>ee.classList.add("document-thumb"))}else I=document.createElement("span"),I.classList.add("document-ico-text"),I.innerText=b,S.append(I);const E=f.file_name?Rr(f.file_name):"Unknown.file";document.createElement("div").classList.add("document-description");const A=document.createElement("span"),x=na(f.size),T=" / ",O=[x];if(e&&O.push(Ss(o.date)),i&&O.push(await ah(o)),!e&&!i){const K=document.createElement("span"),ee=na(f.size);K.append(T,ee),K.style.visibility="hidden",O.push(K)}w.innerHTML=`
  ${h.downloaded&&!y||!o.mid||!P?"":'<div class="document-download"></div>'}
  <div class="document-name"></div>
  <div class="document-size"></div>
  `;const F=w.querySelector(".document-name"),N=new Zm;N.dataset.fontWeight=""+t,N.dataset.fontSize=""+u,N.dataset.sizeType=c,N.getSize=p,N.textContent=E,o.mid||w.classList.add("downloaded"),F.append(N),i&&F.append(Jm(o));const G=w.querySelector(".document-size");if(A.append(...Ar(O," · ")),G.append(A),w.prepend(S),!y&&o.pFlags.is_outgoing&&!o.mid)return w;let R,B=null;const H=()=>{if(w.classList.remove("downloading"),f.size>Dg&&!y){B.setManual(),B.attach(R),B.preloader.classList.add("manual"),B.setDownloadFunction(W);return}if(f.size<=Dg&&w.classList.add("downloaded"),R){if(R!==S){const K=R;setTimeout(()=>{K.remove()},200)}R=null}B&&(B=null)},z=K=>{w.classList.add("downloading");const ee=document.createElement("span"),_e=na(f.size);ee.style.position="absolute",ee.style.left="0",K.then(H,qt).finally(()=>{A.style.visibility="",ee.remove()});const ae=Ue=>na(Ue);let re=ae(0);A.style.visibility="hidden",ee.append(re,T,_e),A.parentElement.append(ee),K.addNotifyListener(Ue=>{const ye=ae(Ue.done);re.replaceWith(ye),re=ye})},W=K=>{const ee=!K||K.isTrusted,_e=w.doc;let ae;const re=ce.chat.bubbles?ce.chat.bubbles.lazyLoadQueue.queueId:void 0;ee?(_e.type,ia.has(_e.mime_type)&&_e.thumbs?.length?ae=as.downloadMediaURL({media:_e,queueId:re}):(ae=as.downloadToDisc({media:_e,queueId:re}),_e.mime_type==="image/svg+xml"&&ft({descriptionLangKey:"Chat.File.QuickLook.Svg",button:{langKey:"OK",isCancel:!0}}))):ae=as.downloadToDisc({media:_e,queueId:re},!0),ae.catch(()=>{w.classList.remove("downloading")}),R&&(B.attach(R,!0,ae),z(ae))},{fileName:ue}=jC({media:f,downloadId:"1"});if(await d.apiFileManager.isDownloading(ue)){R=w.querySelector(".document-download")||S;const K=as.downloadToDisc({media:f},!0);B=new Qi,B.attach(R,!1,K),B.setDownloadFunction(W),z(K)}else if(!h.downloaded||y)if(R=w.querySelector(".document-download")||S,B=new Qi({isUpload:!!y}),!y)B.construct(),B.setManual(),B.attach(R),B.setDownloadFunction(W),r!==void 0&&r>=f.size&&hs(B.preloader);else{const K=as.getUpload(y);B.attachPromise(K),B.attach(R),z(K)}return D(w,K=>{U(K.target,"time")||(B?B.onClick(K):W(K))}),w}function Bd(o){if(!o)return;const e=o.media?.document;return["voice","audio","video"].includes(e?.type)&&e.duration||void 0}async function w0({albumMustBeRenderedFull:o,message:e,bubble:t,messageDiv:s,chat:i,loadPromises:n,autoDownloadSize:a,lazyLoadQueue:r,searchContext:l,useSearch:c,sizeType:d,managers:h,fontWeight:u,fontSize:p,richTextFragment:m,richTextOptions:g,canTranscribeVoice:f}){let y;const v=o?await i.getMidsByMid(e.mid):[e.mid],b=v.map(async(S,I)=>{const L=i.getMessage(S),M=await lc({message:L,loadPromises:n,autoDownloadSize:a,lazyLoadQueue:r,searchContext:l,sizeType:d,managers:h,fontWeight:u,fontSize:p,canTranscribeVoice:f}),P=document.createElement("div");P.classList.add("document-container"),P.dataset.mid=""+S,P.dataset.peerId=""+L.peerId;const E=document.createElement("div");if(E.classList.add("document-wrapper"),L.message){const k=document.createElement("div");k.classList.add("document-message");let A=m;A||(A=us(L.message,{...g,entities:L.totalEntities,maxMediaTimestamp:Bd(L)})),St(k,A),E.append(k)}if(v.length>1){const k=document.createElement("div");k.classList.add("document-selection"),P.append(k),P.classList.add("grouped-item"),I===0&&(y=E)}return E.append(M),P.append(E),P}),w=await Promise.all(b);return s.append(...w),v.length>1&&t.classList.add("is-multiple-documents","is-grouped"),y}class Bf extends Tt{async init(e){this.container.id="poll-results-container",this.container.classList.add("chatlist-container"),this.resultsDiv=document.createElement("div"),this.resultsDiv.classList.add("poll-results"),this.scrollable.append(this.resultsDiv);const t=await this.managers.appPollsManager.getPoll(e.media.poll.id);this.setTitle(t.poll.pFlags.quiz?"PollResults.Title.Quiz":"PollResults.Title.Poll");const s=document.createElement("h3");St(s,Pe(t.poll.question));const i=t.results.results.map(a=>a.voters/t.results.total_voters*100);$b(i);const n=document.createDocumentFragment();t.results.results.forEach((a,r)=>{if(!a.voters)return;const l=document.createElement("hr"),c=t.poll.answers[r],d=document.createElement("div");d.classList.add("poll-results-answer");const h=document.createElement("div");St(h,Pe(c.text));const u=document.createElement("div");u.innerText=Math.round(i[r])+"%",d.append(h,u);const p=Qe.createChatList();p.classList.add("poll-results-voters"),Qe.setListClickListener({list:p,onFound:()=>{ss.onCloseBtnClick()},withContext:void 0,autonomous:!0}),p.style.minHeight=Math.min(a.voters,4)*48+"px",n.append(l,d,p);let m,g=4,f=!1,y=Math.max(0,a.voters-4);const v=()=>{f||(f=!0,this.managers.appPollsManager.getVotes(e,c.option,m,g).then(w=>{w.votes.forEach(S=>{const{dom:I}=Qe.addDialogNew({peerId:Je(S.peer),container:p,rippleEnabled:!1,meAsSaved:!1,avatarSize:"small",withStories:!1,wrapOptions:{middleware:this.middlewareHelper.get()}});I.lastMessageSpan.parentElement.remove()}),m&&(y=Math.max(0,y-w.votes.length),y&&b.lastElementChild.replaceWith(_("PollResults.LoadMore",[Math.min(20,y)]))),m=w.next_offset,g=20,(!y||!w.votes.length)&&b.remove()}).finally(()=>{f=!1}))},b=Ve("poll-results-more btn btn-primary btn-transparent",{icon:"down"});b.addEventListener("click",v),b.append(_("PollResults.LoadMore",[Math.min(20,y)])),n.append(b),v()}),this.resultsDiv.append(s,n),ss.toggleSidebar(!0).then(()=>{})}}let Nf=0;const S0=9,Yr=10,Vb=340,Of=Vb/Yr,$b=o=>{const e=o.reduce((t,s)=>t+Math.round(s),0);if(e>100){const t=e-100,s=o.length;for(let i=0;i<t;++i){let n=-1,a=1;for(let r=0;r<s;++r){const l=o[r]%1;l>=.5&&l<a&&(a=l,n=r)}if(n===-1)return;o[n]-=a}}else if(e<100){const t=100-e,s=o.length;for(let i=0;i<t;++i){let n=-1,a=0;for(let r=0;r<s;++r){const l=o[r]%1;l<.5&&l>a&&(a=l,n=r)}if(n===-1)return;o[n]+=1-a}}};C.addEventListener("poll_update",({poll:o,results:e})=>{Array.from(document.querySelectorAll(`poll-element[poll-id="${o.id}"]`)).forEach(s=>{s.isClosed=!!o.pFlags.closed,s.performResults(e,o.chosenIndexes)})});Fe.addEventListener("resize",()=>{Pr.setMaxLength(),Pr.resizePolls()});Fe.addEventListener("changeScreen",()=>{Pr.setMaxLength()});const Ou=(o,e,t)=>{o.classList.remove("active"),clearTimeout(t),setTimeout(()=>{e?.(),o.remove(),ar===o&&xl===e&&Al===t&&(ar=xl=null,Al=0)},200)};let ar,xl,Al,Uf=!1;const Gb=o=>{ar&&Ou(ar,xl,Al);const e=document.createElement("div");e.classList.add("quiz-hint","from-"+o.from);const t=document.createElement("div");t.classList.add("quiz-hint-container");const s=document.createElement("div");s.classList.add("quiz-hint-text");let i;o.textRight&&(i=document.createElement("div"),i.classList.add("quiz-hint-text-right"),i.append(o.textRight),t.classList.add("has-right-text")),t.append(...[Le(o.icon,"quiz-hint-icon"),s,i].filter(Boolean)),e.append(t),St(s,o.textElement),o.appendTo.append(e),e.offsetLeft,e.classList.add("active");const n=()=>{Ou(e,o.onHide,a)};ar=e,xl=o.onHide;const a=Al=window.setTimeout(n,o.duration);return Uf||(Uf=!0,ce.addEventListener("peer_changed",()=>{ar&&Ou(ar,xl,Al)})),{hide:n}},dr=class dr extends HTMLElement{constructor(){super(...arguments),this.isClosed=!1,this.isQuiz=!1,this.isRetracted=!1,this.isPublic=!1,this.isMultiple=!1,this.chosenIndexes=[],this.chosingIndexes=[],this.sentVote=!1,this.clickHandler=e=>{const t=U(e.target,"poll-answer");if(!t)return;X(e);const s=+t.dataset.index;if(this.isMultiple){t.classList.toggle("is-chosing");const i=this.chosingIndexes.indexOf(s);i!==-1?this.chosingIndexes.splice(i,1):this.chosingIndexes.push(s)}else this.sendVotes([s])}}static setMaxLength(){const e=nt.width<=360?nt.width-120:Fe.active.poll.width;this.MAX_LENGTH=e+S0+this.MAX_OFFSET+-13.7}static resizePolls(){if(!this.MAX_LENGTH)return;Array.from(document.querySelectorAll("poll-element.is-voted")).forEach(t=>{t.svgLines.forEach((s,i)=>{t.setLineProgress(i,1)})})}async render(){Nf||(Nf=document.getElementById("poll-line").getTotalLength(),dr.setMaxLength());const{poll:e,results:t}=this.message.media;this.message.pFlags.is_scheduled&&this.classList.add("disable-hover");let s;e.pFlags&&(this.isPublic=!!e.pFlags.public_voters,this.isQuiz=!!e.pFlags.quiz,this.isClosed=!!e.pFlags.closed,this.isMultiple=!!e.pFlags.multiple_choice,this.isClosed?(s="Chat.Poll.Type.Closed",this.classList.add("is-closed")):this.isQuiz?s=this.isPublic?"Chat.Poll.Type.Quiz":"Chat.Poll.Type.AnonymousQuiz":s=this.isPublic?"Chat.Poll.Type.Public":"Chat.Poll.Type.Anonymous"),this.classList.toggle("is-multiple",this.isMultiple);const i=e.answers.map((r,l)=>{const c=`