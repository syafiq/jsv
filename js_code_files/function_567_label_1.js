!0),q),x=f;else if(y||null!=this.pages&&this.currentPage!=this.pages[0]){q=this.createTemporaryGraph(y?q.getDefaultStylesheet():q.getStylesheet());var E=q.getGlobalVariable;q.setBackgroundImage=this.editor.graph.setBackgroundImage;var A=this.pages[0];this.currentPage==A?q.setBackgroundImage(this.editor.graph.backgroundImage):null!=A.viewState&&null!=A.viewState&&q.setBackgroundImage(A.viewState.backgroundImage);q.getGlobalVariable=function(S){return"page"==S?A.getName():"pagenumber"==S?1:E.apply(this,
arguments)};document.body.appendChild(q.container);q.model.setRoot(A.root)}this.editor.exportToCanvas(mxUtils.bind(this,function(S){try{null==x&&(x=this.getFileData(!0,null,null,null,null,null,null,null,null,!1));var l=S.toDataURL("image/png");l=Editor.writeGraphModelToPng(l,"tEXt","mxfile",encodeURIComponent(x));c(l.substring(l.lastIndexOf(",")+1));q!=this.editor.graph&&q.container.parentNode.removeChild(q.container)}catch(u){null!=e&&e(u)}}),null,null,null,mxUtils.bind(this,function(S){null!=e&&