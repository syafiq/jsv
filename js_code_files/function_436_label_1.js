EditorUi.prototype.initCanvas=function(){var a=this.editor.graph;a.timerAutoScroll=!0;a.getPagePadding=function(){return new mxPoint(Math.max(0,Math.round((a.container.offsetWidth-34)/a.view.scale)),Math.max(0,Math.round((a.container.offsetHeight-34)/a.view.scale)))};a.view.getBackgroundPageBounds=function(){var J=this.graph.getPageLayout(),aa=this.graph.getPageSize();return new mxRectangle(this.scale*(this.translate.x+J.x*aa.width),this.scale*(this.translate.y+J.y*aa.height),this.scale*J.width*aa.width,
this.scale*J.height*aa.height)};a.getPreferredPageSize=function(J,aa,ia){J=this.getPageLayout();aa=this.getPageSize();return new mxRectangle(0,0,J.width*aa.width,J.height*aa.height)};var b=null,f=this;if(this.editor.isChromelessView()){this.chromelessResize=b=mxUtils.bind(this,function(J,aa,ia,na){if(null!=a.container&&!a.isViewer()){ia=null!=ia?ia:0;na=null!=na?na:0;var W=a.pageVisible?a.view.getBackgroundPageBounds():a.getGraphBounds(),da=mxUtils.hasScrollbars(a.container),sa=a.view.translate,ta=
a.view.scale,Ja=mxRectangle.fromRectangle(W);Ja.x=Ja.x/ta-sa.x;Ja.y=Ja.y/ta-sa.y;Ja.width/=ta;Ja.height/=ta;sa=a.container.scrollTop;var Ia=a.container.scrollLeft,ua=8<=document.documentMode?20:14;if(8==document.documentMode||9==document.documentMode)ua+=3;var Ba=a.container.offsetWidth-ua;ua=a.container.offsetHeight-ua;J=J?Math.max(.3,Math.min(aa||1,Ba/Ja.width)):ta;aa=(Ba-J*Ja.width)/2/J;var qa=0==this.lightboxVerticalDivider?0:(ua-J*Ja.height)/this.lightboxVerticalDivider/J;da&&(aa=Math.max(aa,
0),qa=Math.max(qa,0));if(da||W.width<Ba||W.height<ua)a.view.scaleAndTranslate(J,Math.floor(aa-Ja.x),Math.floor(qa-Ja.y)),a.container.scrollTop=sa*J/ta,a.container.scrollLeft=Ia*J/ta;else if(0!=ia||0!=na)W=a.view.translate,a.view.setTranslate(Math.floor(W.x+ia/ta),Math.floor(W.y+na/ta))}});this.chromelessWindowResize=mxUtils.bind(this,function(){this.chromelessResize(!1)});var e=mxUtils.bind(this,function(){this.chromelessWindowResize(!1)});mxEvent.addListener(window,"resize",e);this.destroyFunctions.push(function(){mxEvent.removeListener(window,
"resize",e)});this.editor.addListener("resetGraphView",mxUtils.bind(this,function(){this.chromelessResize(!0)}));this.actions.get("zoomIn").funct=mxUtils.bind(this,function(J){a.zoomIn();this.chromelessResize(!1)});this.actions.get("zoomOut").funct=mxUtils.bind(this,function(J){a.zoomOut();this.chromelessResize(!1)});if("0"!=urlParams.toolbar){var g=JSON.parse(decodeURIComponent(urlParams["toolbar-config"]||"{}"));this.chromelessToolbar=document.createElement("div");this.chromelessToolbar.style.position=
"fixed";this.chromelessToolbar.style.overflow="hidden";this.chromelessToolbar.style.boxSizing="border-box";this.chromelessToolbar.style.whiteSpace="nowrap";this.chromelessToolbar.style.padding="10px 10px 8px 10px";this.chromelessToolbar.style.left=a.isViewer()?"0":"50%";mxClient.IS_IE||mxClient.IS_IE11?(this.chromelessToolbar.style.backgroundColor="#ffffff",this.chromelessToolbar.style.border="3px solid black"):this.chromelessToolbar.style.backgroundColor="#000000";mxUtils.setPrefixedStyle(this.chromelessToolbar.style,
"borderRadius","16px");mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"transition","opacity 600ms ease-in-out");var d=mxUtils.bind(this,function(){var J=mxUtils.getCurrentStyle(a.container);a.isViewer()?this.chromelessToolbar.style.top="0":this.chromelessToolbar.style.bottom=(null!=J?parseInt(J["margin-bottom"]||0):0)+(null!=this.tabContainer?20+parseInt(this.tabContainer.style.height):20)+"px"});this.editor.addListener("resetGraphView",d);d();var h=0;d=mxUtils.bind(this,function(J,aa,ia){h++;
var na=document.createElement("span");na.style.paddingLeft="8px";na.style.paddingRight="8px";na.style.cursor="pointer";mxEvent.addListener(na,"click",J);null!=ia&&na.setAttribute("title",ia);J=document.createElement("img");J.setAttribute("border","0");J.setAttribute("src",aa);J.style.width="36px";J.style.filter="invert(100%)";na.appendChild(J);this.chromelessToolbar.appendChild(na);return na});if(null!=g.backBtn){var n=Graph.sanitizeLink(g.backBtn.url);null!=n&&d(mxUtils.bind(this,function(J){window.location.href=
n;mxEvent.consume(J)}),Editor.backImage,mxResources.get("back",null,"Back"))}if(this.isPagesEnabled()){var v=d(mxUtils.bind(this,function(J){this.actions.get("previousPage").funct();mxEvent.consume(J)}),Editor.previousImage,mxResources.get("previousPage")),m=document.createElement("div");m.style.fontFamily=Editor.defaultHtmlFont;m.style.display="inline-block";m.style.verticalAlign="top";m.style.fontWeight="bold";m.style.marginTop="8px";m.style.fontSize="14px";m.style.color=mxClient.IS_IE||mxClient.IS_IE11?
"#000000":"#ffffff";this.chromelessToolbar.appendChild(m);var r=d(mxUtils.bind(this,function(J){this.actions.get("nextPage").funct();mxEvent.consume(J)}),Editor.nextImage,mxResources.get("nextPage")),x=mxUtils.bind(this,function(){null!=this.pages&&1<this.pages.length&&null!=this.currentPage&&(m.innerText="",mxUtils.write(m,mxUtils.indexOf(this.pages,this.currentPage)+1+" / "+this.pages.length))});v.style.paddingLeft="0px";v.style.paddingRight="4px";r.style.paddingLeft="4px";r.style.paddingRight=
"0px";var B=mxUtils.bind(this,function(){null!=this.pages&&1<this.pages.length&&null!=this.currentPage?(r.style.display="",v.style.display="",m.style.display="inline-block"):(r.style.display="none",v.style.display="none",m.style.display="none");x()});this.editor.addListener("resetGraphView",B);this.editor.addListener("pageSelected",x)}d(mxUtils.bind(this,function(J){this.actions.get("zoomOut").funct();mxEvent.consume(J)}),Editor.zoomOutImage,mxResources.get("zoomOut")+" (Alt+Mousewheel)");d(mxUtils.bind(this,
function(J){this.actions.get("zoomIn").funct();mxEvent.consume(J)}),Editor.zoomInImage,mxResources.get("zoomIn")+" (Alt+Mousewheel)");d(mxUtils.bind(this,function(J){a.isLightboxView()?(1==a.view.scale?this.lightboxFit():a.zoomTo(1),this.chromelessResize(!1)):this.chromelessResize(!0);mxEvent.consume(J)}),Editor.zoomFitImage,mxResources.get("fit"));var D=null,F=null,H=mxUtils.bind(this,function(J){null!=D&&(window.clearTimeout(D),D=null);null!=F&&(window.clearTimeout(F),F=null);D=window.setTimeout(mxUtils.bind(this,
function(){mxUtils.setOpacity(this.chromelessToolbar,0);D=null;F=window.setTimeout(mxUtils.bind(this,function(){this.chromelessToolbar.style.display="none";F=null}),600)}),J||200)}),C=mxUtils.bind(this,function(J){null!=D&&(window.clearTimeout(D),D=null);null!=F&&(window.clearTimeout(F),F=null);this.chromelessToolbar.style.display="";mxUtils.setOpacity(this.chromelessToolbar,J||30)});if("1"==urlParams.layers){this.layersDialog=null;var N=d(mxUtils.bind(this,function(J){if(null!=this.layersDialog)this.layersDialog.parentNode.removeChild(this.layersDialog),
this.layersDialog=null;else{this.layersDialog=a.createLayersDialog(null,!0);mxEvent.addListener(this.layersDialog,"mouseleave",mxUtils.bind(this,function(){this.layersDialog.parentNode.removeChild(this.layersDialog);this.layersDialog=null}));var aa=N.getBoundingClientRect();mxUtils.setPrefixedStyle(this.layersDialog.style,"borderRadius","5px");this.layersDialog.style.position="fixed";this.layersDialog.style.fontFamily=Editor.defaultHtmlFont;this.layersDialog.style.width="160px";this.layersDialog.style.padding=
"4px 2px 4px 2px";this.layersDialog.style.left=aa.left+"px";this.layersDialog.style.bottom=parseInt(this.chromelessToolbar.style.bottom)+this.chromelessToolbar.offsetHeight+4+"px";mxClient.IS_IE||mxClient.IS_IE11?(this.layersDialog.style.backgroundColor="#ffffff",this.layersDialog.style.border="2px solid black",this.layersDialog.style.color="#000000"):(this.layersDialog.style.backgroundColor="#000000",this.layersDialog.style.color="#ffffff",mxUtils.setOpacity(this.layersDialog,80));aa=mxUtils.getCurrentStyle(this.editor.graph.container);
this.layersDialog.style.zIndex=aa.zIndex;document.body.appendChild(this.layersDialog);this.editor.fireEvent(new mxEventObject("layersDialogShown"))}mxEvent.consume(J)}),Editor.layersImage,mxResources.get("layers")),Q=a.getModel();Q.addListener(mxEvent.CHANGE,function(){N.style.display=1<Q.getChildCount(Q.root)?"":"none"})}("1"!=urlParams.openInSameWin||navigator.standalone)&&this.addChromelessToolbarItems(d);null==this.editor.editButtonLink&&null==this.editor.editButtonFunc||d(mxUtils.bind(this,function(J){null!=
this.editor.editButtonFunc?this.editor.editButtonFunc():"_blank"==this.editor.editButtonLink?this.editor.editAsNew(this.getEditBlankXml()):a.openLink(this.editor.editButtonLink,"editWindow");mxEvent.consume(J)}),Editor.editImage,mxResources.get("edit"));if(null!=this.lightboxToolbarActions)for(B=0;B<this.lightboxToolbarActions.length;B++){var T=this.lightboxToolbarActions[B];T.elem=d(T.fn,T.icon,T.tooltip)}if(null!=g.refreshBtn){var R=null==g.refreshBtn.url?null:Graph.sanitizeLink(g.refreshBtn.url);
d(mxUtils.bind(this,function(J){null!=R?window.location.href=R:window.location.reload();mxEvent.consume(J)}),Editor.refreshImage,mxResources.get("refresh",null,"Refresh"))}null!=g.fullscreenBtn&&window.self!==window.top&&d(mxUtils.bind(this,function(J){g.fullscreenBtn.url?a.openLink(g.fullscreenBtn.url):a.openLink(window.location.href);mxEvent.consume(J)}),Editor.fullscreenImage,mxResources.get("openInNewWindow",null,"Open in New Window"));(g.closeBtn&&window.self===window.top||a.lightbox&&("1"==
urlParams.close||this.container!=document.body))&&d(mxUtils.bind(this,function(J){"1"==urlParams.close||g.closeBtn?window.close():(this.destroy(),mxEvent.consume(J))}),Editor.closeImage,mxResources.get("close")+" (Escape)");this.chromelessToolbar.style.display="none";a.isViewer()||mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"transform","translate(-50%,0)");a.container.appendChild(this.chromelessToolbar);mxEvent.addListener(a.container,mxClient.IS_POINTER?"pointermove":"mousemove",mxUtils.bind(this,
function(J){mxEvent.isTouchEvent(J)||(mxEvent.isShiftDown(J)||C(30),H())}));mxEvent.addListener(this.chromelessToolbar,mxClient.IS_POINTER?"pointermove":"mousemove",function(J){mxEvent.consume(J)});mxEvent.addListener(this.chromelessToolbar,"mouseenter",mxUtils.bind(this,function(J){a.tooltipHandler.resetTimer();a.tooltipHandler.hideTooltip();mxEvent.isShiftDown(J)?H():C(100)}));mxEvent.addListener(this.chromelessToolbar,"mousemove",mxUtils.bind(this,function(J){mxEvent.isShiftDown(J)?H():C(100);
mxEvent.consume(J)}));mxEvent.addListener(this.chromelessToolbar,"mouseleave",mxUtils.bind(this,function(J){mxEvent.isTouchEvent(J)||C(30)}));var ba=a.getTolerance();a.addMouseListener({startX:0,startY:0,scrollLeft:0,scrollTop:0,mouseDown:function(J,aa){this.startX=aa.getGraphX();this.startY=aa.getGraphY();this.scrollLeft=a.container.scrollLeft;this.scrollTop=a.container.scrollTop},mouseMove:function(J,aa){},mouseUp:function(J,aa){mxEvent.isTouchEvent(aa.getEvent())&&Math.abs(this.scrollLeft-a.container.scrollLeft)<
ba&&Math.abs(this.scrollTop-a.container.scrollTop)<ba&&Math.abs(this.startX-aa.getGraphX())<ba&&Math.abs(this.startY-aa.getGraphY())<ba&&(0<parseFloat(f.chromelessToolbar.style.opacity||0)?H():C(30))}})}this.editor.editable||this.addChromelessClickHandler()}else if(this.editor.extendCanvas){var S=a.view.validate;a.view.validate=function(){if(null!=this.graph.container&&mxUtils.hasScrollbars(this.graph.container)){var J=this.graph.getPagePadding(),aa=this.graph.getPageSize();this.translate.x=J.x-(this.x0||
0)*aa.width;this.translate.y=J.y-(this.y0||0)*aa.height}S.apply(this,arguments)};if(!a.isViewer()){var P=a.sizeDidChange;a.sizeDidChange=function(){if(null!=this.container&&mxUtils.hasScrollbars(this.container)){var J=this.getPageLayout(),aa=this.getPagePadding(),ia=this.getPageSize(),na=Math.ceil(2*aa.x+J.width*ia.width),W=Math.ceil(2*aa.y+J.height*ia.height),da=a.minimumGraphSize;if(null==da||da.width!=na||da.height!=W)a.minimumGraphSize=new mxRectangle(0,0,na,W);na=aa.x-J.x*ia.width;aa=aa.y-J.y*
ia.height;this.autoTranslate||this.view.translate.x==na&&this.view.translate.y==aa?P.apply(this,arguments):(this.autoTranslate=!0,this.view.x0=J.x,this.view.y0=J.y,J=a.view.translate.x,ia=a.view.translate.y,a.view.setTranslate(na,aa),a.container.scrollLeft+=Math.round((na-J)*a.view.scale),a.container.scrollTop+=Math.round((aa-ia)*a.view.scale),this.autoTranslate=!1)}else this.fireEvent(new mxEventObject(mxEvent.SIZE,"bounds",this.getGraphBounds()))}}}var X=a.view.getBackgroundPane(),ja=a.view.getDrawPane();
a.cumulativeZoomFactor=1;var fa=null,ra=null,K=null,V=null,O=null,U=function(J){null!=fa&&window.clearTimeout(fa);0<=J&&window.setTimeout(function(){if(!a.isMouseDown||V)fa=window.setTimeout(mxUtils.bind(this,function(){a.isFastZoomEnabled()&&(null!=a.view.backgroundPageShape&&null!=a.view.backgroundPageShape.node&&(mxUtils.setPrefixedStyle(a.view.backgroundPageShape.node.style,"transform-origin",null),mxUtils.setPrefixedStyle(a.view.backgroundPageShape.node.style,"transform",null)),ja.style.transformOrigin=
"",X.style.transformOrigin="",mxClient.IS_SF?(ja.style.transform="scale(1)",X.style.transform="scale(1)",window.setTimeout(function(){ja.style.transform="";X.style.transform=""},0)):(ja.style.transform="",X.style.transform=""),a.view.getDecoratorPane().style.opacity="",a.view.getOverlayPane().style.opacity="");var aa=new mxPoint(a.container.scrollLeft,a.container.scrollTop),ia=mxUtils.getOffset(a.container),na=a.view.scale,W=0,da=0;null!=ra&&(W=a.container.offsetWidth/2-ra.x+ia.x,da=a.container.offsetHeight/
2-ra.y+ia.y);a.zoom(a.cumulativeZoomFactor,null,a.isFastZoomEnabled()?20:null);a.view.scale!=na&&(null!=K&&(W+=aa.x-K.x,da+=aa.y-K.y),null!=b&&f.chromelessResize(!1,null,W*(a.cumulativeZoomFactor-1),da*(a.cumulativeZoomFactor-1)),!mxUtils.hasScrollbars(a.container)||0==W&&0==da||(a.container.scrollLeft-=W*(a.cumulativeZoomFactor-1),a.container.scrollTop-=da*(a.cumulativeZoomFactor-1)));null!=O&&ja.setAttribute("filter",O);a.cumulativeZoomFactor=1;O=V=ra=K=fa=null}),null!=J?J:a.isFastZoomEnabled()?
f.wheelZoomDelay:f.lazyZoomDelay)},0)};a.lazyZoom=function(J,aa,ia,na){na=null!=na?na:this.zoomFactor;(aa=aa||!a.scrollbars)&&(ra=new mxPoint(a.container.offsetLeft+a.container.clientWidth/2,a.container.offsetTop+a.container.clientHeight/2));J?.15>=this.view.scale*this.cumulativeZoomFactor?this.cumulativeZoomFactor*=(this.view.scale+.05)/this.view.scale:(this.cumulativeZoomFactor*=na,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*100)/100/this.view.scale):.15>=this.view.scale*
this.cumulativeZoomFactor?this.cumulativeZoomFactor*=(this.view.scale-.05)/this.view.scale:(this.cumulativeZoomFactor/=na,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*100)/100/this.view.scale);this.cumulativeZoomFactor=Math.max(.05,Math.min(this.view.scale*this.cumulativeZoomFactor,160))/this.view.scale;a.isFastZoomEnabled()&&(null==O&&""!=ja.getAttribute("filter")&&(O=ja.getAttribute("filter"),ja.removeAttribute("filter")),K=new mxPoint(a.container.scrollLeft,a.container.scrollTop),