!0),v),C=k;else if(E||null!=this.pages&&this.currentPage!=this.pages[0]){v=this.createTemporaryGraph(E?v.getDefaultStylesheet():v.getStylesheet());var H=v.getGlobalVariable;v.setBackgroundImage=this.editor.graph.setBackgroundImage;var F=this.pages[0];this.currentPage==F?v.setBackgroundImage(this.editor.graph.backgroundImage):null!=F.viewState&&null!=F.viewState&&v.setBackgroundImage(F.viewState.backgroundImage);v.getGlobalVariable=function(T){return"page"==T?F.getName():"pagenumber"==T?1:H.apply(this,
arguments)};document.body.appendChild(v.container);v.model.setRoot(F.root)}this.editor.exportToCanvas(mxUtils.bind(this,function(T){try{null==C&&(C=this.getFileData(!0,null,null,null,null,null,null,null,null,!1));var p=T.toDataURL("image/png");p=Editor.writeGraphModelToPng(p,"tEXt","mxfile",encodeURIComponent(C));e(p.substring(p.lastIndexOf(",")+1));v!=this.editor.graph&&v.container.parentNode.removeChild(v.container)}catch(x){null!=g&&g(x)}}),null,null,null,mxUtils.bind(this,function(T){null!=g&&