"cells",[L])),b.fireEvent(new mxEventObject("freehandInserted","cell",L))}finally{b.model.endUpdate()}q&&b.setSelectionCells([L])}}for(L=0;L<u.length;L++)u[L].parentNode.removeChild(u[L]);d=null;u=[];A=[]}B(!1)};b.addListener(mxEvent.FIRE_MOUSE_EVENT,mxUtils.bind(this,function(H,L){H=L.getProperty("eventName");L=L.getProperty("event");H==mxEvent.MOUSE_MOVE&&g&&(null!=L.sourceState&&L.sourceState.setCursor("crosshair"),L.consume())}));b.addMouseListener({mouseDown:mxUtils.bind(this,function(H,L){if(b.isEnabled()&&
!b.isCellLocked(b.getDefaultParent())&&(H=L.getEvent(),g&&!mxEvent.isPopupTrigger(H)&&!mxEvent.isMultiTouchEvent(H))){var E=parseFloat(b.currentVertexStyle[mxConstants.STYLE_STROKEWIDTH]||1);E=Math.max(1,E*b.view.scale);var M=U();d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("fill",y?M:"none");d.setAttribute("stroke",M);d.setAttribute("stroke-width",E);"1"==b.currentVertexStyle[mxConstants.STYLE_DASHED]&&(M=b.currentVertexStyle[mxConstants.STYLE_DASH_PATTERN]||"3 3",
M=M.split(" ").map(function(P){return parseFloat(P)*E}).join(" "),d.setAttribute("stroke-dasharray",M));e=[];H=m(H);t(H);v="M"+H.x+" "+H.y;A.push(H);F=[];d.setAttribute("d",y?PerfectFreehand.getSvgPathFromStroke([[H.x,H.y]],p):v);f.appendChild(d);L.consume()}}),mouseMove:mxUtils.bind(this,function(H,L){if(d&&b.isEnabled()&&!b.isCellLocked(b.getDefaultParent())){H=L.getEvent();H=m(H);t(H);var E=z(0);if(E)if(A.push(E),y){var M=[];for(E=0;E<A.length;E++)M.push([A[E].x,A[E].y]);F=[];for(var P=2;P<e.length;P+=