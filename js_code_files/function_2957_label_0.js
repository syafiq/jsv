mxJsCanvas.prototype.text=function(b,e,f,c,l,m,t,y,C,z,A,J){if(null!=l&&0!=l.length){f=this.state.scale;0!=J&&(this.ctx.translate(Math.round(b),Math.round(e)),this.ctx.rotate(J*Math.PI/180),this.ctx.translate(Math.round(-b),Math.round(-e)));if("html"==C){l=this.subCanvas[this.canvasIndex++];C=l.height;J=l.width;switch(t){case mxConstants.ALIGN_MIDDLE:e-=C/2/f;break;case mxConstants.ALIGN_BOTTOM:e-=C/f}switch(m){case mxConstants.ALIGN_CENTER:b-=J/2/f;break;case mxConstants.ALIGN_RIGHT:b-=J/f}this.ctx.save();
if(null!=this.state.fontBackgroundColor||null!=this.state.fontBorderColor)null!=this.state.fontBackgroundColor&&(this.ctx.fillStyle=this.state.fontBackgroundColor,this.ctx.fillRect(Math.round(b)-.5,Math.round(e)-.5,Math.round(l.width/f),Math.round(l.height/f))),null!=this.state.fontBorderColor&&(this.ctx.strokeStyle=this.state.fontBorderColor,this.ctx.lineWidth=1,this.ctx.strokeRect(Math.round(b)-.5,Math.round(e)-.5,Math.round(l.width/f),Math.round(l.height/f)));this.ctx.scale(1/f,1/f);this.ctx.drawImage(l,
Math.round(b*f),Math.round(e*f))}else{this.ctx.save();this.updateFont();J=document.createElement("div");J.innerHTML=l;J.style.position="absolute";J.style.top="-9999px";J.style.left="-9999px";J.style.fontFamily=this.state.fontFamily;J.style.fontWeight="bold";J.style.fontSize=this.state.fontSize+"pt";document.body.appendChild(J);C=[J.offsetWidth,J.offsetHeight];document.body.removeChild(J);l=l.split("\n");J=C[1];this.ctx.textBaseline="top";C=e;switch(t){case mxConstants.ALIGN_MIDDLE:this.ctx.textBaseline=
"middle";e-=(l.length-1)*J/2;C=e-this.state.fontSize/2;break;case mxConstants.ALIGN_BOTTOM:this.ctx.textBaseline="alphabetic",e-=J*(l.length-1),C=e-this.state.fontSize}t=[];J=[];for(f=0;f<l.length;f++)J[f]=b,t[f]=this.ctx.measureText(l[f]).width,null!=m&&m!=mxConstants.ALIGN_LEFT&&(J[f]-=t[f],m==mxConstants.ALIGN_CENTER&&(J[f]+=t[f]/2));if(null!=this.state.fontBackgroundColor||null!=this.state.fontBorderColor){b=J[0];m=t[0];for(f=1;f<l.length;f++)b=Math.min(b,J[f]),m=Math.max(m,t[f]);this.ctx.save();
b=Math.round(b)-.5;C=Math.round(C)-.5;null!=this.state.fontBackgroundColor&&(this.ctx.fillStyle=this.state.fontBackgroundColor,this.ctx.fillRect(b,C,m,this.state.fontSize*mxConstants.LINE_HEIGHT*l.length));null!=this.state.fontBorderColor&&(this.ctx.strokeStyle=this.state.fontBorderColor,this.ctx.lineWidth=1,this.ctx.strokeRect(b,C,m,this.state.fontSize*mxConstants.LINE_HEIGHT*l.length));this.ctx.restore()}for(f=0;f<l.length;f++)this.ctx.fillText(l[f],J[f],e),e+=this.state.fontSize*mxConstants.LINE_HEIGHT}this.ctx.restore()}};