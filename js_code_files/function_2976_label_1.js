DrawioFile.prototype.mergeFile=function(b,d,f,c){var l=!0;try{this.stats.fileMerged++;var m=this.getShadowPages(),t=b.getShadowPages();if(null!=t&&0<t.length){var y=[this.ui.diffPages(null!=c?c:m,t)],B=this.ignorePatches(y);this.setShadowPages(t);if(B)EditorUi.debug("File.mergeFile",[this],"file",[b],"ignored",B);else{null!=this.sync&&this.sync.sendLocalChanges();this.backupPatch=this.isModified()?this.ui.diffPages(m,this.ui.pages):null;c={};B={};var z=this.ui.patchPages(m,y[0]),A=this.ui.getHashValueForPages(z,
c),J=this.ui.getHashValueForPages(t,B);EditorUi.debug("File.mergeFile",[this],"file",[b],"shadow",m,"pages",this.ui.pages,"patches",y,"backup",this.backupPatch,"checksum",A,"current",J,"valid",A==J,"from",this.getCurrentRevisionId(),"to",b.getCurrentRevisionId(),"modified",this.isModified());if(null!=A&&A!=J){var e=this.compressReportData(this.getAnonymizedXmlForPages(t)),g=this.compressReportData(this.getAnonymizedXmlForPages(z)),k=this.ui.hashValue(b.getCurrentEtag()),n=this.ui.hashValue(this.getCurrentEtag());
this.checksumError(f,y,"Shadow Details: "+JSON.stringify(c)+"\nChecksum: "+A+"\nCurrent: "+J+"\nCurrent Details: "+JSON.stringify(B)+"\nFrom: "+k+"\nTo: "+n+"\n\nFile Data:\n"+e+"\nPatched Shadow:\n"+g,null,"mergeFile",A,J,b.getCurrentRevisionId());return}if(null!=this.sync){var u=this.sync.patchRealtime(y,DrawioFile.LAST_WRITE_WINS?this.backupPatch:null);null==u||mxUtils.isEmptyObject(u)||y.push(u)}this.patch(y,DrawioFile.LAST_WRITE_WINS?this.backupPatch:null)}}else throw l=!1,Error(mxResources.get("notADiagramFile"));
this.inConflictState=this.invalidChecksum=!1;this.setDescriptor(b.getDescriptor());this.descriptorChanged();this.backupPatch=null;null!=d&&d()}catch(C){this.invalidChecksum=this.inConflictState=!0;this.descriptorChanged();null!=f&&f(C);try{if(l)if(this.errorReportsEnabled)this.sendErrorReport("Error in mergeFile",null,C);else{var v=this.getCurrentUser(),E=null!=v?v.id:"unknown";EditorUi.logError("Error in mergeFile",null,this.getMode()+"."+this.getId(),E,C)}}catch(H){}}};