DrawioFileSync.prototype.catchup=function(b,d,f,c){if(null!=b&&(null==c||!c())){var l=this.file.getCurrentRevisionId(),m=this.file.getDescriptorRevisionId(b);EditorUi.debug("DrawioFileSync.catchup",[this],"desc",[b],"from",l,"to",m,"valid",this.isValidState());if(l==m)this.file.patchDescriptor(this.file.getDescriptor(),b),null!=d&&d(!0);else if(this.isValidState()){var t=this.file.getDescriptorSecret(b);if(null==t||"1"==urlParams.lockdown)this.reload(d,f,c);else{var y=0,B=!1,z=mxUtils.bind(this,function(){if(null==
c||!c())if(l!=this.file.getCurrentRevisionId())null!=d&&d(!0);else if(this.isValidState()){this.scheduleCleanup(!0);var A=!0,J=window.setTimeout(mxUtils.bind(this,function(){A=!1;this.reload(d,f,c)}),this.ui.timeout);mxUtils.get(EditorUi.cacheUrl+"?id="+encodeURIComponent(this.channelId)+"&from="+encodeURIComponent(l)+"&to="+encodeURIComponent(m)+(null!=t?"&secret="+encodeURIComponent(t):""),mxUtils.bind(this,function(e){this.file.stats.bytesReceived+=e.getText().length;window.clearTimeout(J);if(A&&
(null==c||!c()))if(l!=this.file.getCurrentRevisionId())null!=d&&d(!0);else if(this.isValidState()){var g=null,k=[];EditorUi.debug("DrawioFileSync.doCatchup",[this],"req",[e],"status",e.getStatus(),"cacheReadyRetryCount",y,"maxCacheReadyRetries",this.maxCacheReadyRetries);if(200<=e.getStatus()&&299>=e.getStatus()&&0<e.getText().length)try{var n=JSON.parse(e.getText());if(null!=n&&0<n.length)for(var u=0;u<n.length;u++){var v=this.stringToObject(n[u]);if(v.v>DrawioFileSync.PROTOCOL){B=!0;k=[];break}else if(v.v===
DrawioFileSync.PROTOCOL&&null!=v.d)g=v.d.checksum,k.push(v.d.patch);else{B=!0;k=[];break}}EditorUi.debug("DrawioFileSync.doCatchup",[this],"response",[n],"failed",B,"temp",k,"checksum",g)}catch(E){k=[],null!=window.console&&"1"==urlParams.test&&console.log(E)}try{0<k.length?(this.file.stats.cacheHits++,this.merge(k,g,b,d,f,c)):y<=this.maxCacheReadyRetries-1&&!B&&401!=e.getStatus()&&503!=e.getStatus()&&410!=e.getStatus()?(y++,this.file.stats.cacheMiss++,window.setTimeout(z,(y+1)*this.cacheReadyDelay)):
(this.file.stats.cacheFail++,this.reload(d,f,c))}catch(E){null!=f&&f(E)}}else null!=f&&f()}))}else null!=f&&f()});window.setTimeout(z,this.cacheReadyDelay)}}else null!=f&&f()}};DrawioFileSync.prototype.reload=function(b,d,f,c){this.file.updateFile(mxUtils.bind(this,function(){this.lastModified=this.file.getLastModifiedDate();this.updateStatus();this.start();null!=b&&b()}),mxUtils.bind(this,function(l){null!=d&&d(l)}),f,c)};