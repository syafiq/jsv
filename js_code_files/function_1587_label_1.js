var CommentsWindow=function(b,d,f,c,l,m){function t(){for(var G=E.getElementsByTagName("div"),K=0,N=0;N<G.length;N++)"none"!=G[N].style.display&&G[N].parentNode==E&&K++;C.style.display=0==K?"block":"none"}function y(G,K,N,I){function M(){K.removeChild(V);K.removeChild(W);P.style.display="block";Q.style.display="block"}n={div:K,comment:G,saveCallback:N,deleteOnCancel:I};var Q=K.querySelector(".geCommentTxt"),P=K.querySelector(".geCommentActionsList"),V=document.createElement("textarea");V.className=
"geCommentEditTxtArea";V.style.minHeight=Q.offsetHeight+"px";V.value=G.content;K.insertBefore(V,Q);var W=document.createElement("div");W.className="geCommentEditBtns";var q=mxUtils.button(mxResources.get("cancel"),function(){I?(K.parentNode.removeChild(K),t()):M();n=null});q.className="geCommentEditBtn";W.appendChild(q);var D=mxUtils.button(mxResources.get("save"),function(){Q.innerText="";G.content=V.value;mxUtils.write(Q,G.content);M();N(G);n=null});mxEvent.addListener(V,"keydown",mxUtils.bind(this,
function(L){mxEvent.isConsumed(L)||((mxEvent.isControlDown(L)||mxClient.IS_MAC&&mxEvent.isMetaDown(L))&&13==L.keyCode?(D.click(),mxEvent.consume(L)):27==L.keyCode&&(q.click(),mxEvent.consume(L)))}));D.focus();D.className="geCommentEditBtn gePrimaryBtn";W.appendChild(D);K.insertBefore(W,Q);P.style.display="none";Q.style.display="none";V.focus()}function B(G,K){K.innerText="";G=new Date(G.modifiedDate);var N=b.timeSince(G);null==N&&(N=mxResources.get("lessThanAMinute"));mxUtils.write(K,mxResources.get("timeAgo",
[N],"{1} ago"));K.setAttribute("title",G.toLocaleDateString()+" "+G.toLocaleTimeString())}function z(G){var K=document.createElement("img");K.className="geCommentBusyImg";K.src=IMAGE_PATH+"/spin.gif";G.appendChild(K);G.busyImg=K}function A(G){G.style.border="1px solid red";G.removeChild(G.busyImg)}function J(G){G.style.border="";G.removeChild(G.busyImg)}function e(G,K,N,I,M){function Q(O,S,R){var X=document.createElement("li");X.className="geCommentAction";var Z=document.createElement("a");Z.className=
"geCommentActionLnk";mxUtils.write(Z,O);X.appendChild(Z);mxEvent.addListener(Z,"click",function(ba){S(ba,G);ba.preventDefault();mxEvent.consume(ba)});U.appendChild(X);R&&(X.style.display="none")}function P(){function O(X){S.push(R);if(null!=X.replies)for(var Z=0;Z<X.replies.length;Z++)R=R.nextSibling,O(X.replies[Z])}var S=[],R=W;O(G);return{pdiv:R,replies:S}}function V(O,S,R,X,Z){function ba(){z(da);G.addReply(Y,function(ea){Y.id=ea;G.replies.push(Y);J(da);R&&R()},function(ea){aa();A(da);b.handleError(ea,
null,null,null,mxUtils.htmlEntities(mxResources.get("objectNotFound")))},X,Z)}function aa(){y(Y,da,function(ea){ba()},!0)}var ca=P().pdiv,Y=b.newComment(O,b.getCurrentUser());Y.pCommentId=G.id;null==G.replies&&(G.replies=[]);var da=e(Y,G.replies,ca,I+1);S?aa():ba()}if(M||!G.isResolved){C.style.display="none";var W=document.createElement("div");W.className="geCommentContainer";W.setAttribute("data-commentId",G.id);W.style.marginLeft=20*I+5+"px";G.isResolved&&!Editor.isDarkMode()&&(W.style.backgroundColor=
"ghostWhite");var q=document.createElement("div");q.className="geCommentHeader";var D=document.createElement("img");D.className="geCommentUserImg";D.src=G.user.pictureUrl||Editor.userImage;q.appendChild(D);D=document.createElement("div");D.className="geCommentHeaderTxt";q.appendChild(D);var L=document.createElement("div");L.className="geCommentUsername";mxUtils.write(L,G.user.displayName||"");D.appendChild(L);L=document.createElement("div");L.className="geCommentDate";L.setAttribute("data-commentId",
G.id);B(G,L);D.appendChild(L);W.appendChild(q);q=document.createElement("div");q.className="geCommentTxt";mxUtils.write(q,G.content||"");W.appendChild(q);G.isLocked&&(W.style.opacity="0.5");q=document.createElement("div");q.className="geCommentActions";var U=document.createElement("ul");U.className="geCommentActionsList";q.appendChild(U);g||G.isLocked||0!=I&&!k||Q(mxResources.get("reply"),function(){V("",!0)},G.isResolved);D=b.getCurrentUser();null==D||D.id!=G.user.id||g||G.isLocked||(Q(mxResources.get("edit"),
function(){function O(){y(G,W,function(){z(W);G.editComment(G.content,function(){J(W)},function(S){A(W);O();b.handleError(S,null,null,null,mxUtils.htmlEntities(mxResources.get("objectNotFound")))})})}O()},G.isResolved),Q(mxResources.get("delete"),function(){b.confirm(mxResources.get("areYouSure"),function(){z(W);G.deleteComment(function(O){if(!0===O){O=W.querySelector(".geCommentTxt");O.innerText="";mxUtils.write(O,mxResources.get("msgDeleted"));var S=W.querySelectorAll(".geCommentAction");for(O=
0;O<S.length;O++)S[O].parentNode.removeChild(S[O]);J(W);W.style.opacity="0.5"}else{S=P(G).replies;for(O=0;O<S.length;O++)E.removeChild(S[O]);for(O=0;O<K.length;O++)if(K[O]==G){K.splice(O,1);break}C.style.display=0==E.getElementsByTagName("div").length?"block":"none"}},function(O){A(W);b.handleError(O,null,null,null,mxUtils.htmlEntities(mxResources.get("objectNotFound")))})})},G.isResolved));g||G.isLocked||0!=I||Q(G.isResolved?mxResources.get("reopen"):mxResources.get("resolve"),function(O){function S(){var R=
O.target;R.innerText="";G.isResolved=!G.isResolved;mxUtils.write(R,G.isResolved?mxResources.get("reopen"):mxResources.get("resolve"));for(var X=G.isResolved?"none":"",Z=P(G).replies,ba=Editor.isDarkMode()?"transparent":G.isResolved?"ghostWhite":"white",aa=0;aa<Z.length;aa++){Z[aa].style.backgroundColor=ba;for(var ca=Z[aa].querySelectorAll(".geCommentAction"),Y=0;Y<ca.length;Y++)ca[Y]!=R.parentNode&&(ca[Y].style.display=X);T||(Z[aa].style.display="none")}t()}G.isResolved?V(mxResources.get("reOpened")+
": ",!0,S,!1,!0):V(mxResources.get("markedAsResolved"),!1,S,!0)});W.appendChild(q);null!=N?E.insertBefore(W,N.nextSibling):E.appendChild(W);for(N=0;null!=G.replies&&N<G.replies.length;N++)q=G.replies[N],q.isResolved=G.isResolved,e(q,G.replies,null,I+1,M);null!=n&&(n.comment.id==G.id?(M=G.content,G.content=n.comment.content,y(G,W,n.saveCallback,n.deleteOnCancel),G.content=M):null==n.comment.id&&n.comment.pCommentId==G.id&&(E.appendChild(n.div),y(n.comment,n.div,n.saveCallback,n.deleteOnCancel)));return W}}
var g=!b.canComment(),k=b.canReplyToReplies(),n=null,u=document.createElement("div");u.className="geCommentsWin";u.style.background=Editor.isDarkMode()?Dialog.backdropColor:"whiteSmoke";var v=EditorUi.compactUi?"26px":"30px",E=document.createElement("div");E.className="geCommentsList";E.style.backgroundColor=Editor.isDarkMode()?Dialog.backdropColor:"whiteSmoke";E.style.bottom=parseInt(v)+7+"px";u.appendChild(E);var C=document.createElement("span");C.style.cssText="display:none;padding-top:10px;text-align:center;";
mxUtils.write(C,mxResources.get("noCommentsFound"));var H=document.createElement("div");H.className="geToolbarContainer geCommentsToolbar";H.style.height=v;H.style.padding=EditorUi.compactUi?"4px 0px 3px 0px":"1px";H.style.backgroundColor=Editor.isDarkMode()?Dialog.backdropColor:"whiteSmoke";v=document.createElement("a");v.className="geButton";if(!g){var F=v.cloneNode();F.innerHTML='<div class="geSprite geSprite-plus" style="display:inline-block;"></div>';F.setAttribute("title",mxResources.get("create")+
"...");mxEvent.addListener(F,"click",function(G){function K(){y(N,I,function(M){z(I);b.addComment(M,function(Q){M.id=Q;p.push(M);J(I)},function(Q){A(I);K();b.handleError(Q,null,null,null,mxUtils.htmlEntities(mxResources.get("objectNotFound")))})},!0)}var N=b.newComment("",b.getCurrentUser()),I=e(N,p,null,0);K();G.preventDefault();mxEvent.consume(G)});H.appendChild(F)}F=v.cloneNode();F.innerHTML='<img src="'+IMAGE_PATH+'/check.png" style="width: 16px; padding: 2px;">';F.setAttribute("title",mxResources.get("showResolved"));
F.className="geAdaptiveAsset";var T=!1;mxEvent.addListener(F,"click",function(G){this.className=(T=!T)?"geButton geCheckedBtn":"geButton";x();G.preventDefault();mxEvent.consume(G)});H.appendChild(F);b.commentsRefreshNeeded()&&(F=v.cloneNode(),F.innerHTML='<img src="'+IMAGE_PATH+'/update16.png" style="width: 16px; padding: 2px;">',F.setAttribute("title",mxResources.get("refresh")),F.className="geAdaptiveAsset",mxEvent.addListener(F,"click",function(G){x();G.preventDefault();mxEvent.consume(G)}),H.appendChild(F));
b.commentsSaveNeeded()&&(v=v.cloneNode(),v.innerHTML='<img src="'+IMAGE_PATH+'/save.png" style="width: 20px; padding: 2px;">',v.setAttribute("title",mxResources.get("save")),v.className="geAdaptiveAsset",mxEvent.addListener(v,"click",function(G){m();G.preventDefault();mxEvent.consume(G)}),H.appendChild(v));u.appendChild(H);var p=[],x=mxUtils.bind(this,function(){this.hasError=!1;if(null!=n)try{n.div=n.div.cloneNode(!0);var G=n.div.querySelector(".geCommentEditTxtArea"),K=n.div.querySelector(".geCommentEditBtns");
n.comment.content=G.value;G.parentNode.removeChild(G);K.parentNode.removeChild(K)}catch(N){b.handleError(N)}E.innerHTML='<div style="padding-top:10px;text-align:center;"><img src="'+IMAGE_PATH+'/spin.gif" valign="middle"> '+mxUtils.htmlEntities(mxResources.get("loading"))+"...</div>";k=b.canReplyToReplies();b.commentsSupported()?b.getComments(function(N){function I(M){if(null!=M){M.sort(function(P,V){return new Date(P.modifiedDate)-new Date(V.modifiedDate)});for(var Q=0;Q<M.length;Q++)I(M[Q].replies)}}
N.sort(function(M,Q){return new Date(M.modifiedDate)-new Date(Q.modifiedDate)});E.innerText="";E.appendChild(C);C.style.display="block";p=N;for(N=0;N<p.length;N++)I(p[N].replies),e(p[N],p,null,0,T);null!=n&&null==n.comment.id&&null==n.comment.pCommentId&&(E.appendChild(n.div),y(n.comment,n.div,n.saveCallback,n.deleteOnCancel))},mxUtils.bind(this,function(N){E.innerHTML=mxUtils.htmlEntities(mxResources.get("error")+(N&&N.message?": "+N.message:""));this.hasError=!0})):E.innerHTML=mxUtils.htmlEntities(mxResources.get("error"))});
x();this.refreshComments=x;H=mxUtils.bind(this,function(){function G(Q){var P=N[Q.id];if(null!=P)for(B(Q,P),P=0;null!=Q.replies&&P<Q.replies.length;P++)G(Q.replies[P])}if(this.window.isVisible()){for(var K=E.querySelectorAll(".geCommentDate"),N={},I=0;I<K.length;I++){var M=K[I];N[M.getAttribute("data-commentId")]=M}for(I=0;I<p.length;I++)G(p[I])}});setInterval(H,6E4);this.refreshCommentsTime=H;this.window=new mxWindow(mxResources.get("comments"),u,d,f,c,l,!0,!0);this.window.minimumSize=new mxRectangle(0,
0,300,200);this.window.destroyOnClose=!1;this.window.setMaximizable(!1);this.window.setResizable(!0);this.window.setClosable(!0);this.window.setVisible(!0);this.window.addListener(mxEvent.SHOW,mxUtils.bind(this,function(){this.window.fit()}));b.installResizeHandler(this,!0)},ConfirmDialog=function(b,d,f,c,l,m,t,y,B,z,A){var J=document.createElement("div");J.style.textAlign="center";A=null!=A?A:44;var e=document.createElement("div");e.style.padding="6px";e.style.overflow="auto";e.style.maxHeight=A+