"cells",[N])),b.fireEvent(new mxEventObject("freehandInserted","cell",N))}finally{b.model.endUpdate()}u&&b.setSelectionCells([N])}}for(N=0;N<l.length;N++)l[N].parentNode.removeChild(l[N]);c=null;l=[];t=[]}C(!1)};b.addListener(mxEvent.FIRE_MOUSE_EVENT,mxUtils.bind(this,function(K,N){K=N.getProperty("eventName");N=N.getProperty("event");K==mxEvent.MOUSE_MOVE&&k&&(null!=N.sourceState&&N.sourceState.setCursor("crosshair"),N.consume())}));b.addMouseListener({mouseDown:mxUtils.bind(this,function(K,N){if(b.isEnabled()&&
!b.isCellLocked(b.getDefaultParent())&&(K=N.getEvent(),k&&!mxEvent.isPopupTrigger(K)&&!mxEvent.isMultiTouchEvent(K))){var I=parseFloat(b.currentVertexStyle[mxConstants.STYLE_STROKEWIDTH]||1);I=Math.max(1,I*b.view.scale);var M=T();c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("fill",E?M:"none");c.setAttribute("stroke",M);c.setAttribute("stroke-width",I);"1"==b.currentVertexStyle[mxConstants.STYLE_DASHED]&&(M=b.currentVertexStyle[mxConstants.STYLE_DASH_PATTERN]||"3 3",
M=M.split(" ").map(function(Q){return parseFloat(Q)*I}).join(" "),c.setAttribute("stroke-dasharray",M));g=[];K=p(K);x(K);m="M"+K.x+" "+K.y;t.push(K);y=[];c.setAttribute("d",E?PerfectFreehand.getSvgPathFromStroke([[K.x,K.y]],v):m);d.appendChild(c);N.consume()}}),mouseMove:mxUtils.bind(this,function(K,N){if(c&&b.isEnabled()&&!b.isCellLocked(b.getDefaultParent())){K=N.getEvent();K=p(K);x(K);var I=G(0);if(I)if(t.push(I),E){var M=[];for(I=0;I<t.length;I++)M.push([t[I].x,t[I].y]);y=[];for(var Q=2;Q<g.length;Q+=