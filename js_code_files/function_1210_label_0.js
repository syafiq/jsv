299>=v.getStatus()?I("data:image/png;base64,"+v.getText()):F({message:mxResources.get("unknownError")})}))}else F({message:mxResources.get("drawingTooLarge")})};EditorUi.prototype.createEmbedSvg=function(d,g,k,n,x,u,D){var F=this.editor.graph.getSvg(null,null,null,null,null,null,null,null,null,null,!k),I=F.getElementsByTagName("a");if(null!=I)for(var G=0;G<I.length;G++){var U=I[G].getAttribute("href");null!=U&&"#"==U.charAt(0)&&"_blank"==I[G].getAttribute("target")&&I[G].removeAttribute("target")}n&&
F.setAttribute("content",this.getFileData(!0));g&&this.editor.graph.addSvgShadow(F);if(k){var q=" ",v="";n&&(q="onclick=\"(function(img){if(img.wnd!=null&&!img.wnd.closed){img.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&&evt.source==img.wnd){img.wnd.postMessage(decodeURIComponent(img.getAttribute('src')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);img.wnd=window.open('"+EditorUi.lightboxHost+"/?client=1"+(x?"&edit=_blank":"")+(u?"&layers=1":
"")+"');}})(this);\"",v+="cursor:pointer;");d&&(v+="max-width:100%;");this.editor.convertImages(F,mxUtils.bind(this,function(E){D('<img src="'+Editor.createSvgDataUri(mxUtils.getXml(E))+'"'+(""!=v?' style="'+v+'"':"")+q+"/>")}))}else v="",n&&(g=this.getSelectedPageIndex(),F.setAttribute("onclick","(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&&src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&&!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&&evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('"+
EditorUi.lightboxHost+"/?client=1"+(null!=g?"&page="+g:"")+(x?"&edit=_blank":"")+(u?"&layers=1":"")+"');}}})(this);"),v+="cursor:pointer;"),d&&(d=parseInt(F.getAttribute("width")),x=parseInt(F.getAttribute("height")),F.setAttribute("viewBox","-0.5 -0.5 "+d+" "+x),v+="max-width:100%;max-height:"+x+"px;",F.removeAttribute("height")),""!=v&&F.setAttribute("style",v),this.editor.addFontCss(F),this.editor.graph.mathEnabled&&this.editor.addMathCss(F),D(mxUtils.getXml(F))};EditorUi.prototype.timeSince=function(d){d=