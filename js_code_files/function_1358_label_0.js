x.getInsertPoint(),x.isMouseInsertPoint()&&(H=0,x.lastPasteXml==d&&0<x.pasteCounter&&x.pasteCounter--),A=this.insertTextAt(d,A.x+H,A.y+H,!0),x.setSelectionCells(A);x.isSelectionEmpty()||(x.scrollCellToVisible(x.getSelectionCell()),null!=this.hoverIcons&&this.hoverIcons.update(x.view.getState(x.getSelectionCell())));return A};EditorUi.prototype.pasteCells=function(d,f,g,u){if(!mxEvent.isConsumed(d)){var x=f,A=!1;if(g&&null!=d.clipboardData&&d.clipboardData.getData){var H=d.clipboardData.getData("text/plain"),
P=!1;if(null!=H&&0<H.length&&"%3CmxGraphModel%3E"==H.substring(0,18))try{var M=decodeURIComponent(H);this.isCompatibleString(M)&&(P=!0,H=M)}catch(oa){}P=P?null:d.clipboardData.getData("text/html");null!=P&&0<P.length?(x=this.parseHtmlData(P),A="text/plain"!=x.getAttribute("data-type")):null!=H&&0<H.length&&(x=document.createElement("div"),mxUtils.setTextContent(x,P))}H=x.getElementsByTagName("span");if(null!=H&&0<H.length&&"application/vnd.lucid.chart.objects"===H[0].getAttribute("data-lucid-type"))g=
H[0].getAttribute("data-lucid-content"),null!=g&&0<g.length&&(this.convertLucidChart(g,mxUtils.bind(this,function(oa){var sa=this.editor.graph;sa.lastPasteXml==oa?sa.pasteCounter++:(sa.lastPasteXml=oa,sa.pasteCounter=0);var J=sa.pasteCounter*sa.gridSize;sa.setSelectionCells(this.importXml(oa,J,J));sa.scrollCellToVisible(sa.getSelectionCell())}),mxUtils.bind(this,function(oa){this.handleError(oa)})),mxEvent.consume(d));else{var G=A?x.innerHTML:mxUtils.trim(null==x.innerText?mxUtils.getTextContent(x):
x.innerText),ia=!1;try{var ja=G.lastIndexOf("%3E");0<=ja&&ja<G.length-3&&(G=G.substring(0,ja+3))}catch(oa){}try{H=x.getElementsByTagName("span"),(M=null!=H&&0<H.length?mxUtils.trim(decodeURIComponent(H[0].textContent)):decodeURIComponent(G))&&(this.isCompatibleString(M)||0==M.substring(0,20).replace(/\s/g,"").indexOf('{"isProtected":'))&&(ia=!0,G=M)}catch(oa){}try{if(null!=G&&0<G.length){if(0==G.substring(0,20).replace(/\s/g,"").indexOf('{"isProtected":')){var ha=mxUtils.bind(this,function(){try{G=
(new MiroImporter).importMiroJson(JSON.parse(G)),this.pasteXml(G,u,ia,d)}catch(oa){console.log("Miro import error:",oa)}});"undefined"===typeof MiroImporter?mxscript("js/diagramly/miro/MiroImporter.js",ha):ha()}else this.pasteXml(G,u,ia,d);try{mxEvent.consume(d)}catch(oa){}}else if(!g){var ba=this.editor.graph;ba.lastPasteXml=null;ba.pasteCounter=0}}catch(oa){this.handleError(oa)}}}f.innerHTML="&nbsp;"};EditorUi.prototype.addFileDropHandler=function(d){if(Graph.fileSupport)for(var f=null,g=0;g<d.length;g++)mxEvent.addListener(d[g],