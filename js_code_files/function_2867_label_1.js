DrawioFilePuller.prototype.stop=function(){clearInterval(this.intId);this._isConnected=!1};DrawioFilePuller.prototype.isConnected=function(){return this._isConnected};DrawioFileSync=function(b){mxEventSource.call(this);this.lastActivity=Date.now();this.clientId=Editor.guid();this.ui=b.ui;this.file=b;this.onlineListener=mxUtils.bind(this,function(){this.updateOnlineState();this.isConnected()&&this.fileChangedNotify()});mxEvent.addListener(window,"online",this.onlineListener);this.realtimeListener=mxUtils.bind(this,function(){this.updateOnlineState()});this.file.addListener("realtimeStateChanged",this.realtimeListener);this.autosaveListener=mxUtils.bind(this,function(){this.updateRealtime()});
this.ui.editor.addListener("autosaveChanged",this.autosaveListener);this.visibleListener=mxUtils.bind(this,function(){"hidden"==document.visibilityState?this.isConnected()&&this.stop():this.start()});mxEvent.addListener(document,"visibilitychange",this.visibleListener);this.activityListener=mxUtils.bind(this,function(d){this.lastActivity=Date.now();this.start()});mxEvent.addListener(document,mxClient.IS_POINTER?"pointermove":"mousemove",this.activityListener);mxEvent.addListener(document,"keypress",
this.activityListener);mxEvent.addListener(window,"focus",this.activityListener);!mxClient.IS_POINTER&&mxClient.IS_TOUCH&&(mxEvent.addListener(document,"touchstart",this.activityListener),mxEvent.addListener(document,"touchmove",this.activityListener));this.file.addListener("realtimeMessage",this.activityListener);this.pusherErrorListener=mxUtils.bind(this,function(d){null!=d.error&&null!=d.error.data&&4004===d.error.data.code&&EditorUi.logError("Error: Pusher Limit",null,this.file.getId())});this.connectionListener=
mxUtils.bind(this,function(){this.updateOnlineState();this.updateStatus();if(this.isConnected())if(this.announced)this.fileChangedNotify();else{var d=this.file.getCurrentUser(),f={a:"join"};null!=d&&(f.name=encodeURIComponent(d.displayName),f.uid=d.id);mxUtils.post(EditorUi.cacheUrl,this.getIdParameters()+"&msg="+encodeURIComponent(this.objectToString(this.createMessage(f))));this.file.stats.msgSent++;this.announced=!0}});this.changeListener=mxUtils.bind(this,function(d){this.file.stats.msgReceived++;
this.lastActivity=Date.now();if(this.enabled&&!this.file.inConflictState&&!this.file.redirectDialogShowing)try{var f=this.stringToObject(d);null!=f&&(EditorUi.debug("DrawioFileSync.message",[this],f,d.length,"bytes"),f.v>DrawioFileSync.PROTOCOL?this.file.redirectToNewApp(mxUtils.bind(this,function(){})):f.v===DrawioFileSync.PROTOCOL&&null!=f.d&&this.handleMessageData(f.d))}catch(c){this.isConnected()&&this.fileChangedNotify()}})};DrawioFileSync.PROTOCOL=6;DrawioFileSync.ENABLE_SOCKETS="0"!=urlParams.sockets;