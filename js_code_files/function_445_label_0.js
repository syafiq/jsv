App.prototype.getThumbnail=function(b,e){var f=!1;try{var c=!0,l=window.setTimeout(mxUtils.bind(this,function(){c=!1;e(null)}),this.timeout),m=mxUtils.bind(this,function(v){window.clearTimeout(l);c&&e(v)});null==this.thumbImageCache&&(this.thumbImageCache={});var t=this.editor.graph,y=t.backgroundImage,C=null!=t.themes&&"darkTheme"==t.defaultThemeName;if(null!=this.pages&&(C||this.currentPage!=this.pages[0])){var z=t.getGlobalVariable;t=this.createTemporaryGraph(t.getStylesheet());t.setBackgroundImage=
this.editor.graph.setBackgroundImage;var A=this.pages[0];this.currentPage==A?t.setBackgroundImage(y):null!=A.viewState&&null!=A.viewState&&(y=A.viewState.backgroundImage,t.setBackgroundImage(y));t.getGlobalVariable=function(v){return"page"==v?A.getName():"pagenumber"==v?1:z.apply(this,arguments)};t.getGlobalVariable=z;document.body.appendChild(t.container);t.model.setRoot(A.root)}if(mxClient.IS_CHROMEAPP||this.useCanvasForExport)this.editor.exportToCanvas(mxUtils.bind(this,function(v){try{t!=this.editor.graph&&
null!=t.container.parentNode&&t.container.parentNode.removeChild(t.container)}catch(E){v=null}m(v)}),b,this.thumbImageCache,"#ffffff",function(){m()},null,null,null,null,null,null,t,null,null,null,null,"diagram",null),f=!0;else if(this.canvasSupported&&null!=this.getCurrentFile()){var J=document.createElement("canvas"),d=t.getGraphBounds(),g=t.view.translate,k=t.view.scale;null!=y&&(d=mxRectangle.fromRectangle(d),d.add(new mxRectangle((g.x+y.x)*k,(g.y+y.y)*k,y.width*k,y.height*k)));var n=b/d.width;
n=Math.min(1,Math.min(3*b/(4*d.height),n));var x=Math.floor(d.x),u=Math.floor(d.y);J.setAttribute("width",Math.ceil(n*(d.width+4)));J.setAttribute("height",Math.ceil(n*(d.height+4)));var D=J.getContext("2d");D.scale(n,n);D.translate(-x,-u);var F=t.background;if(null==F||""==F||F==mxConstants.NONE)F="#ffffff";D.save();D.fillStyle=F;D.fillRect(x,u,Math.ceil(d.width+4),Math.ceil(d.height+4));D.restore();if(null!=y){var I=new Image;I.src=y.src;D.drawImage(I,y.x*n,y.y*n,y.width*n,y.height*n)}var G=new mxJsCanvas(J),
U=new mxAsyncCanvas(this.thumbImageCache);G.images=this.thumbImageCache.images;var q=new mxImageExport;q.drawShape=function(v,E){v.shape instanceof mxShape&&v.shape.checkBounds()&&(E.save(),E.translate(.5,.5),v.shape.paint(E),E.translate(-.5,-.5),E.restore())};q.drawText=function(v,E){};q.drawState(t.getView().getState(t.model.root),U);U.finish(mxUtils.bind(this,function(){try{q.drawState(t.getView().getState(t.model.root),G),t!=this.editor.graph&&null!=t.container.parentNode&&t.container.parentNode.removeChild(t.container)}catch(v){J=
null}m(J)}));f=!0}}catch(v){f=!1,null!=t&&t!=this.editor.graph&&null!=t.container.parentNode&&t.container.parentNode.removeChild(t.container)}f||window.clearTimeout(l);return f};App.prototype.createBackground=function(){var b=this.createDiv("background");b.style.position="absolute";b.style.background="white";b.style.left="0px";b.style.top="0px";b.style.bottom="0px";b.style.right="0px";mxUtils.setOpacity(b,100);return b};