299>=t.getStatus()?G("data:image/png;base64,"+t.getText()):B({message:mxResources.get("unknownError")})}))}else B({message:mxResources.get("drawingTooLarge")})};EditorUi.prototype.createEmbedSvg=function(c,e,g,n,q,p,y){var B=this.editor.graph.getSvg(null,null,null,null,null,null,null,null,null,null,!g),G=B.getElementsByTagName("a");if(null!=G)for(var C=0;C<G.length;C++){var U=G[C].getAttribute("href");null!=U&&"#"==U.charAt(0)&&"_blank"==G[C].getAttribute("target")&&G[C].removeAttribute("target")}n&&
B.setAttribute("content",this.getFileData(!0));e&&this.editor.graph.addSvgShadow(B);if(g){var m=" ",t="";n&&(m="onclick=\"(function(img){if(img.wnd!=null&&!img.wnd.closed){img.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&&evt.source==img.wnd){img.wnd.postMessage(decodeURIComponent(img.getAttribute('src')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);img.wnd=window.open('"+EditorUi.lightboxHost+"/?client=1"+(q?"&edit=_blank":"")+(p?"&layers=1":
"")+"');}})(this);\"",t+="cursor:pointer;");c&&(t+="max-width:100%;");this.editor.convertImages(B,mxUtils.bind(this,function(z){y('<img src="'+Editor.createSvgDataUri(mxUtils.getXml(z))+'"'+(""!=t?' style="'+t+'"':"")+m+"/>")}))}else t="",n&&(e=this.getSelectedPageIndex(),B.setAttribute("onclick","(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&&src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&&!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&&evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('"+
EditorUi.lightboxHost+"/?client=1"+(null!=e?"&page="+e:"")+(q?"&edit=_blank":"")+(p?"&layers=1":"")+"');}}})(this);"),t+="cursor:pointer;"),c&&(c=parseInt(B.getAttribute("width")),q=parseInt(B.getAttribute("height")),B.setAttribute("viewBox","-0.5 -0.5 "+c+" "+q),t+="max-width:100%;max-height:"+q+"px;",B.removeAttribute("height")),""!=t&&B.setAttribute("style",t),this.editor.addFontCss(B),this.editor.graph.mathEnabled&&this.editor.addMathCss(B),y(mxUtils.getXml(B))};EditorUi.prototype.timeSince=function(c){c=