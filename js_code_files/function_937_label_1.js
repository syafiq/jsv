var CommentsWindow=function(b,e,k,l,C,p){function D(){for(var aa=J.getElementsByTagName("div"),qa=0,sa=0;sa<aa.length;sa++)"none"!=aa[sa].style.display&&aa[sa].parentNode==J&&qa++;H.style.display=0==qa?"block":"none"}function M(aa,qa,sa,K){function V(){qa.removeChild(X);qa.removeChild(ka);Z.style.display="block";T.style.display="block"}v={div:qa,comment:aa,saveCallback:sa,deleteOnCancel:K};var T=qa.querySelector(".geCommentTxt"),Z=qa.querySelector(".geCommentActionsList"),X=document.createElement("textarea");
X.className="geCommentEditTxtArea";X.style.minHeight=T.offsetHeight+"px";X.value=aa.content;qa.insertBefore(X,T);var ka=document.createElement("div");ka.className="geCommentEditBtns";var q=mxUtils.button(mxResources.get("cancel"),function(){K?(qa.parentNode.removeChild(qa),D()):V();v=null});q.className="geCommentEditBtn";ka.appendChild(q);var E=mxUtils.button(mxResources.get("save"),function(){T.innerText="";aa.content=X.value;mxUtils.write(T,aa.content);V();sa(aa);v=null});mxEvent.addListener(X,
"keydown",mxUtils.bind(this,function(S){mxEvent.isConsumed(S)||((mxEvent.isControlDown(S)||mxClient.IS_MAC&&mxEvent.isMetaDown(S))&&13==S.keyCode?(E.click(),mxEvent.consume(S)):27==S.keyCode&&(q.click(),mxEvent.consume(S)))}));E.focus();E.className="geCommentEditBtn gePrimaryBtn";ka.appendChild(E);qa.insertBefore(ka,T);Z.style.display="none";T.style.display="none";X.focus()}function R(aa,qa){qa.innerText="";aa=new Date(aa.modifiedDate);var sa=b.timeSince(aa);null==sa&&(sa=mxResources.get("lessThanAMinute"));
mxUtils.write(qa,mxResources.get("timeAgo",[sa],"{1} ago"));qa.setAttribute("title",aa.toLocaleDateString()+" "+aa.toLocaleTimeString())}function G(aa){var qa=document.createElement("img");qa.className="geCommentBusyImg";qa.src=IMAGE_PATH+"/spin.gif";aa.appendChild(qa);aa.busyImg=qa}function L(aa){aa.style.border="1px solid red";aa.removeChild(aa.busyImg)}function Q(aa){aa.style.border="";aa.removeChild(aa.busyImg)}function d(aa,qa,sa,K,V){function T(U,ca,da){var pa=document.createElement("li");pa.className=
"geCommentAction";var ra=document.createElement("a");ra.className="geCommentActionLnk";mxUtils.write(ra,U);pa.appendChild(ra);mxEvent.addListener(ra,"click",function(ua){ca(ua,aa);ua.preventDefault();mxEvent.consume(ua)});ba.appendChild(pa);da&&(pa.style.display="none")}function Z(){function U(pa){ca.push(da);if(null!=pa.replies)for(var ra=0;ra<pa.replies.length;ra++)da=da.nextSibling,U(pa.replies[ra])}var ca=[],da=ka;U(aa);return{pdiv:da,replies:ca}}function X(U,ca,da,pa,ra){function ua(){G(ya);
aa.addReply(na,function(wa){na.id=wa;aa.replies.push(na);Q(ya);da&&da()},function(wa){oa();L(ya);b.handleError(wa,null,null,null,mxUtils.htmlEntities(mxResources.get("objectNotFound")))},pa,ra)}function oa(){M(na,ya,function(wa){ua()},!0)}var Aa=Z().pdiv,na=b.newComment(U,b.getCurrentUser());na.pCommentId=aa.id;null==aa.replies&&(aa.replies=[]);var ya=d(na,aa.replies,Aa,K+1);ca?oa():ua()}if(V||!aa.isResolved){H.style.display="none";var ka=document.createElement("div");ka.className="geCommentContainer";
ka.setAttribute("data-commentId",aa.id);ka.style.marginLeft=20*K+5+"px";aa.isResolved&&!Editor.isDarkMode()&&(ka.style.backgroundColor="ghostWhite");var q=document.createElement("div");q.className="geCommentHeader";var E=document.createElement("img");E.className="geCommentUserImg";E.src=aa.user.pictureUrl||Editor.userImage;q.appendChild(E);E=document.createElement("div");E.className="geCommentHeaderTxt";q.appendChild(E);var S=document.createElement("div");S.className="geCommentUsername";mxUtils.write(S,
aa.user.displayName||"");E.appendChild(S);S=document.createElement("div");S.className="geCommentDate";S.setAttribute("data-commentId",aa.id);R(aa,S);E.appendChild(S);ka.appendChild(q);q=document.createElement("div");q.className="geCommentTxt";mxUtils.write(q,aa.content||"");ka.appendChild(q);aa.isLocked&&(ka.style.opacity="0.5");q=document.createElement("div");q.className="geCommentActions";var ba=document.createElement("ul");ba.className="geCommentActionsList";q.appendChild(ba);f||aa.isLocked||0!=
K&&!g||T(mxResources.get("reply"),function(){X("",!0)},aa.isResolved);E=b.getCurrentUser();null==E||E.id!=aa.user.id||f||aa.isLocked||(T(mxResources.get("edit"),function(){function U(){M(aa,ka,function(){G(ka);aa.editComment(aa.content,function(){Q(ka)},function(ca){L(ka);U();b.handleError(ca,null,null,null,mxUtils.htmlEntities(mxResources.get("objectNotFound")))})})}U()},aa.isResolved),T(mxResources.get("delete"),function(){b.confirm(mxResources.get("areYouSure"),function(){G(ka);aa.deleteComment(function(U){if(!0===
U){U=ka.querySelector(".geCommentTxt");U.innerText="";mxUtils.write(U,mxResources.get("msgDeleted"));var ca=ka.querySelectorAll(".geCommentAction");for(U=0;U<ca.length;U++)ca[U].parentNode.removeChild(ca[U]);Q(ka);ka.style.opacity="0.5"}else{ca=Z(aa).replies;for(U=0;U<ca.length;U++)J.removeChild(ca[U]);for(U=0;U<qa.length;U++)if(qa[U]==aa){qa.splice(U,1);break}H.style.display=0==J.getElementsByTagName("div").length?"block":"none"}},function(U){L(ka);b.handleError(U,null,null,null,mxUtils.htmlEntities(mxResources.get("objectNotFound")))})})},
aa.isResolved));f||aa.isLocked||0!=K||T(aa.isResolved?mxResources.get("reopen"):mxResources.get("resolve"),function(U){function ca(){var da=U.target;da.innerText="";aa.isResolved=!aa.isResolved;mxUtils.write(da,aa.isResolved?mxResources.get("reopen"):mxResources.get("resolve"));for(var pa=aa.isResolved?"none":"",ra=Z(aa).replies,ua=Editor.isDarkMode()?"transparent":aa.isResolved?"ghostWhite":"white",oa=0;oa<ra.length;oa++){ra[oa].style.backgroundColor=ua;for(var Aa=ra[oa].querySelectorAll(".geCommentAction"),
na=0;na<Aa.length;na++)Aa[na]!=da.parentNode&&(Aa[na].style.display=pa);ea||(ra[oa].style.display="none")}D()}aa.isResolved?X(mxResources.get("reOpened")+": ",!0,ca,!1,!0):X(mxResources.get("markedAsResolved"),!1,ca,!0)});ka.appendChild(q);null!=sa?J.insertBefore(ka,sa.nextSibling):J.appendChild(ka);for(sa=0;null!=aa.replies&&sa<aa.replies.length;sa++)q=aa.replies[sa],q.isResolved=aa.isResolved,d(q,aa.replies,null,K+1,V);null!=v&&(v.comment.id==aa.id?(V=aa.content,aa.content=v.comment.content,M(aa,
ka,v.saveCallback,v.deleteOnCancel),aa.content=V):null==v.comment.id&&v.comment.pCommentId==aa.id&&(J.appendChild(v.div),M(v.comment,v.div,v.saveCallback,v.deleteOnCancel)));return ka}}var f=!b.canComment(),g=b.canReplyToReplies(),v=null,x=document.createElement("div");x.className="geCommentsWin";x.style.background=Editor.isDarkMode()?Dialog.backdropColor:"whiteSmoke";var A=EditorUi.compactUi?"26px":"30px",J=document.createElement("div");J.className="geCommentsList";J.style.backgroundColor=Editor.isDarkMode()?
Dialog.backdropColor:"whiteSmoke";J.style.bottom=parseInt(A)+7+"px";x.appendChild(J);var H=document.createElement("span");H.style.cssText="display:none;padding-top:10px;text-align:center;";mxUtils.write(H,mxResources.get("noCommentsFound"));var O=document.createElement("div");O.className="geToolbarContainer geCommentsToolbar";O.style.height=A;O.style.padding=EditorUi.compactUi?"4px 0px 3px 0px":"1px";O.style.backgroundColor=Editor.isDarkMode()?Dialog.backdropColor:"whiteSmoke";A=document.createElement("a");
A.className="geButton";if(!f){var F=A.cloneNode();F.innerHTML='<div class="geSprite geSprite-plus" style="display:inline-block;"></div>';F.setAttribute("title",mxResources.get("create")+"...");mxEvent.addListener(F,"click",function(aa){function qa(){M(sa,K,function(V){G(K);b.addComment(V,function(T){V.id=T;ja.push(V);Q(K)},function(T){L(K);qa();b.handleError(T,null,null,null,mxUtils.htmlEntities(mxResources.get("objectNotFound")))})},!0)}var sa=b.newComment("",b.getCurrentUser()),K=d(sa,ja,null,0);
qa();aa.preventDefault();mxEvent.consume(aa)});O.appendChild(F)}F=A.cloneNode();F.innerHTML='<img src="'+IMAGE_PATH+'/check.png" style="width: 16px; padding: 2px;">';F.setAttribute("title",mxResources.get("showResolved"));F.className="geAdaptiveAsset";var ea=!1;mxEvent.addListener(F,"click",function(aa){this.className=(ea=!ea)?"geButton geCheckedBtn":"geButton";ia();aa.preventDefault();mxEvent.consume(aa)});O.appendChild(F);b.commentsRefreshNeeded()&&(F=A.cloneNode(),F.innerHTML='<img src="'+IMAGE_PATH+
'/update16.png" style="width: 16px; padding: 2px;">',F.setAttribute("title",mxResources.get("refresh")),F.className="geAdaptiveAsset",mxEvent.addListener(F,"click",function(aa){ia();aa.preventDefault();mxEvent.consume(aa)}),O.appendChild(F));b.commentsSaveNeeded()&&(A=A.cloneNode(),A.innerHTML='<img src="'+IMAGE_PATH+'/save.png" style="width: 20px; padding: 2px;">',A.setAttribute("title",mxResources.get("save")),A.className="geAdaptiveAsset",mxEvent.addListener(A,"click",function(aa){p();aa.preventDefault();
mxEvent.consume(aa)}),O.appendChild(A));x.appendChild(O);var ja=[],ia=mxUtils.bind(this,function(){this.hasError=!1;if(null!=v)try{v.div=v.div.cloneNode(!0);var aa=v.div.querySelector(".geCommentEditTxtArea"),qa=v.div.querySelector(".geCommentEditBtns");v.comment.content=aa.value;aa.parentNode.removeChild(aa);qa.parentNode.removeChild(qa)}catch(sa){b.handleError(sa)}J.innerHTML='<div style="padding-top:10px;text-align:center;"><img src="'+IMAGE_PATH+'/spin.gif" valign="middle"> '+mxUtils.htmlEntities(mxResources.get("loading"))+
"...</div>";g=b.canReplyToReplies();b.commentsSupported()?b.getComments(function(sa){function K(V){if(null!=V){V.sort(function(Z,X){return new Date(Z.modifiedDate)-new Date(X.modifiedDate)});for(var T=0;T<V.length;T++)K(V[T].replies)}}sa.sort(function(V,T){return new Date(V.modifiedDate)-new Date(T.modifiedDate)});J.innerText="";J.appendChild(H);H.style.display="block";ja=sa;for(sa=0;sa<ja.length;sa++)K(ja[sa].replies),d(ja[sa],ja,null,0,ea);null!=v&&null==v.comment.id&&null==v.comment.pCommentId&&
(J.appendChild(v.div),M(v.comment,v.div,v.saveCallback,v.deleteOnCancel))},mxUtils.bind(this,function(sa){J.innerHTML=mxUtils.htmlEntities(mxResources.get("error")+(sa&&sa.message?": "+sa.message:""));this.hasError=!0})):J.innerHTML=mxUtils.htmlEntities(mxResources.get("error"))});ia();this.refreshComments=ia;O=mxUtils.bind(this,function(){function aa(T){var Z=sa[T.id];if(null!=Z)for(R(T,Z),Z=0;null!=T.replies&&Z<T.replies.length;Z++)aa(T.replies[Z])}if(this.window.isVisible()){for(var qa=J.querySelectorAll(".geCommentDate"),
sa={},K=0;K<qa.length;K++){var V=qa[K];sa[V.getAttribute("data-commentId")]=V}for(K=0;K<ja.length;K++)aa(ja[K])}});setInterval(O,6E4);this.refreshCommentsTime=O;this.window=new mxWindow(mxResources.get("comments"),x,e,k,l,C,!0,!0);this.window.minimumSize=new mxRectangle(0,0,300,200);this.window.destroyOnClose=!1;this.window.setMaximizable(!1);this.window.setResizable(!0);this.window.setClosable(!0);this.window.setVisible(!0);this.window.addListener(mxEvent.SHOW,mxUtils.bind(this,function(){this.window.fit()}));
b.installResizeHandler(this,!0)},ConfirmDialog=function(b,e,k,l,C,p,D,M,R,G,L){var Q=document.createElement("div");Q.style.textAlign="center";L=null!=L?L:44;var d=document.createElement("div");d.style.padding="6px";d.style.overflow="auto";d.style.maxHeight=L+"px";d.style.lineHeight="1.2em";mxUtils.write(d,e);Q.appendChild(d);null!=G&&(d=document.createElement("div"),d.style.padding="6px 0 6px 0",e=document.createElement("img"),e.setAttribute("src",G),d.appendChild(e),Q.appendChild(d));G=document.createElement("div");