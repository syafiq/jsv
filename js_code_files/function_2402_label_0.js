`),j=!0);break}case"messageEntityUrl":case"messageEntityTextUrl":{if(!(f.noLinks&&!o[u._])){let b=u.url||v,E=!1,L;const z=xe(b);if(b=z.url,L=z.onclick,f.whitelistedDomains)try{const J=new URL(b).hostname;if(!f.whitelistedDomains.includes(J))break}catch{break}u._==="messageEntityTextUrl"&&(r?._==="messageEntityUrl"&&r.length===u.length&&r.offset===u.offset&&(t.lastEntity=r,++t.i),b!==v&&(E=!0));const B=!!L;!L&&E&&!B&&!f.passMaskedLinks&&(L="showMaskedAlert"),f.wrappingDraft&&(L=void 0);const $=B||typeof electronHelpers>"u"?b:`javascript:electronHelpers.openExternal('${b}');`;l=document.createElement("a"),l.className="anchor-url",l.href=$,B||typeof electronHelpers<"u"||o1(l),L&&l.setAttribute("onclick",L+"(this)")}break}case"messageEntityEmail":{f.noLinks||(l=document.createElement("a"),l.href=C1("mailto:"+v),o1(l));break}case"messageEntityHashtag":{const b=!f.noLinks&&A0[c];if(b){const E=v.slice(1);l=document.createElement("a"),l.className="anchor-hashtag",l.href=b.replace("{1}",encodeURIComponent(E)),h?o1(l):l.setAttribute("onclick","searchByHashtag(this)")}break}case"messageEntityMentionName":{f.noLinks&&!o[u._]||(l=document.createElement("a"),l.href=ed(""+u.user_id),l.className="follow",l.dataset.follow=""+u.user_id);break}case"messageEntityMention":{if(!f.noLinks){const b=v.slice(1);l=rd("t.me/"+b),l.className="mention"}break}case"messageEntitySpoiler":{if(f.noTextFormat){const b=dd(t.text,u);t.text=b.text,S=b.entityText,C!==w&&(t.usedLength+=w-C);let E;for(;E=n[t.i+1],E&&E.offset<w;)++t.i,t.lastEntity=E,r=n[t.i+1]}else if(f.wrappingDraft)l=af("spoiler");else{const b=document.createElement("span");b.className="spoiler",l=document.createElement("span"),l.className="spoiler-text",l.textContent=S,j=!0,b.append(l),e.append(b),b[`on${N0}`]=window.onSpoilerClick}break}case"messageEntityTimestamp":{if(!f.maxMediaTimestamp||u.time>f.maxMediaTimestamp)break;l=document.createElement("a"),l.classList.add("timestamp"),l.dataset.timestamp=""+u.time,l.href="#",l.setAttribute("onclick","setMediaTimestamp(this)"),f.maxMediaTimestamp===1/0&&l.classList.add("is-disabled");break}case"messageEntityBlockquote":{if(f.noTextFormat)break;f.wrappingDraft?l=af("quote"):(l=document.createElement("blockquote"),l.classList.add("quote")),l.classList.add("quote-like","quote-like-border","quote-like-icon"),Te(l),R=!0;break}}if(R){let b=-1;for(let E=t.i;E<g;++E){const L=n[E];if(L._==="messageEntityLinebreak"&&L.offset>=w){b=E;break}}if(b!==-1&&t.text.slice(w,n[b].offset).trim()&&(b=-1),!f.wrappingDraft&&w<t.text.length){if(!l.parentElement){const E=document.createElement("div");E.append(l),e.append(E)}if(t.text[w-1]===`