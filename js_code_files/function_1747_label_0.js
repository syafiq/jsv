App.main=function(b,f){function k(J){mxUtils.getAll("1"!=urlParams.dev?[J]:[J,STYLE_PATH+"/default.xml"],function(D){function N(){var q=null!=f?f():new App(new Editor("0"==urlParams.chrome||"min"==uiTheme,null,null,null,"0"!=urlParams.chrome));if(null!=window.mxscript){if("function"===typeof window.DropboxClient&&null==window.Dropbox&&null!=window.DrawDropboxClientCallback&&("1"!=urlParams.embed&&"0"!=urlParams.db||"1"==urlParams.embed&&"1"==urlParams.db)&&isSvgBrowser&&(null==document.documentMode||
9<document.documentMode))mxscript(App.DROPBOX_URL,function(){mxscript(App.DROPINS_URL,function(){DrawDropboxClientCallback()},"dropboxjs",App.DROPBOX_APPKEY)});else if("undefined"===typeof window.Dropbox||"undefined"===typeof window.Dropbox.choose)window.DropboxClient=null;"function"===typeof window.OneDriveClient&&"undefined"===typeof OneDrive&&null!=window.DrawOneDriveClientCallback&&("1"!=urlParams.embed&&"0"!=urlParams.od||"1"==urlParams.embed&&"1"==urlParams.od)&&(null==navigator.userAgent||
0>navigator.userAgent.indexOf("MSIE")||10<=document.documentMode)?mxscript(App.ONEDRIVE_URL,window.DrawOneDriveClientCallback):"undefined"===typeof window.OneDrive&&(window.OneDriveClient=null);"function"===typeof window.TrelloClient&&!mxClient.IS_IE11&&"undefined"===typeof window.Trello&&null!=window.DrawTrelloClientCallback&&"1"==urlParams.tr&&(null==navigator.userAgent||0>navigator.userAgent.indexOf("MSIE")||10<=document.documentMode)?mxscript(App.TRELLO_JQUERY_URL,function(){mxscript(App.TRELLO_URL,
function(){DrawTrelloClientCallback()})}):"undefined"===typeof window.Trello&&(window.TrelloClient=null)}null!=b&&b(q);"0"!=urlParams.chrome&&"1"==urlParams.test&&(EditorUi.debug("App.start",[q,(new Date).getTime()-t0.getTime()+"ms"]),null!=urlParams["export"]&&EditorUi.debug("Export:",EXPORT_URL))}mxResources.parse(D[0].getText());if(isLocalStorage&&null!=localStorage&&null!=window.location.hash&&"#_CONFIG_"==window.location.hash.substring(0,9))try{var c=JSON.parse(Graph.decompress(window.location.hash.substring(9)));
if(null!=c){EditorUi.debug("Setting configuration",JSON.stringify(c));if(null!=c.merge){var e=localStorage.getItem(Editor.configurationKey);if(null!=e)try{var g=JSON.parse(e),n;for(n in c.merge)g[n]=c.merge[n];c=g}catch(q){window.location.hash="",alert(q)}else c=c.merge}confirm(mxResources.get("configLinkWarn"))&&confirm(mxResources.get("configLinkConfirm"))&&(localStorage.setItem(Editor.configurationKey,JSON.stringify(c)),window.location.hash="",window.location.reload())}window.location.hash=""}catch(q){window.location.hash=
"",alert(q)}1<D.length&&(Graph.prototype.defaultThemes["default-style2"]=D[1].getDocumentElement(),Graph.prototype.defaultThemes.darkTheme=D[1].getDocumentElement());"1"==urlParams.dev||EditorUi.isElectronApp?N():(mxStencilRegistry.allowEval=!1,App.loadScripts(["js/shapes-14-6-5.min.js","js/stencils.min.js","js/extensions.min.js"],N))},function(D){D=document.getElementById("geStatus");null!=D&&(D.innerHTML="Error loading page. <a>Please try refreshing.</a>",D.getElementsByTagName("a")[0].onclick=
function(){mxLanguage="en";k(mxResources.getDefaultBundle(RESOURCE_BASE,mxLanguage)||mxResources.getSpecialBundle(RESOURCE_BASE,mxLanguage))})})}function d(){try{if(null!=mxSettings.settings){document.body.style.backgroundColor="atlas"!=Editor.currentTheme&&"kennedy"!=uiTheme&&(Editor.isDarkMode()||mxSettings.settings.darkMode)?Editor.darkColor:"#ffffff";if(null!=mxSettings.settings.autosaveDelay){var J=parseInt(mxSettings.settings.autosaveDelay);!isNaN(J)&&0<J?(DrawioFile.prototype.autosaveDelay=
J,EditorUi.debug("Setting autosaveDelay",J)):EditorUi.debug("Invalid autosaveDelay",J)}null!=mxSettings.settings.defaultEdgeLength&&(J=parseInt(mxSettings.settings.defaultEdgeLength),!isNaN(J)&&0<J?(Graph.prototype.defaultEdgeLength=J,EditorUi.debug("Using defaultEdgeLength",J)):EditorUi.debug("Invalid defaultEdgeLength",J))}}catch(N){null!=window.console&&console.error(N)}if(null!=Menus.prototype.defaultFonts)for(J=0;J<Menus.prototype.defaultFonts.length;J++){var D=Menus.prototype.defaultFonts[J];
"string"!==typeof D&&null!=D.fontFamily&&null!=D.fontUrl&&Graph.addFont(D.fontFamily,D.fontUrl)}mxResources.loadDefaultBundle=!1;k(mxResources.getDefaultBundle(RESOURCE_BASE,mxLanguage)||mxResources.getSpecialBundle(RESOURCE_BASE,mxLanguage))}window.onerror=function(J,D,N,c,e){EditorUi.logError("Global: "+(null!=J?J:""),D,N,c,e,null,!0)};if(window.top!=window.self||"import.diagrams.net"!==window.location.hostname&&"ac.draw.io"!==window.location.hostname&&"aj.draw.io"!==window.location.hostname){if("1"==
urlParams.embed||"1"==urlParams.lightbox){var u=document.getElementById("geInfo");null!=u&&u.parentNode.removeChild(u)}null!=document.referrer&&"aws3"==urlParams.libs&&"https://aws.amazon.com/architecture/icons/"==document.referrer.substring(0,42)&&(urlParams.libs="aws4");if(null!=window.mxscript){if("1"==urlParams.dev&&!mxClient.IS_CHROMEAPP&&!EditorUi.isElectronApp&&null!=CryptoJS&&App.mode!=App.MODE_DROPBOX&&App.mode!=App.MODE_TRELLO){u=document.getElementsByTagName("script");if(null!=u&&0<u.length){var v=
mxUtils.getTextContent(u[0]);"1f536e2400baaa30261b8c3976d6fe06"!=CryptoJS.MD5(v).toString()&&(console.log("Change bootstrap script MD5 in the previous line:",CryptoJS.MD5(v).toString()),alert("[Dev] Bootstrap script change requires update of CSP"))}null!=u&&1<u.length&&(v=mxUtils.getTextContent(u[u.length-1]),"d53805dd6f0bbba2da4966491ca0a505"!=CryptoJS.MD5(v).toString()&&(console.log("Change main script MD5 in the previous line:",CryptoJS.MD5(v).toString()),alert("[Dev] Main script change requires update of CSP")))}try{Editor.enableServiceWorker&&
("0"==urlParams.offline||/www\.draw\.io$/.test(window.location.hostname)||"1"!=urlParams.offline&&"1"==urlParams.dev)?App.clearServiceWorker(function(){"0"==urlParams.offline&&alert("Cache cleared")}):Editor.enableServiceWorker&&navigator.serviceWorker.register("service-worker.js")}catch(J){null!=window.console&&console.error(J)}!("ArrayBuffer"in window)||mxClient.IS_CHROMEAPP||EditorUi.isElectronApp||"auto"!=DrawioFile.SYNC||"1"==urlParams.embed&&"1"!=urlParams.embedRT||"1"==urlParams.local||"0"==
urlParams.chrome&&"1"!=urlParams.rt||"1"==urlParams.stealth||"1"==urlParams.offline||(mxscript(App.PUSHER_URL),"1"==urlParams["fast-sync"]&&mxscript(App.SIMPLE_PEER_URL));if("0"!=urlParams.plugins&&"1"!=urlParams.offline){u=null!=mxSettings.settings?mxSettings.getPlugins():null;if(null==mxSettings.settings&&isLocalStorage&&"undefined"!==typeof JSON)try{var A=JSON.parse(localStorage.getItem(mxSettings.key));null!=A&&(u=A.plugins)}catch(J){}A=urlParams.p;App.initPluginCallback();null!=A&&App.loadPlugins(A.split(";"));
if(null!=u&&0<u.length&&"0"!=urlParams.plugins)for(A=0;A<u.length;A++)try{("/"==u[A].charAt(0)&&(u[A]=PLUGINS_BASE_PATH+u[A]),App.isSameDomain(u[A]))?ALLOW_CUSTOM_PLUGINS||App.isBuiltInPlugin(u[A])?null==App.pluginsLoaded[u[A]]&&(App.pluginsLoaded[u[A]]=!0,App.embedModePluginsCount++,mxscript(u[A])):null!=window.console&&console.log("Unknown plugin:",u[A]):null!=window.console&&console.log("Blocked plugin:",u[A])}catch(J){}}"function"===typeof window.DriveClient&&"undefined"===typeof gapi&&("1"!=
urlParams.embed&&"0"!=urlParams.gapi||"1"==urlParams.embed&&"1"==urlParams.gapi)&&isSvgBrowser&&isLocalStorage&&(null==document.documentMode||10<=document.documentMode)?mxscript("https://apis.google.com/js/api.js?onload=DrawGapiClientCallback",null,null,null,mxClient.IS_SVG):"undefined"===typeof window.gapi&&(window.DriveClient=null)}"0"!=urlParams.math&&Editor.initMath();if("1"==urlParams.configure){var F=window.opener||window.parent,I=function(J){if(J.source==F)try{var D=JSON.parse(J.data);null!=
D&&"configure"==D.action&&(mxEvent.removeListener(window,"message",I),Editor.configure(D.config),mxSettings.load(),D.colorSchemeMeta&&mxmeta("color-scheme","dark light"),d())}catch(N){null!=window.console&&console.log("Error in configure message: "+N,J.data)}};mxEvent.addListener(window,"message",I);F.postMessage(JSON.stringify({event:"configure"}),"*")}else{if(null==Editor.config){if(null!=window.DRAWIO_CONFIG)try{EditorUi.debug("Using global configuration",window.DRAWIO_CONFIG),Editor.configure(window.DRAWIO_CONFIG),
mxSettings.load()}catch(J){null!=window.console&&console.error(J)}if(isLocalStorage&&null!=localStorage&&"1"!=urlParams.embed&&(A=localStorage.getItem(Editor.configurationKey),null!=A))try{A=JSON.parse(A),null!=A&&(EditorUi.debug("Using local configuration",A),Editor.configure(A),mxSettings.load())}catch(J){null!=window.console&&console.error(J)}}d()}}else document.body.innerHTML='<div style="margin-top:10%;text-align:center;">Stand-alone mode not allowed for this domain.</div>'};