var CommentsWindow=function(b,e,k,l,B,q){function D(){for(var ba=H.getElementsByTagName("div"),oa=0,sa=0;sa<ba.length;sa++)"none"!=ba[sa].style.display&&ba[sa].parentNode==H&&oa++;P.style.display=0==oa?"block":"none"}function N(ba,oa,sa,J){function V(){oa.removeChild(Y);oa.removeChild(p);ca.style.display="block";T.style.display="block"}u={div:oa,comment:ba,saveCallback:sa,deleteOnCancel:J};var T=oa.querySelector(".geCommentTxt"),ca=oa.querySelector(".geCommentActionsList"),Y=document.createElement("textarea");
Y.className="geCommentEditTxtArea";Y.style.minHeight=T.offsetHeight+"px";Y.value=ba.content;oa.insertBefore(Y,T);var p=document.createElement("div");p.className="geCommentEditBtns";var E=mxUtils.button(mxResources.get("cancel"),function(){J?(oa.parentNode.removeChild(oa),D()):V();u=null});E.className="geCommentEditBtn";p.appendChild(E);var Q=mxUtils.button(mxResources.get("save"),function(){T.innerText="";ba.content=Y.value;mxUtils.write(T,ba.content);V();sa(ba);u=null});mxEvent.addListener(Y,"keydown",
mxUtils.bind(this,function(Z){mxEvent.isConsumed(Z)||((mxEvent.isControlDown(Z)||mxClient.IS_MAC&&mxEvent.isMetaDown(Z))&&13==Z.keyCode?(Q.click(),mxEvent.consume(Z)):27==Z.keyCode&&(E.click(),mxEvent.consume(Z)))}));Q.focus();Q.className="geCommentEditBtn gePrimaryBtn";p.appendChild(Q);oa.insertBefore(p,T);ca.style.display="none";T.style.display="none";Y.focus()}function S(ba,oa){oa.innerText="";ba=new Date(ba.modifiedDate);var sa=b.timeSince(ba);null==sa&&(sa=mxResources.get("lessThanAMinute"));
mxUtils.write(oa,mxResources.get("timeAgo",[sa],"{1} ago"));oa.setAttribute("title",ba.toLocaleDateString()+" "+ba.toLocaleTimeString())}function F(ba){var oa=document.createElement("img");oa.className="geCommentBusyImg";oa.src=IMAGE_PATH+"/spin.gif";ba.appendChild(oa);ba.busyImg=oa}function K(ba){ba.style.border="1px solid red";ba.removeChild(ba.busyImg)}function R(ba){ba.style.border="";ba.removeChild(ba.busyImg)}function d(ba,oa,sa,J,V){function T(X,da,la){var pa=document.createElement("li");pa.className=
"geCommentAction";var ma=document.createElement("a");ma.className="geCommentActionLnk";mxUtils.write(ma,X);pa.appendChild(ma);mxEvent.addListener(ma,"click",function(qa){da(qa,ba);qa.preventDefault();mxEvent.consume(qa)});W.appendChild(pa);la&&(pa.style.display="none")}function ca(){function X(pa){da.push(la);if(null!=pa.replies)for(var ma=0;ma<pa.replies.length;ma++)la=la.nextSibling,X(pa.replies[ma])}var da=[],la=p;X(ba);return{pdiv:la,replies:da}}function Y(X,da,la,pa,ma){function qa(){F(ta);ba.addReply(ra,
function(Aa){ra.id=Aa;ba.replies.push(ra);R(ta);la&&la()},function(Aa){za();K(ta);b.handleError(Aa,null,null,null,mxUtils.htmlEntities(mxResources.get("objectNotFound")))},pa,ma)}function za(){N(ra,ta,function(Aa){qa()},!0)}var ya=ca().pdiv,ra=b.newComment(X,b.getCurrentUser());ra.pCommentId=ba.id;null==ba.replies&&(ba.replies=[]);var ta=d(ra,ba.replies,ya,J+1);da?za():qa()}if(V||!ba.isResolved){P.style.display="none";var p=document.createElement("div");p.className="geCommentContainer";p.setAttribute("data-commentId",
ba.id);p.style.marginLeft=20*J+5+"px";ba.isResolved&&!Editor.isDarkMode()&&(p.style.backgroundColor="ghostWhite");var E=document.createElement("div");E.className="geCommentHeader";var Q=document.createElement("img");Q.className="geCommentUserImg";Q.src=ba.user.pictureUrl||Editor.userImage;E.appendChild(Q);Q=document.createElement("div");Q.className="geCommentHeaderTxt";E.appendChild(Q);var Z=document.createElement("div");Z.className="geCommentUsername";mxUtils.write(Z,ba.user.displayName||"");Q.appendChild(Z);
Z=document.createElement("div");Z.className="geCommentDate";Z.setAttribute("data-commentId",ba.id);S(ba,Z);Q.appendChild(Z);p.appendChild(E);E=document.createElement("div");E.className="geCommentTxt";mxUtils.write(E,ba.content||"");p.appendChild(E);ba.isLocked&&(p.style.opacity="0.5");E=document.createElement("div");E.className="geCommentActions";var W=document.createElement("ul");W.className="geCommentActionsList";E.appendChild(W);f||ba.isLocked||0!=J&&!g||T(mxResources.get("reply"),function(){Y("",
!0)},ba.isResolved);Q=b.getCurrentUser();null==Q||Q.id!=ba.user.id||f||ba.isLocked||(T(mxResources.get("edit"),function(){function X(){N(ba,p,function(){F(p);ba.editComment(ba.content,function(){R(p)},function(da){K(p);X();b.handleError(da,null,null,null,mxUtils.htmlEntities(mxResources.get("objectNotFound")))})})}X()},ba.isResolved),T(mxResources.get("delete"),function(){b.confirm(mxResources.get("areYouSure"),function(){F(p);ba.deleteComment(function(X){if(!0===X){X=p.querySelector(".geCommentTxt");
X.innerText="";mxUtils.write(X,mxResources.get("msgDeleted"));var da=p.querySelectorAll(".geCommentAction");for(X=0;X<da.length;X++)da[X].parentNode.removeChild(da[X]);R(p);p.style.opacity="0.5"}else{da=ca(ba).replies;for(X=0;X<da.length;X++)H.removeChild(da[X]);for(X=0;X<oa.length;X++)if(oa[X]==ba){oa.splice(X,1);break}P.style.display=0==H.getElementsByTagName("div").length?"block":"none"}},function(X){K(p);b.handleError(X,null,null,null,mxUtils.htmlEntities(mxResources.get("objectNotFound")))})})},
ba.isResolved));f||ba.isLocked||0!=J||T(ba.isResolved?mxResources.get("reopen"):mxResources.get("resolve"),function(X){function da(){var la=X.target;la.innerText="";ba.isResolved=!ba.isResolved;mxUtils.write(la,ba.isResolved?mxResources.get("reopen"):mxResources.get("resolve"));for(var pa=ba.isResolved?"none":"",ma=ca(ba).replies,qa=Editor.isDarkMode()?"transparent":ba.isResolved?"ghostWhite":"white",za=0;za<ma.length;za++){ma[za].style.backgroundColor=qa;for(var ya=ma[za].querySelectorAll(".geCommentAction"),
ra=0;ra<ya.length;ra++)ya[ra]!=la.parentNode&&(ya[ra].style.display=pa);ia||(ma[za].style.display="none")}D()}ba.isResolved?Y(mxResources.get("reOpened")+": ",!0,da,!1,!0):Y(mxResources.get("markedAsResolved"),!1,da,!0)});p.appendChild(E);null!=sa?H.insertBefore(p,sa.nextSibling):H.appendChild(p);for(sa=0;null!=ba.replies&&sa<ba.replies.length;sa++)E=ba.replies[sa],E.isResolved=ba.isResolved,d(E,ba.replies,null,J+1,V);null!=u&&(u.comment.id==ba.id?(V=ba.content,ba.content=u.comment.content,N(ba,p,
u.saveCallback,u.deleteOnCancel),ba.content=V):null==u.comment.id&&u.comment.pCommentId==ba.id&&(H.appendChild(u.div),N(u.comment,u.div,u.saveCallback,u.deleteOnCancel)));return p}}var f=!b.canComment(),g=b.canReplyToReplies(),u=null,x=document.createElement("div");x.className="geCommentsWin";x.style.background=Editor.isDarkMode()?Dialog.backdropColor:"whiteSmoke";var A=EditorUi.compactUi?"26px":"30px",H=document.createElement("div");H.className="geCommentsList";H.style.backgroundColor=Editor.isDarkMode()?
Dialog.backdropColor:"whiteSmoke";H.style.bottom=parseInt(A)+7+"px";x.appendChild(H);var P=document.createElement("span");P.style.cssText="display:none;padding-top:10px;text-align:center;";mxUtils.write(P,mxResources.get("noCommentsFound"));var M=document.createElement("div");M.className="geToolbarContainer geCommentsToolbar";M.style.height=A;M.style.padding=EditorUi.compactUi?"4px 0px 3px 0px":"1px";M.style.backgroundColor=Editor.isDarkMode()?Dialog.backdropColor:"whiteSmoke";A=document.createElement("a");
A.className="geButton";if(!f){var G=A.cloneNode();G.innerHTML='<div class="geSprite geSprite-plus" style="display:inline-block;"></div>';G.setAttribute("title",mxResources.get("create")+"...");mxEvent.addListener(G,"click",function(ba){function oa(){N(sa,J,function(V){F(J);b.addComment(V,function(T){V.id=T;ja.push(V);R(J)},function(T){K(J);oa();b.handleError(T,null,null,null,mxUtils.htmlEntities(mxResources.get("objectNotFound")))})},!0)}var sa=b.newComment("",b.getCurrentUser()),J=d(sa,ja,null,0);
oa();ba.preventDefault();mxEvent.consume(ba)});M.appendChild(G)}G=A.cloneNode();G.innerHTML='<img src="'+IMAGE_PATH+'/check.png" style="width: 16px; padding: 2px;">';G.setAttribute("title",mxResources.get("showResolved"));G.className="geAdaptiveAsset";var ia=!1;mxEvent.addListener(G,"click",function(ba){this.className=(ia=!ia)?"geButton geCheckedBtn":"geButton";ha();ba.preventDefault();mxEvent.consume(ba)});M.appendChild(G);b.commentsRefreshNeeded()&&(G=A.cloneNode(),G.innerHTML='<img src="'+IMAGE_PATH+
'/update16.png" style="width: 16px; padding: 2px;">',G.setAttribute("title",mxResources.get("refresh")),G.className="geAdaptiveAsset",mxEvent.addListener(G,"click",function(ba){ha();ba.preventDefault();mxEvent.consume(ba)}),M.appendChild(G));b.commentsSaveNeeded()&&(A=A.cloneNode(),A.innerHTML='<img src="'+IMAGE_PATH+'/save.png" style="width: 20px; padding: 2px;">',A.setAttribute("title",mxResources.get("save")),A.className="geAdaptiveAsset",mxEvent.addListener(A,"click",function(ba){q();ba.preventDefault();
mxEvent.consume(ba)}),M.appendChild(A));x.appendChild(M);var ja=[],ha=mxUtils.bind(this,function(){this.hasError=!1;if(null!=u)try{u.div=u.div.cloneNode(!0);var ba=u.div.querySelector(".geCommentEditTxtArea"),oa=u.div.querySelector(".geCommentEditBtns");u.comment.content=ba.value;ba.parentNode.removeChild(ba);oa.parentNode.removeChild(oa)}catch(sa){b.handleError(sa)}H.innerHTML='<div style="padding-top:10px;text-align:center;"><img src="'+IMAGE_PATH+'/spin.gif" valign="middle"> '+mxUtils.htmlEntities(mxResources.get("loading"))+
"...</div>";g=b.canReplyToReplies();b.commentsSupported()?b.getComments(function(sa){function J(V){if(null!=V){V.sort(function(ca,Y){return new Date(ca.modifiedDate)-new Date(Y.modifiedDate)});for(var T=0;T<V.length;T++)J(V[T].replies)}}sa.sort(function(V,T){return new Date(V.modifiedDate)-new Date(T.modifiedDate)});H.innerText="";H.appendChild(P);P.style.display="block";ja=sa;for(sa=0;sa<ja.length;sa++)J(ja[sa].replies),d(ja[sa],ja,null,0,ia);null!=u&&null==u.comment.id&&null==u.comment.pCommentId&&
(H.appendChild(u.div),N(u.comment,u.div,u.saveCallback,u.deleteOnCancel))},mxUtils.bind(this,function(sa){H.innerHTML=mxUtils.htmlEntities(mxResources.get("error")+(sa&&sa.message?": "+sa.message:""));this.hasError=!0})):H.innerHTML=mxUtils.htmlEntities(mxResources.get("error"))});ha();this.refreshComments=ha;M=mxUtils.bind(this,function(){function ba(T){var ca=sa[T.id];if(null!=ca)for(S(T,ca),ca=0;null!=T.replies&&ca<T.replies.length;ca++)ba(T.replies[ca])}if(this.window.isVisible()){for(var oa=
H.querySelectorAll(".geCommentDate"),sa={},J=0;J<oa.length;J++){var V=oa[J];sa[V.getAttribute("data-commentId")]=V}for(J=0;J<ja.length;J++)ba(ja[J])}});setInterval(M,6E4);this.refreshCommentsTime=M;this.window=new mxWindow(mxResources.get("comments"),x,e,k,l,B,!0,!0);this.window.minimumSize=new mxRectangle(0,0,300,200);this.window.destroyOnClose=!1;this.window.setMaximizable(!1);this.window.setResizable(!0);this.window.setClosable(!0);this.window.setVisible(!0);this.window.addListener(mxEvent.SHOW,
mxUtils.bind(this,function(){this.window.fit()}));b.installResizeHandler(this,!0)},ConfirmDialog=function(b,e,k,l,B,q,D,N,S,F,K){var R=document.createElement("div");R.style.textAlign="center";K=null!=K?K:44;var d=document.createElement("div");d.style.padding="6px";d.style.overflow="auto";d.style.maxHeight=K+"px";d.style.lineHeight="1.2em";mxUtils.write(d,e);R.appendChild(d);null!=F&&(d=document.createElement("div"),d.style.padding="6px 0 6px 0",e=document.createElement("img"),e.setAttribute("src",