mxEvent.consume(n)}));e.appendChild(g);return e}return null};EditorUi.prototype.handleError=function(e,g,k,n,u,v,E){var C=null!=this.spinner&&null!=this.spinner.pause?this.spinner.pause():function(){},H=null!=e&&null!=e.error?e.error:e;if(null!=e&&("1"==urlParams.test||null!=e.stack)&&null!=e.message)try{E?null!=window.console&&console.error("EditorUi.handleError:",e):EditorUi.logError("Caught: "+(""==e.message&&null!=e.name)?e.name:e.message,e.filename,e.lineNumber,e.columnNumber,e,"INFO")}catch(G){}if(null!=
H||null!=g){E=mxUtils.htmlEntities(mxResources.get("unknownError"));var F=mxResources.get("ok"),T=null;g=null!=g?g:mxResources.get("error");if(null!=H){null!=H.retry&&(F=mxResources.get("cancel"),T=function(){C();H.retry()});if(404==H.code||404==H.status||403==H.code){E=403==H.code?null!=H.message?mxUtils.htmlEntities(H.message):mxUtils.htmlEntities(mxResources.get("accessDenied")):null!=u?u:mxUtils.htmlEntities(mxResources.get("fileNotFoundOrDenied")+(null!=this.drive&&null!=this.drive.user?" ("+
this.drive.user.displayName+", "+this.drive.user.email+")":""));var p=null!=u?null:null!=v?v:window.location.hash;if(null!=p&&("#G"==p.substring(0,2)||"#Uhttps%3A%2F%2Fdrive.google.com%2Fuc%3Fid%3D"==p.substring(0,45))&&(null!=e&&null!=e.error&&(null!=e.error.errors&&0<e.error.errors.length&&"fileAccess"==e.error.errors[0].reason||null!=e.error.data&&0<e.error.data.length&&"fileAccess"==e.error.data[0].reason)||404==H.code||404==H.status)){p="#U"==p.substring(0,2)?p.substring(45,p.lastIndexOf("%26ex")):
p.substring(2);this.showError(g,E,mxResources.get("openInNewWindow"),mxUtils.bind(this,function(){this.editor.graph.openLink("https://drive.google.com/open?id="+p);this.handleError(e,g,k,n,u)}),T,mxResources.get("changeUser"),mxUtils.bind(this,function(){function G(){M.innerText="";for(var Q=0;Q<K.length;Q++){var P=document.createElement("option");mxUtils.write(P,K[Q].displayName);P.value=Q;M.appendChild(P);P=document.createElement("option");P.innerHTML="&nbsp;&nbsp;&nbsp;";mxUtils.write(P,"<"+K[Q].email+
">");P.setAttribute("disabled","disabled");M.appendChild(P)}P=document.createElement("option");mxUtils.write(P,mxResources.get("addAccount"));P.value=K.length;M.appendChild(P)}var K=this.drive.getUsersList(),N=document.createElement("div"),I=document.createElement("span");I.style.marginTop="6px";mxUtils.write(I,mxResources.get("changeUser")+": ");N.appendChild(I);var M=document.createElement("select");M.style.width="200px";G();mxEvent.addListener(M,"change",mxUtils.bind(this,function(){var Q=M.value,
P=K.length!=Q;P&&this.drive.setUser(K[Q]);this.drive.authorize(P,mxUtils.bind(this,function(){P||(K=this.drive.getUsersList(),G())}),mxUtils.bind(this,function(V){this.handleError(V)}),!0)}));N.appendChild(M);N=new CustomDialog(this,N,mxUtils.bind(this,function(){this.loadFile(window.location.hash.substr(1),!0)}));this.showDialog(N.container,300,100,!0,!0)}),mxResources.get("cancel"),mxUtils.bind(this,function(){this.hideDialog();null!=k&&k()}),480,150);return}}null!=H.message?E=""==H.message&&null!=
H.name?mxUtils.htmlEntities(H.name):mxUtils.htmlEntities(H.message):null!=H.response&&null!=H.response.error?E=mxUtils.htmlEntities(H.response.error):"undefined"!==typeof window.App&&(H.code==App.ERROR_TIMEOUT?E=mxUtils.htmlEntities(mxResources.get("timeout")):H.code==App.ERROR_BUSY?E=mxUtils.htmlEntities(mxResources.get("busy")):"string"===typeof H&&0<H.length&&(E=mxUtils.htmlEntities(H)))}var x=v=null;null!=H&&null!=H.helpLink?(v=mxResources.get("help"),x=mxUtils.bind(this,function(){return this.editor.graph.openLink(H.helpLink)})):
null!=H&&null!=H.ownerEmail&&(v=mxResources.get("contactOwner"),E+=mxUtils.htmlEntities(" ("+v+": "+H.ownerEmail+")"),x=mxUtils.bind(this,function(){return this.openLink("mailto:"+mxUtils.htmlEntities(H.ownerEmail))}));this.showError(g,E,F,k,T,null,null,v,x,null,null,null,n?k:null)}else null!=k&&k()};EditorUi.prototype.alert=function(e,g,k){e=new ErrorDialog(this,null,e,mxResources.get("ok"),g);this.showDialog(e.container,k||340,100,!0,!1);e.init()};EditorUi.prototype.confirm=function(e,g,k,n,u,v){var E=