"...");u.value=e;H.updateCellSize(u);if(0<this.maxTextWidth&&u.geometry.width>this.maxTextWidth){var p=H.getPreferredSizeForCell(u,this.maxTextWidth);u.geometry.width=p.width;u.geometry.height=p.height}Graph.isLink(u.value)&&H.setLinkForCell(u,u.value);u.geometry.width+=H.gridSize;u.geometry.height+=H.gridSize}finally{H.getModel().endUpdate()}return[u]}}return[]};EditorUi.prototype.formatFileSize=function(e){var g=-1;do e/=1024,g++;while(1024<e);return Math.max(e,.1).toFixed(1)+" kB; MB; GB; TB;PB;EB;ZB;YB".split(";")[g]};
EditorUi.prototype.convertDataUri=function(e){if("data:"==e.substring(0,5)){var g=e.indexOf(";");0<g&&(e=e.substring(0,g)+e.substring(e.indexOf(",",g+1)))}return e};EditorUi.prototype.isRemoteFileFormat=function(e,g){return/("contentType":\s*"application\/gliffy\+json")/.test(e)};EditorUi.prototype.isLucidChartData=function(e){return null!=e&&('{"state":"{\\"Properties\\":'==e.substring(0,26)||'{"Properties":'==e.substring(0,14))};EditorUi.prototype.importLocalFile=function(e,g){if(e&&Graph.fileSupport){if(null==
this.importFileInputElt){var k=document.createElement("input");k.setAttribute("type","file");mxEvent.addListener(k,"change",mxUtils.bind(this,function(){null!=k.files&&(this.importFiles(k.files,null,null,this.maxImageSize),k.type="",k.type="file",k.value="")}));k.style.display="none";document.body.appendChild(k);this.importFileInputElt=k}this.importFileInputElt.click()}else{window.openNew=!1;window.openKey="import";window.listBrowserFiles=mxUtils.bind(this,function(E,C){StorageFile.listFiles(this,
"F",E,C)});window.openBrowserFile=mxUtils.bind(this,function(E,C,H){StorageFile.getFileContent(this,E,C,H)});window.deleteBrowserFile=mxUtils.bind(this,function(E,C,H){StorageFile.deleteFile(this,E,C,H)});if(!g){var n=Editor.useLocalStorage;Editor.useLocalStorage=!e}window.openFile=new OpenFile(mxUtils.bind(this,function(E){this.hideDialog(E)}));window.openFile.setConsumer(mxUtils.bind(this,function(E,C){null!=C&&Graph.fileSupport&&/(\.v(dx|sdx?))($|\?)/i.test(C)?(E=new Blob([E],{type:"application/octet-stream"}),
this.importVisio(E,mxUtils.bind(this,function(H){this.importXml(H,0,0,!0)}),null,C)):this.editor.graph.setSelectionCells(this.importXml(E,0,0,!0))}));this.showDialog((new OpenDialog(this)).container,Editor.useLocalStorage?640:360,Editor.useLocalStorage?480:220,!0,!0,function(){window.openFile=null});if(!g){var u=this.dialog,v=u.close;this.dialog.close=mxUtils.bind(this,function(E){Editor.useLocalStorage=n;v.apply(u,arguments);E&&null==this.getCurrentFile()&&"1"!=urlParams.embed&&this.showSplash()})}}};
EditorUi.prototype.importZipFile=function(e,g,k){var n=this,u=mxUtils.bind(this,function(){this.loadingExtensions=!1;"undefined"!==typeof JSZip?JSZip.loadAsync(e).then(function(v){if(mxUtils.isEmptyObject(v.files))k();else{var E=0,C,H=!1;v.forEach(function(F,T){F=T.name.toLowerCase();"diagram/diagram.xml"==F?(H=!0,T.async("string").then(function(p){0==p.indexOf("<mxfile ")?g(p):k()})):0==F.indexOf("versions/")&&(F=parseInt(F.substr(9)),F>E&&(E=F,C=T))});0<E?C.async("string").then(function(F){(new XMLHttpRequest).upload&&
n.isRemoteFileFormat(F,e.name)?n.isOffline()?n.showError(mxResources.get("error"),mxResources.get("notInOffline"),null,k):n.parseFileData(F,mxUtils.bind(this,function(T){4==T.readyState&&(200<=T.status&&299>=T.status?g(T.responseText):k())}),e.name):k()}):H||k()}},function(v){k(v)}):k()});"undefined"!==typeof JSZip||this.loadingExtensions||this.isOffline(!0)?u():(this.loadingExtensions=!0,mxscript("js/extensions.min.js",u))};EditorUi.prototype.importFile=function(e,g,k,n,u,v,E,C,H,F,T,p){F=null!=
F?F:!0;var x=!1,G=null,K=mxUtils.bind(this,function(N){var I=null;null!=N&&"<mxlibrary"==N.substring(0,10)?this.loadLibrary(new LocalLibrary(this,N,E)):I=this.importXml(N,k,n,F,null,null!=p?mxEvent.isControlDown(p):null);null!=C&&C(I)});"image"==g.substring(0,5)?(H=!1,"image/png"==g.substring(0,9)&&(g=T?null:this.extractGraphModelFromPng(e),null!=g&&0<g.length&&(G=this.importXml(g,k,n,F,null,null!=p?mxEvent.isControlDown(p):null),H=!0)),H||(g=this.editor.graph,H=e.indexOf(";"),0<H&&(e=e.substring(0,
H)+e.substring(e.indexOf(",",H+1))),F&&g.isGridEnabled()&&(k=g.snap(k),n=g.snap(n)),G=[g.insertVertex(null,null,"",k,n,u,v,"shape=image;verticalLabelPosition=bottom;labelBackgroundColor=default;verticalAlign=top;aspect=fixed;imageAspect=0;image="+e+";")])):/(\.*<graphml )/.test(e)?(x=!0,this.importGraphML(e,K)):null!=H&&null!=E&&(/(\.v(dx|sdx?))($|\?)/i.test(E)||/(\.vs(x|sx?))($|\?)/i.test(E))?(x=!0,this.importVisio(H,K)):(new XMLHttpRequest).upload&&this.isRemoteFileFormat(e,E)?this.isOffline()?
this.showError(mxResources.get("error"),mxResources.get("notInOffline")):(x=!0,u=mxUtils.bind(this,function(N){4==N.readyState&&(200<=N.status&&299>=N.status?K(N.responseText):null!=C&&(C(null),this.showError(mxResources.get("error"),413==N.status?mxResources.get("diagramTooLarge"):mxResources.get("unknownError"))))}),null!=e?this.parseFileData(e,u,E):this.parseFile(H,u,E)):0==e.indexOf("PK")&&null!=H?(x=!0,this.importZipFile(H,K,mxUtils.bind(this,function(){G=this.insertTextAt(this.validateFileData(e),
k,n,!0,null,F);C(G)}))):/(\.v(sd|dx))($|\?)/i.test(E)||/(\.vs(s|x))($|\?)/i.test(E)||(G=this.insertTextAt(this.validateFileData(e),k,n,!0,null,F,null,null!=p?mxEvent.isControlDown(p):null));x||null==C||C(G);return G};EditorUi.prototype.importFiles=function(e,g,k,n,u,v,E,C,H,F,T,p,x){n=null!=n?n:this.maxImageSize;F=null!=F?F:this.maxImageBytes;var G=null!=g&&null!=k,K=!0;g=null!=g?g:0;k=null!=k?k:0;var N=!1;if(!mxClient.IS_CHROMEAPP&&null!=e)for(var I=T||this.resampleThreshold,M=0;M<e.length;M++)if("image/svg"!==