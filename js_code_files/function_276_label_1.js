App.prototype.saveFile=function(b,d){var f=this.getCurrentFile();if(null!=f){var c=mxUtils.bind(this,function(){EditorUi.enableDrafts&&f.removeDraft();this.getCurrentFile()==f||f.isModified()||(f.getMode()!=App.MODE_DEVICE?this.editor.setStatus(mxUtils.htmlEntities(mxResources.get("allChangesSaved"))):this.editor.setStatus(""));null!=d&&d()});if(b||null==f.getTitle()||null!=f.invalidFileHandle||null==this.mode)if(null!=f&&f.constructor==LocalFile&&null!=f.fileHandle)this.showSaveFilePicker(mxUtils.bind(this,
function(B,z){f.invalidFileHandle=null;f.fileHandle=B;f.title=z.name;f.desc=z;this.save(z.name,c)}),null,this.createFileSystemOptions(f.getTitle()));else{var l=null!=f.getTitle()?f.getTitle():this.defaultFilename,m=!mxClient.IS_IOS||!navigator.standalone,t=this.mode;b=this.getServiceCount(!0);isLocalStorage&&b++;var y=4>=b?2:6<b?4:3;l=new CreateDialog(this,l,mxUtils.bind(this,function(B,z,A){null!=B&&0<B.length&&(/(\.pdf)$/i.test(B)?this.confirm(mxResources.get("didYouMeanToExportToPdf"),mxUtils.bind(this,
function(){this.hideDialog();this.actions.get("exportPdf").funct()}),mxUtils.bind(this,function(){A.value=B.split(".").slice(0,-1).join(".");A.focus();mxClient.IS_GC||mxClient.IS_FF||5<=document.documentMode?A.select():document.execCommand("selectAll",!1,null)}),mxResources.get("yes"),mxResources.get("no")):(this.hideDialog(),null==t&&z==App.MODE_DEVICE?null!=f&&EditorUi.nativeFileSupport?this.showSaveFilePicker(mxUtils.bind(this,function(J,e){f.fileHandle=J;f.mode=App.MODE_DEVICE;f.title=e.name;
f.desc=e;this.setMode(App.MODE_DEVICE);this.save(e.name,c)}),mxUtils.bind(this,function(J){"AbortError"!=J.name&&this.handleError(J)}),this.createFileSystemOptions(B)):(this.setMode(App.MODE_DEVICE),this.save(B,c)):"download"==z?(new LocalFile(this,null,B)).save():"_blank"==z?(window.openFile=new OpenFile(function(){window.openFile=null}),window.openFile.setData(this.getFileData(!0)),this.openLink(this.getUrl(window.location.pathname),null,!0)):t!=z?this.pickFolder(z,mxUtils.bind(this,function(J){this.createFile(B,
this.getFileData(/(\.xml)$/i.test(B)||0>B.indexOf(".")||/(\.drawio)$/i.test(B),/(\.svg)$/i.test(B),/(\.html)$/i.test(B)),null,z,c,null==this.mode,J)})):null!=z&&this.save(B,c)))}),mxUtils.bind(this,function(){this.hideDialog()}),mxResources.get("saveAs"),mxResources.get("download"),null,null,m,null,!0,y,null,null,null,this.editor.fileExtensions,!1);this.showDialog(l.container,420,b>y?390:280,!0,!0);l.init()}else this.save(f.getTitle(),c)}};