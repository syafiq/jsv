    </div>`;const e=[["search justify-self-start","search",-1],["emoji","smile",0],["stickers","stickers_face",1],["gifs","gifs",2],["delete justify-self-end","deleteleft",-1]],t=o.firstElementChild;return t.lastElementChild.append(...e.map(([s,i,n])=>{const a=Xe(`${i} menu-horizontal-div-item emoji-tabs-${s}`,{noRipple:!0});return a.dataset.tab=""+n,a})),t},ic="primary-text-color",Pg=class Pg extends kl{constructor(e={}){super({element:XP(),ignoreOutClickClassName:"input-message-input"}),this.lazyLoadQueue=new ha(1),this.tabId=-1,this.tabsToRender=[],this.onSelectTabClick=t=>{if(this.tabId===t){const{tab:n}=this;this.scrollTo(n,n.scrollable.firstElementChild);return}const i={...this.getTabsFromRenderer(ll)&&{[this.getTabsFromRenderer(ll).tabId]:"send_stickers"},...this.getTabsFromRenderer(bd)&&{[this.getTabsFromRenderer(bd).tabId]:"send_gifs"}}[t];if(i&&!this.rights[i])return Re({langPackKey:or[i]}),!1;ut.checkAnimations(!0,en),this.tabId=t,this.searchButton.classList.toggle("hide",this.tabId===this.getTabsFromRenderer(Fn)?.tabId),this.deleteBtn.classList.toggle("hide",this.tabId!==this.getTabsFromRenderer(Fn)?.tabId)},this.checkRights=async()=>{const{peerId:t,threadId:s}=this.chatInput.chat,i=Object.keys(this.rights),n=await Promise.all(i.map(l=>this.managers.appMessagesManager.canSendToPeer(t,s,l)));i.forEach((l,c)=>{this.rights[l]=n[c]});const a=this.getTabsFromRenderer(Fn),r=this.tabsEl.querySelector(".active");r&&ui(r)!==a?.tabId+1&&(!this.rights.send_stickers||!this.rights.send_gifs)&&this.selectTab(a.tabId,!1),a?.toggleCustomCategory()},this.onMediaClick=async(t,s=!1,i)=>{const n=oi(t.target,"DIV");if(!n)return!1;const a=n.dataset.docId;return a?this.sendDocId(a,s,i):!1},Lt(this,e),this.listenerSetter=new Qt,this.isStandalone=!!e?.tabsToRender,this.element.classList.toggle("is-standalone",this.isStandalone),this.rights={send_gifs:void 0,send_stickers:void 0},this.addEventListener("open",async()=>{if(Ye&&un()&&await js(100),e.getOpenPosition){const s=e.getOpenPosition();this.element.style.top=s.top+"px",this.element.style.left=s.left+"px"}else if(e.customAnchorElement){const s=e.customAnchorElement.getBoundingClientRect(),i=64;this.element.style.left=s.left+"px",this.element.style.bottom=s.top+i+"px"}e.customParentElement?e.customParentElement.append(this.element):this.element.parentElement!==this.chatInput.chatInput&&this.chatInput.chatInput.append(this.element),this.savedRange=this.getGoodRange(),this.lazyLoadQueue.lock(),ut.lockIntersectionGroup(en),this.tab.onOpen?.()}),this.addEventListener("opened",()=>{ut.unlockIntersectionGroup(en),this.lazyLoadQueue.unlockAndRefresh(),this.tab.onOpened?.()}),this.addEventListener("close",()=>{this.lazyLoadQueue.lock(),ut.lockIntersectionGroup(en),ut.checkAnimations(!0,en),this.tab.onClose?.()}),this.addEventListener("closed",()=>{ut.unlockIntersectionGroup(en),this.lazyLoadQueue.unlock(),this.lazyLoadQueue.refresh(),this.savedRange=void 0,this.tab.onClosed?.()})}get tab(){return this.tabs[this.tabId]}get chatInput(){return this._chatInput||ce.chat.input}set chatInput(e){const t=this._chatInput!==e;this._chatInput=e,!this.init&&t&&this.chatInput!==void 0&&this.checkRights()}setTextColor(e=ic){this.textColor=e,this.getTabsFromRenderer(Fn)?.setTextColor(e)}getTabsFromRenderer(e){return this.tabsToRender.find(t=>t instanceof e)}init(){this.managers=C.managers,this.tabsToRender.length||(this.tabsToRender=[new Fn({managers:this.managers,preloaderDelay:200}),new ll(this.managers),new bd(this.managers)]),this.tabs={},this.tabsToRender.forEach((n,a)=>{n.emoticonsDropdown=this,n.tabId=a,this.tabs[a]=n}),this.container=this.element.querySelector(".emoji-container .tabs-container"),this.container.prepend(...this.tabsToRender.map(n=>!(n instanceof bd)&&n.container)),this.tabsEl=this.element.querySelector(".emoji-tabs"),this.selectTab=Ac(this.tabsEl,this.container,this.onSelectTabClick,()=>{const{tab:n}=this;n.init?.(),ut.checkAnimations(!1,en)}),this.searchButton=this.element.querySelector(".emoji-tabs-search"),this.listenerSetter.add(this.searchButton)("click",()=>{this.tabId===this.getTabsFromRenderer(ll)?.tabId?ss.isTabExists(kf)||ss.createTab(kf).open():ss.isTabExists(_f)||ss.createTab(_f).open()}),this.deleteBtn=this.element.querySelector(".emoji-tabs-delete"),D(this.deleteBtn,n=>{X(n);const a=this.chatInput.messageInput;let r=Cm.getInstance().getSavedRange(a);r||(r=document.createRange(),r.setStartAfter(a.lastChild));const l=r.cloneRange();if(r.collapsed){const{node:c,offset:d}=KC(a,r.endContainer,r.endOffset);let h;if(d)h=c;else{if(h=c.previousSibling,!h)return;for(;h.nodeType===h.TEXT_NODE&&!h.nodeValue&&(h=h.previousSibling););if(h.nodeType===h.ELEMENT_NODE&&!h.isContentEditable)return}if(h.nodeType===h.ELEMENT_NODE&&h.tagName==="IMG")l.selectNode(h);else{const u=[...h.textContent];let p;if(d){let g=0;p=u.find(f=>(g+=f.length,g>=d))}else p=u.pop()||"";const m=d?d-p.length:h.textContent.length-p.length;l.setStart(h,m)}}l.deleteContents(),this.chatInput.messageInputField.simulateInputEvent()},{listenerSetter:this.listenerSetter});const e=ym&&!1,t=e?this.getTabsFromRenderer(ll).tabId:this.getTabsFromRenderer(Fn).tabId;if(e&&this.tabsEl.children[1].classList.add("hide"),hs(this.tabsEl.children[t+1]),this.tabsToRender.length<=1&&this.tabsEl.classList.add("hide"),this.tabs[t].init?.(),!Ye){let n,a=!1;const r=l=>{n=l};this.listenerSetter.add(hi)("change",l=>{l?a||(this.listenerSetter.add(document.body)("mousemove",r),a=!0):a&&(this.listenerSetter.removeManual(document.body,"mousemove",r),n&&this.onMouseOut(n))})}const s=()=>{this._chatInput||this.isStandalone||this.toggle(!1)},i=()=>{this._chatInput||this.isStandalone||this.checkRights()};return this.listenerSetter.add(ce)("peer_changing",s),this.listenerSetter.add(ce)("peer_changed",i),i(),super.init()}getElement(){return this.element}scrollTo(e,t){e.scrollable.scrollIntoViewNew({element:t,axis:"y",position:"start",...cl})}async sendDocId(e,t,s){return await this.chatInput.sendMessageWithDocument(e,void 0,t,s)?(Tl.container&&(Tl.forceClose=!0,Tl.toggle(!1)),!0):(console.warn("got no doc by id:",e),!1)}addLazyLoadQueueRepeat(e,t){this.addEventListener("close",()=>{e.lock()}),this.addEventListener("closed",()=>{const s=e.intersector.getVisible();for(const i of s)t(i);e.intersector.clearVisible()}),this.addEventListener("opened",()=>{e.unlockAndRefresh()})}getSavedRange(){return this.getGoodRange()||this.savedRange}getGoodRange(){const e=document.getSelection();if(e.rangeCount&&document.activeElement===this.chatInput.messageInput)return e.getRangeAt(0)}destroy(){this.cleanup(),this.listenerSetter.removeAll(),this.tabsToRender.forEach(e=>e.destroy?.()),this.element.remove()}hideAndDestroy(){return this.toggle(!1).then(()=>this.destroy())}};Pg.menuOnClick=(e,t,s,i,n,a)=>{let r=-1;const l=(m,g)=>{const f=m.menuScroll||i;f&&f.scrollIntoViewNew({element:m.elements.menuTab,position:"center",axis:"x",getElementPosition:g?({elementPosition:y})=>y-106:void 0,...cl})},c=(m,g=!0)=>{if(m===n)return!1;let f=!1;return n&&(n.elements.menuTab.classList.remove("active"),n.menuScroll&&n.menuScroll!==m.menuScroll&&(f=!0,n.menuScroll.container.parentElement.classList.remove("active"),n.menuScroll.scrollIntoViewNew({element:n.menuScroll.firstElementChild,forceDirection:g?void 0:Hd.Static,position:"center",axis:"x",...cl}))),m.elements.menuTab.classList.add("active"),m.menuScroll&&(m.menuScroll.container.parentElement.classList.add("active"),g&&i.scrollIntoViewNew({element:m.menuScroll.container.parentElement,position:"center",axis:"x",...cl})),n&&l(m,f),n=m,!0},d=m=>{if(n?.local)return;e.scrollable.scrollPosition=m.elements.container.offsetTop+1;const g=e.menuScroll.container,f=m.elements.menuTab;g.scrollLeft=f.offsetLeft-g.clientWidth/2+f.offsetWidth/2,c(m,!1)};let h=!1;const u=new fb(s.container,(m,g)=>{if(h||Math.abs(r-s.scrollPosition)<=1)return;r=-1;const f=e.getCategoryByContainer(g);if(!f.elements.menuTab)return;const y=ui(g);!m&&(y||f.menuScroll)||c(f)});D(t,m=>{X(m);let g=U(m.target,"menu-horizontal-div-item");if(!g){if(g=U(m.target,"menu-horizontal-inner"),!g||g.classList.contains("active"))return;g=g.firstElementChild.firstElementChild}const f=ui(g),y=e.getCategoryByMenuTab(g);c(y);let v=0,b=0;if(f>0||y.menuScroll){const w=y.elements.container;b=1,v=w.offsetTop+b}r=v,h=!0,s.scrollIntoViewNew({element:v?y.elements.container:s.firstElementChild,position:"start",axis:"y",getElementPosition:v?({elementPosition:w})=>w+b:void 0,startCallback:()=>{e instanceof Fn&&!e.isCategoryVisible(y)&&e._onCategoryVisibility(y,!0)},...cl}).finally(()=>{c(y),h=!1})},{listenerSetter:a});const p=s.onAdditionalScroll?s.onAdditionalScroll.bind(s):qt;return s.onAdditionalScroll=()=>{e.content.parentElement.classList.toggle("scrolled-top",!s.scrollPosition),p()},{stickyIntersector:u,setActive:c,setActiveStatic:d}};let Mr=Pg;const Tl=new Mr;Gs.emoticonsDropdown=Tl;const zi=Tl;class sg{constructor(e){this.sendMenuButtons=[{icon:"mute",text:"Chat.Send.WithoutSound",onClick:e.onSilentClick,verify:()=>this.type==="schedule"},{icon:"schedule",text:"Chat.Send.ScheduledMessage",onClick:e.onScheduleClick,verify:()=>this.type==="schedule"},{icon:"schedule",text:"Chat.Send.SetReminder",onClick:e.onScheduleClick,verify:()=>this.type==="reminder"},{icon:"online",text:"Schedule.SendWhenOnline",onClick:e.onSendWhenOnlineClick,verify:()=>this.type==="schedule"&&e.canSendWhenOnline?.()}],this.sendMenu=Mn({buttons:this.sendMenuButtons,listenerSetter:e.listenerSetter}),this.sendMenu.classList.add("menu-send",e.openSide),ua({element:e.onContextElement,callback:async t=>{e.onOpen&&!e.onOpen()||(X(t),await Promise.all(this.sendMenuButtons.map(async s=>{const i=await s.verify();s.element.classList.toggle("hide",!i)})),$s.openBtnMenu(this.sendMenu))},listenerSetter:e.listenerSetter})}setPeerId(e){this.type=e===C.myId?"reminder":"schedule"}}function oh(o,e){const t=[],s=[];for(let i=0,n=o.length;i<n;++i){const a=o[i];(e(a,i,o)?t:s).push(a)}return[t,s]}function Un(o,e){let t;const s=o.reply_to,i=o.saved_peer_id&&Je(o.saved_peer_id);return i?t=i:s?._==="messageReplyHeader"&&(!e||s.pFlags.forum_topic)?t=s.reply_to_top_id||s.reply_to_msg_id:e&&(o._==="messageService"&&o.action?._==="messageActionTopicCreate"?t=o.mid:t=Co),t}class ZP{constructor(e,t,s){this.container=document.createElement("div"),this.container.classList.add("bubbles-group"),this.chat=e,this.groups=t,this.items=[],this.dateTimestamp=s,this.offset=0,this.middlewareHelper=e.bubbles.getMiddleware().create()}getAvatarOptions(e){const t=e.fwd_from,s=e.fwdFromId,i=hn(t),n=e.from_id&&e.from_id._==="peerChannel"&&e.fromId===s,a=this.chat.peerId,r=(t&&a===xa&&!i||n?s:e.fromId)||Vt;return{peerId:r,peerTitle:r===Vt?i:void 0}}createAvatar(e,t){return this.avatarLoadPromise?this.avatarLoadPromise:e._==="messageService"?void 0:(this.avatarContainer=document.createElement("div"),this.avatarContainer.classList.add("bubbles-group-avatar-container"),++this.offset,this.avatar=ls({middleware:this.middlewareHelper.get(),size:40,lazyLoadQueue:this.chat.bubbles.lazyLoadQueue,...t||this.getAvatarOptions(e)}),this.avatar.node.classList.add("bubbles-group-avatar","user-avatar"),this.avatarLoadPromise=this.avatar.readyThumbPromise,this.avatarContainer.append(this.avatar.node),this.container.append(this.avatarContainer),this.avatarLoadPromise)}get firstTimestamp(){return this.firstItem.timestamp}get firstMid(){return this.firstItem.mid}get firstItem(){return this.items[this.items.length-1]}get lastTimestamp(){return this.lastItem.timestamp}get lastMid(){return this.lastItem.mid}get lastItem(){return this.items[0]}updateClassNames(){const e=this.items,t=e.length;if(!t)return;const s=e[t-1].bubble;if(e.length===1){s.classList.add("is-group-first","is-group-last");return}else s.classList.remove("is-group-last"),s.classList.add("is-group-first");for(let n=1,a=t-1;n<a;++n)e[n].bubble.classList.remove("is-group-last","is-group-first");const i=e[0].bubble;i.classList.remove("is-group-first"),i.classList.add("is-group-last")}insertItem(e){const{items:t}=this;Oa(t,e,this.groups.sortGroupItemsKey),e.group=this,t.length===1&&this.groups.insertGroup(this)}removeItem(e){cs(this.items,e),this.items.length||cs(this.groups.groups,this),e.group=void 0}mount(e){if(!this.groups.groups.includes(this)||!this.items.length){debugger;this.mounted&&this.onItemUnmount();return}const{offset:t,items:s}=this,{length:i}=s;ii(s,(n,a)=>{this.mountItem(n,i-1-a,t)}),e&&this.updateClassNames(),this.onItemMount()}mountItem(e,t=this.items.indexOf(e),s=this.offset){e.mounted||(ws(e.bubble,this.container,s+t),e.mounted=!0)}unmountItem(e){e.mounted&&(e.bubble.remove(),e.mounted=!1,this.onItemUnmount())}onItemMount(){if(this.mounted)return;const e=this.dateContainer=this.chat.bubbles.getDateContainerByTimestamp(this.dateTimestamp/1e3),t=this.groups.groups.filter(a=>a.dateTimestamp===this.dateTimestamp),s=t.length,i=t.indexOf(this),n=t.slice(i+1).reduce((a,r)=>a+(r.mounted?0:1),0);ws(this.container,e.container,dw+s-1-i-n),++e.groupsLength,this.mounted=!0,this.groups?.updateGroupsClassNames()}onItemUnmount(){this.mounted&&(this.items.length?this.updateClassNames():(this.container.remove(),this.dateContainer&&--this.dateContainer.groupsLength,this.dateContainer=void 0,this.chat.bubbles.deleteEmptyDateGroups(),this.mounted=!1,this.middlewareHelper.clean(),this.groups?.updateGroupsClassNames()))}}class JP{constructor(e){this.chat=e,this.itemsArr=[],this.itemsMap=new Map,this.groups=[],this.newGroupDiff=121,this.sortItemsKey=e.type===Q.Scheduled?"timestamp":"mid",this.sortGroupsKey=e.type===Q.Scheduled?"lastTimestamp":"lastMid",this.sortGroupItemsKey="groupMid"}removeItem(e){e.group?.removeItem(e),this.removeItemFromCache(e)}removeAndUnmountBubble(e){const t=this.getItemByBubble(e);if(!t){const d=e.parentElement;return d&&(d.classList.contains("bubbles-group")?d.remove():e.remove()),!1}const s=this.itemsArr,i=s.indexOf(t),n=this.getSiblingsAtIndex(i,s),a=t.group;this.removeItem(t);const r=new Set;a&&(a.unmountItem(t),r.add(a));const[l,c]=n;if(l&&c&&this.canItemsBeGrouped(l,c)&&l.group!==c.group){const d=c.group;this.f(c.group.items),d.onItemUnmount(),r.add(l.group),this.groupUngrouped()}return this.mountUnmountGroups(Array.from(r)),!0}mountUnmountGroups(e){const[t,s]=oh(e,i=>!!i.items.length);s.forEach(i=>{i.onItemUnmount()}),t.forEach(i=>{i.mount(!0)})}f(e,t=0,s=e.length){for(;t<s;++t){const i=e[t];i.mounted=!1,i.group.removeItem(i),--s,--t}}getItemByBubble(e){return this.itemsMap.get(e)}get firstGroup(){return this.groups[this.groups.length-1]}get lastGroup(){return this.groups[0]}changeBubbleMid(e,t){const s=this.getItemByBubble(e);s&&(s.mid=t,cs(this.itemsArr,s),this.insertItemToArray(s,this.itemsArr))}changeItemBubble(e,t){this.itemsMap.delete(e.bubble),e.bubble=t,this.itemsMap.set(t,e)}changeBubbleByBubble(e,t){const s=this.getItemByBubble(e);s&&this.changeItemBubble(s,t)}canItemsBeGrouped(e,t){const s=this.chat.isOutMessage(e.message);return t.fromId===e.fromId&&e.dateTimestamp===t.dateTimestamp&&Math.abs(t.timestamp-e.timestamp)<=this.newGroupDiff&&!e.single&&!t.single&&s===this.chat.isOutMessage(t.message)&&(!this.chat.isAllMessagesForum||Un(e.message,!0)===Un(t.message,!0))&&(!s||e.message.fromId===C.myId)}getSiblingsAtIndex(e,t){return[t[e-1],t[e+1]]}findGroupSiblingByItem(e,t){t=t.slice();const s=this.insertItemToArray(e,t);return this.findGroupSiblingInItems(e,t,s)}findGroupSiblingInItems(e,t,s=t.indexOf(e),i=t.length){const n=t[s-1];let a;if(n?.group&&this.canItemsBeGrouped(e,n))a=n;else for(let r=s+1;r<i;++r){const l=t[r];if(this.canItemsBeGrouped(e,l))l.group&&(a=l);else break}return a}addItemToGroup(e,t){t.insertItem(e),this.addItemToCache(e)}insertItemToArray(e,t){return Oa(t,e,this.sortItemsKey)}insertGroup(e){return Oa(this.groups,e,this.sortGroupsKey)}updateGroupsClassNames(){this.groups.forEach((e,t,s)=>{e.container.classList.toggle("bubbles-group-last",t===0),e.container.classList.toggle("bubbles-group-first",t===s.length-1)})}addItemToCache(e){this.insertItemToArray(e,this.itemsArr),this.itemsMap.set(e.bubble,e)}removeItemFromCache(e){cs(this.itemsArr,e),this.itemsMap.delete(e.bubble)}getMessageFromId(e){let t=e.fromId;return t===C.myId&&e.peerId===C.myId&&e.fwdFromId===t&&(t=t.toPeerId(!0)),t}createItem(e,t){const s=!(t._==="message"||t.action&&lg.has(t.action._)),{mid:i,date:n}=t,{dateTimestamp:a}=this.chat.bubbles.getDateForDateContainer(n);return{mid:i,groupMid:this.chat.type===Q.Scheduled?+`${(n*1e3-a)/1e3}.${+(""+i).replace(".","")}`:i,fromId:this.getMessageFromId(t),bubble:e,timestamp:n,dateTimestamp:a,mounted:!1,single:s,message:t}}splitSiblingsOnGrouping(e){const[t,s]=e,i=t?.group;if(s?.group,!i)return;const n=i.items,a=n.indexOf(t)+1,r=n.length;if(a===r)return;const l=[i];return this.f(n,a,r),l}prepareForGrouping(e,t){if(this.getItemByBubble(e))return;const i=this.createItem(e,t);this.addItemToCache(i)}groupUngrouped(){const e=this.itemsArr,t=e.length,s=new Set;for(let i=0;i<t;++i){const n=e[i];if(n.group)continue;let a=!0;const r=this.getSiblingsAtIndex(i,e),d=this.findGroupSiblingInItems(n,e,i,t)?.group??(a=!1,new ZP(this.chat,this,n.dateTimestamp));if(s.add(d),d.insertItem(n),!a){const h=this.splitSiblingsOnGrouping(r);h&&h.forEach(u=>s.add(u))}}return s}cleanup(){this.itemsArr=[],this.groups=[],this.itemsMap.clear()}}class jn extends _s{constructor(e,t,s=["send_plain"],i){super({peerType:["dialogs","contacts"],onSelect:!e&&t?t:async(n,a)=>{if(t){const r=t(n);r instanceof Promise&&await r}if(n===C.myId){let r=0;for(const l in e){const c=e[l];r+=c.length,this.managers.appMessagesManager.forwardMessages({peerId:n,fromPeerId:l.toPeerId(),mids:c})}Re({langPackKey:r>0?"FwdMessagesToSavedMessages":"FwdMessageToSavedMessages"});return}await ce.setInnerPeer({peerId:n,threadId:a}),ce.chat.input.initMessagesForward(e)},placeholder:"ShareModal.Search.ForwardPlaceholder",chatRightsActions:s,selfPresence:"ChatYourSelf",useTopics:!i})}static async create(...e){const[t]=e,s=Object.keys(t).map(a=>t[a].map(l=>C.managers.appMessagesManager.getMessageByPeer(a.toPeerId(),l))),i=await Promise.all(Na(s)),n=new Set;i.forEach(a=>{if(!a)return;const r=Hs(a);let l;if(!r)a.viaBotId?l="send_inline":l="send_plain";else if(r._==="webPage")l="embed_links";else if(r._==="photo")l="send_photos";else if(r._==="game")l="send_games";else switch(r.type){case"audio":l="send_audios";break;case"gif":l="send_gifs";break;case"round":l="send_roundvideos";break;case"sticker":l="send_stickers";break;case"voice":l="send_voices";break;case"video":l="send_videos";break;default:l="send_docs";break}l&&n.add(l)}),J.createPopup(jn,e[0],e[1],Array.from(n))}}function Ri(o,e=2){if(o===0)return"0";const t=1e3,s=e<0?0:e,i=["","K","M","B","T"],n=Math.floor(Math.log(o)/Math.log(t));return parseFloat((o/Math.pow(t,n)).toFixed(s))+i[n]}class Yh{constructor(e,t){this.className=e,this.fill=t,this.container=document.createElement("div"),this.container.className=e,this.border=document.createElement("div"),this.border.classList.add(e+"-border"),this.content=document.createElement("div"),this.content.classList.add(e+"-content"),this.title=document.createElement("div"),this.title.classList.add(e+"-title"),nn(this.title),this.subtitle=document.createElement("div"),this.subtitle.classList.add(e+"-subtitle"),nn(this.subtitle),this.content.append(this.title,this.subtitle),this.container.append(this.border,this.content)}}const fa=32;async function ig(o){o.loadPromises||(o.loadPromises=[]);const{titleEl:e,subtitleEl:t,mediaEl:s,message:i,loadPromises:n,animationGroup:a,middleware:r,lazyLoadQueue:l,replyHeader:c}=o;let{storyItem:d,quote:h}=o,u=o.title;if(u!==void 0)typeof u=="string"&&(u=Aa(u,140),u=Pe(u)),tt(e,u);else if(o.isStoryExpired){const v=Le("bomb","expired-story-icon");e.append(v,_("ExpiredStory"))}const p=c?._==="messageReplyHeader";p&&c.quote_text&&(h??(h={text:c.quote_text,entities:c.quote_entities}));let m=d?.media||i?.media||p&&c.reply_media;m?._==="messageMediaStory"&&(d=m.story,m=d?.media);let g=!1,f=!1;const y=s?Array.from(s.children).slice():[];if(m&&s){m=m.webpage||m;const v=m.photo,b=m.document;if(v||b&&b.thumbs?.length)if(b?.type==="sticker")await Ds({doc:b,div:s,lazyLoadQueue:l||void 0,group:a,width:fa,height:fa,middleware:r,loadPromises:n}),g=!0;else if(b?.type==="gif"&&b.video_thumbs)g=!0,await On({doc:b,container:s,boxWidth:fa,boxHeight:fa,lazyLoadQueue:l||void 0,noPlayButton:!0,noInfo:!0,middleware:r,loadPromises:n,withoutPreloader:!0,videoSize:b.video_thumbs[0],group:a});else{const w=v||b;f=b?.type==="round";try{await Ns({photo:w,container:s,boxWidth:fa,boxHeight:fa,size:ji(w,fa,fa),middleware:r,lazyLoadQueue:l,noBlur:!0,withoutPreloader:!0,loadPromises:n}),g=!0}catch{}}}if(o.subtitle!==void 0){let v=o.subtitle;typeof v=="string"&&(v=Aa(v,140),v=Pe(v)),tt(t,v||"")}else if(d&&o.storyItem)t.replaceChildren(_("Story"));else if(o.isStoryExpired){const v=Le("bomb","expired-story-icon");t.replaceChildren(v,_("ExpiredStory"))}else if(h){const v=us(Aa(h.text,200),{...o,noLinebreaks:!0,entities:h.entities,noLinks:!0});t.replaceChildren(v)}else if(i){const v=await Fa(o);t.replaceChildren(v)}return Promise.all(n).then(()=>{r&&!r()||(y.forEach(v=>v.remove()),s&&s.classList.toggle("is-round",f))}),g}class kb extends Yh{constructor(e){super(e,async t=>{this.mediaEl||(this.mediaEl=document.createElement("div"),this.mediaEl.classList.add(this.className+"-media"));const s=await ig({...t,titleEl:this.title,subtitleEl:this.subtitle,mediaEl:this.mediaEl});t.isStoryExpired&&this.container.classList.add("is-expired-story"),this.container.classList.toggle("is-media",s),s?this.content.prepend(this.mediaEl):this.mediaEl.remove()}),this.className=e}}function Xh(o){const e=new kb("reply"),t=e.fill(o);e.container.classList.add("quote-like","quote-like-hoverable","quote-like-border"),nn(e.container),e.border.remove(),pi(e.container,void 0,void 0,!0),o.isQuote&&(e.container.classList.add("quote-like-icon"),e.container.classList.add("reply-multiline")),o.noBorder&&e.container.classList.remove("quote-like-border");const{setColorPeerId:s}=o;if(s!==void 0){ce.setPeerColorToElement(s,e.container,o.useHighlightingColor,o.colorAsOut);const i=fe.getPeer(s),n=i?.color?.background_emoji_id;n&&C.managers.appEmojiManager.getCustomEmojiDocument(n).then(a=>{const c=[[104.5,34.5,12,.35],[9.3,33.3,10.4,.2],[51.3,.3,10.4,.2],[.6,7.6,12.8,.1],[28.9,12.9,15.2,.2],[65.5,18.5,12,.25],[48.9,37.9,15.2,.25],[91.9,7.9,15.2,.3]],d=document.createElement("div");Ds({doc:a,div:d,middleware:o.middleware,width:16,height:16,static:!0,withThumb:!1}).then(({render:h})=>h).then(h=>{const u=h[0];return u.naturalWidth?u:js(100).then(()=>u)}).then(h=>{const u=document.createElement("canvas");u.classList.add("reply-background-canvas"),u.style.width="117px",u.style.height="54px";const p=u.getContext("2d"),m=u.dpr=window.devicePixelRatio;u.width=117*m,u.height=54*m,c.forEach(([f,y,v,b])=>{p.globalAlpha=b,p.drawImage(h,f*m,y*m,v*m,v*m)}),p.globalAlpha=1;let g;o.useHighlightingColor?g="#ffffff":o.colorAsOut?g=fs.getProperty("message-out-primary-color"):g=Tm(i)[0],WC(p,g,0,0,u.width,u.height),e.container.prepend(u)}).catch(qt)})}return{container:e.container,fillPromise:t}}const Tb="stacked-avatars",xb=Tb+"-avatar",e0=xb+"-container";class Wo{constructor(e){this.lazyLoadQueue=e.lazyLoadQueue,this.avatarSize=e.avatarSize,this.middlewareHelper=e.middleware.create(),this.container=document.createElement("div"),this.container.classList.add(Tb),this.container.style.setProperty("--avatar-size",e.avatarSize+"px")}render(e,t=[]){const s=this.container.children;return e=e.slice().reverse(),e.length>3&&(e=e.slice(-3)),e.forEach((i,n)=>{let a=s[n];a?a.middlewareHelper.clean():(a=document.createElement("div"),a.classList.add(e0),a.middlewareHelper=this.middlewareHelper.get().create());const r=ls({middleware:a.middlewareHelper.get(),size:this.avatarSize,isDialog:!1,lazyLoadQueue:this.lazyLoadQueue,peerId:i});r.node.classList.add(xb),t?.push(r.readyThumbPromise),a.replaceChildren(r.node),a.parentNode||this.container.append(a),a.classList.toggle("is-first",n===0)}),Array.from(s).slice(e.length).forEach(i=>{i.middlewareHelper.destroy(),i.remove()}),Promise.all(t)}}const Ab="replies-element";C.addEventListener("replies_updated",o=>{Array.from(document.querySelectorAll(Ab+`[data-post-key="${o.peerId}_${o.mid}"]`)).forEach(e=>{e.message=o,e.render()})});class Fb extends HTMLElement{constructor(){super(),this.updated=!1,this.managers=C.managers}init(){this.render(),this.dataset.postKey=this.message.peerId+"_"+this.message.mid,this.classList.add("replies","replies-"+this.type)}render(){const e=this.message.replies;if(this.type==="footer"){let t;this.firstElementChild&&(t=this.firstElementChild),e?.recent_repliers?(t&&!t.classList.contains("replies-footer-avatars")&&(this.replaceChildren(),t=null),this.stackedAvatars||(this.stackedAvatars=new Wo({lazyLoadQueue:this.lazyLoadQueue,avatarSize:30,middleware:this.middlewareHelper.get()}),this.stackedAvatars.container.classList.add("replies-footer-avatars")),t=this.stackedAvatars.container,this.stackedAvatars.render(e.recent_repliers.map(n=>Je(n)),this.loadPromises)):(t&&!t.classList.contains(sa("comments"))&&(t.remove(),t=null),t||(t=Le("comments","replies-footer-icon","replies-footer-icon-comments"))),t.parentElement||this.prepend(t),this.text||(this.text=new De.IntlElement);const s=this.text;if(e?e.replies?s.compareAndUpdate({key:"Comments",args:[e.replies]}):s.compareAndUpdate({key:"LeaveAComment"}):s.compareAndUpdate({key:"ViewInChat"}),e){let n=!1;e.replies&&e.read_max_id!==void 0&&e.max_id!==void 0&&(n=e.read_max_id<e.max_id),this.classList.toggle("is-unread",n)}let i=this.children[1];if(!i){i=document.createElement("span"),i.classList.add("replies-footer-text");const n=Le("next","replies-footer-icon","replies-footer-icon-next"),a=document.createElement("div");pi(a),this.append(i,n,a)}tt(i,s.element)}else this.classList.add("bubble-beside-button"),this.innerHTML=`<span class="replies-beside-text">${e?.replies?Ri(e.replies,0):""}</span>`,this.prepend(Le("commentssticker"));e&&!this.updated&&!this.message.pFlags.is_outgoing&&(this.managers.appMessagesManager.subscribeRepliesThread(this.message.peerId,this.message.mid),this.managers.appMessagesManager.updateMessage(this.message.peerId,this.message.mid,"replies_updated"),this.updated=!0),this.loadPromises&&(this.loadPromises=void 0)}}customElements.define(Ab,Fb);const t0="&nbsp;",xf=()=>{const o=document.createElement("i");return o.classList.add("time-edited","time-part"),$t(o,"EditedMessage"),o},Af=(o,e)=>e?Ky(o.getTime()/1e3|0,{combined:!0}).dateEl:Gy(o);var nr;(o=>{o.setTime=e=>{const{chatType:t,message:s}=e,i=!("action"in s),n=s.peerId===C.myId&&!e.isOut,a=[];let r=s.date;n&&i&&s.fwd_from&&(r=s.fwd_from.saved_date||s.fwd_from.date||r);const l=new Date(r*1e3);let c;const d=i&&s.fwd_from,h=Af(l,n);if(i){if(s.views){const y=document.createElement("span");y.classList.add("post-views"),y.textContent=Ri(s.views,1);const v=Le("channelviews","time-icon","time-part","time-icon-views");a.push(y,v)}const f=e.chat.getPostAuthor(s);if(f){const y=document.createElement("span");y.classList.add("post-author"),St(y,Pe(f)),y.insertAdjacentHTML("beforeend",'<span class="post-author-comma">,'+t0+"</span>"),a.push(y)}if(s.edit_date&&t!==Q.Scheduled&&!s.pFlags.edit_hide&&a.unshift(c=xf()),t!==Q.Pinned&&s.pFlags.pinned){const y=Le("pinnedchat","time-icon","time-pinned","time-part");a.unshift(y)}}h&&a.push(h);let u=bu(new Date(s.date*1e3));i&&(u+=(s.edit_date&&!s.pFlags.edit_hide?`
Edited: ${bu(new Date(s.edit_date*1e3))}`:"")+(d?`
Original: ${bu(new Date(d.saved_date||d.date*1e3))}`:""));const p=document.createElement("span");p.classList.add("time"),p.append(...a);const m=document.createElement("div");m.classList.add("time-inner"),u&&(m.title=u);let g=a;return c&&(g[g.indexOf(c)]=xf()),g=g.map(f=>f instanceof HTMLElement&&!f.classList.contains("i18n")&&!f.classList.contains("reactions")?f.cloneNode(!0):f),h&&(g[g.length-1]=Af(l,n)),m.append(...g),p.append(m),p},o.renderReplies=({bubble:e,bubbleContainer:t,message:s,messageDiv:i,loadPromises:n,lazyLoadQueue:a,middleware:r})=>{const l=!e.classList.contains("sticker")&&!e.classList.contains("emoji-big")&&!e.classList.contains("round"),c=new Fb;return c.message=s,c.type=l?"footer":"beside",c.loadPromises=n,c.lazyLoadQueue=a,c.middlewareHelper=r.create(),c.init(),t.prepend(c),l},o.setReply=async({chat:e,bubble:t,bubbleContainer:s,message:i,appendCallback:n,middleware:a,lazyLoadQueue:r,needUpdate:l,isStandaloneMedia:c,isOut:d})=>{const h=!s;h&&(s=t.querySelector(".bubble-content"));const u=h?s.querySelector(".reply"):null,p=i.reply_to;if(!p){u?.remove(),t.classList.remove("is-reply");return}const m=p._==="messageReplyStoryHeader",g=m?Je(p.peer):p.reply_to_peer_id?Je(p.reply_to_peer_id):e.peerId,f=!m&&fe.getMessageByPeer(g,i.reply_to_mid),y=m&&await C.managers.acknowledged.appStoriesManager.getStoryById(g,p.story_id);let v,b=!1,w,S;if(m)y.cached?(w=g,v=new Mt({peerId:w,dialog:!1,onlyFirstName:!1,plainText:!1}).element):(l.push({replyToPeerId:g,replyStoryId:p.story_id,mid:i.mid}),C.managers.appMessagesManager.fetchMessageReplyTo(i),v=_("Loading"));else if(!f)p.reply_from?(b=!0,w=Je(p.reply_from?.from_id||p.reply_to_peer_id),v=new Mt({peerId:w||void 0,dialog:!1,onlyFirstName:!1,plainText:!1,fromName:hn(p.reply_from)}).element):(l.push({replyToPeerId:g,replyMid:i.reply_to_mid,mid:i.mid}),C.managers.appMessagesManager.fetchMessageReplyTo(i),v=_("Loading"));else{const P=f.fwdFromId;w=i.fwdFromId&&i.fwdFromId===P?i.fwdFromId:P||f.fromId,S=i.fwdFromId&&i.fwdFromId===P?void 0:f.fromId,v=new Mt({peerId:w,dialog:!1,onlyFirstName:!1,plainText:!1,fromName:w?void 0:hn(f.fwd_from)}).element}if(!m&&p.reply_from){const P=document.createDocumentFragment();let E;if(p.reply_from.channel_post)P.append(E=Le("newchannel_filled","with-margin"),v);else if(p.reply_to_peer_id){const k=new Mt({peerId:Je(p.reply_to_peer_id),dialog:!1,onlyFirstName:!1,plainText:!1}).element;P.append(v," ",E=Le("group_filled")," ",k)}else P.append(E=Le("newprivate_filled","with-margin"),v);E&&(E.classList.add("inline-icon","reply-title-icon"),v=P)}const I=m&&y.cached&&!await y.result,{container:L,fillPromise:M}=Xh({title:v,animationGroup:e.animationGroup,message:f||(b?{_:"message",pFlags:{},id:0,date:0,message:"",peer_id:void 0,media:p.reply_media}:void 0),isStoryExpired:I,storyItem:y?.cached&&await y.result,setColorPeerId:S||w,textColor:"primary-text-color",isQuote:m?void 0:p.pFlags.quote,middleware:a,lazyLoadQueue:r,replyHeader:p,useHighlightingColor:c,colorAsOut:d});return await M,u?(u.classList.contains("floating-part")&&L.classList.add("floating-part"),u.replaceWith(L)):n(L),t.classList.add("is-reply"),L}})(nr||(nr={}));function s0(o,e){const t=o.length;if(t!==e.length){const i=t-e.length;return i<0?-1:i>0?1:0}const s=15;for(let i=0;i<t;i+=s){const n=+o.slice(i,i+s),a=+e.slice(i,i+s),r=n-a;if(r)return r}return 0}function Ff(o,e){if(o.toExponential){const t=o-e;return t<0?-1:t>0?1:0}return s0(o,e)}var Qr=(o=>(o[o.None=0]="None",o[o.Top=1]="Top",o[o.Bottom=2]="Bottom",o[o.Both=3]="Both",o))(Qr||{});class nc{constructor(){this.sliceConstructor=nc.getSliceConstructor(this);const e=this.constructSlice();this.slices=[e]}static getSliceConstructor(e){return class extends Array{constructor(){super(...arguments),this.end=0}isEnd(s){if((this.end&s)===s)return!0;let i=!1;if(s===1){const n=e.last;i=n.end&s?this.includes(n[n.length-1]):!1}else if(s===2){const n=e.first;i=n.end&s?this.includes(n[0]):!1}else if(s===3)return this.isEnd(1)&&this.isEnd(2);return i&&this.setEnd(s),i}getEnds(){return{top:this.isEnd(1),bottom:this.isEnd(2),both:this.isEnd(3)}}setEnd(s){this.end|=s}unsetEnd(s){this.end&=~s}splice(s,i,...n){const a=super.splice(s,i,...n);if(!this.length){const r=e.slices,l=r.indexOf(this);l!==-1&&(r.length===1?this.unsetEnd(3):r.splice(l,1))}return a}}}constructSlice(...e){const t=new this.sliceConstructor(e.length);for(let s=0,i=e.length;s<i;++s)t[s]=e[s];return t}insertSlice(e,t=!0){if(!e.length)return;const s=this.slices[0];if(!s.length)return s.push(...e),s;const i=e[e.length-1],n=e[0];let a,r=-1,l=-1,c=0;for(;c<this.slices.length&&(a=this.slices[c],r=a.indexOf(i),l=a.indexOf(n),!(l!==-1&&r!==-1));++c)if(l!==-1||r!==-1)break;if(!(l!==-1&&r!==-1))if(l!==-1){const d=e.slice(a.length-l);a.push(...d)}else if(r!==-1){const d=e.slice(0,e.length-r-1);a.unshift(...d)}else{let d=0;for(const h=this.slices.length;d<h;++d){const u=this.slices[d];if(Ff(e[0],u[0])===1)break}this.slices.splice(d,0,this.constructSlice(...e)),c=d}if(t)return this.flatten(c)}flatten(e){if(this.slices.length>=2)for(let t=0,s=this.slices.length;t<s-1;++t){const i=this.slices[t],n=this.slices[t+1];i.indexOf(n[0])!==-1&&(i.setEnd(n.end),this.slices.splice(t+1,1),t<e&&--e,--s,--t,this.insertSlice(n,!1))}return this.slices[e]}get first(){return this.slices[0]}get last(){return this.slices[this.slices.length-1]}get slice(){return this.first}get length(){return this.slice.length}findSlice(e){for(let t=0,s=this.slices.length;t<s;++t){const i=this.slices[t],n=i.indexOf(e);if(n!==-1)return{slice:i,index:n}}}findOffsetInSlice(e,t){for(let s=0;s<t.length;++s)if(Ff(e,t[s])>=0)return{slice:t,offset:e===t[s]?s+1:s}}findSliceOffset(e){let t;for(let s=0;s<this.slices.length;++s){t=this.slices[s];const i=this.findOffsetInSlice(e,t);if(i)return i}if(t?.isEnd(1))return{slice:t,offset:t.length}}sliceMe(e,t,s){let i=this.slice,n=0,a=0;if(e){const m=this.findSliceOffset(e);if(!m)return;i=m.slice,n=a=m.offset}else if(!i.isEnd(2))return;const r=Math.max(a+t,0),l=a+t+s,c=i.slice(r,l),d=t<0?s+t:s,h=Math.abs(t),u=i.length-a>=d||(i.isEnd(1)?(c.setEnd(1),!0):!1),p=a-h>=0||(i.isEnd(2)?(c.setEnd(2),!0):!1);return{slice:c,offsetIdOffset:n,fulfilled:0|(u&&p?3:(u?1:0)|(p?2:0))}}unshift(...e){let t=this.first;t.length?t.isEnd(2)||(t=this.constructSlice(),t.setEnd(2),this.slices.unshift(t)):t.setEnd(2),t.unshift(...e)}push(...e){let t=this.last;t.length?t.isEnd(1)||(t=this.constructSlice(),t.setEnd(1),this.slices.push(t)):t.setEnd(1),t.push(...e)}delete(e){const t=this.findSlice(e);return t?(t.slice.splice(t.index,1),!0):!1}deleteSlice(e){cs(this.slices,e)}toJSON(){const t={slices:this.slices.map(s=>({values:s.slice(),isEnd:s.getEnds()}))};return JSON.stringify(t)}static fromJSON(e){const t=JSON.parse(e),s=new nc;return t.slices.forEach(i=>{const n=s.insertSlice(i.values)||s.first;i.isEnd.top&&n.setEnd(1),i.isEnd.bottom&&n.setEnd(2)}),s}}Gs&&(Gs.SlicedArray=nc);function Rb(o){let e=!1,t=!1;return new Or({...o,verifyTouchTarget:s=>!U(s.target,"progress-line")&&!Hy(s)&&(o.verifyTouchTarget?o.verifyTouchTarget(s):!0),onSwipe:(s,i,n)=>{if(s*=-1,i*=-1,!e&&Math.abs(i)>20)return!0;if(Math.abs(s)>Math.abs(i))X(n),e=!0;else if(!e&&Math.abs(i)>Math.abs(s))return!0;return t=!0,o.onSwipe(s,i,n)},onReset:()=>{t&&o.onReset?.(),e=t=!1},cancelEvent:!1})}const i0=o=>o._==="chatInvitePeek"?o.chat.pFlags.broadcast?"JoinByPeekChannelTitle":"JoinByPeekGroupTitle":o.pFlags.request_needed?"RequestJoin.Button":o.pFlags.broadcast?"JoinByPeekChannelTitle":"JoinByPeekGroupTitle";class ac extends ms{constructor(e,t){super("popup-join-chat-invite",{closable:!0,overlayClosable:!0,body:!0,buttons:xr([{langKey:i0(t),callback:()=>{ac.import(e)}}]),description:!0}),this.hash=e,this.chatInvite=t,this.construct()}static openChat(e){const t=e.toPeerId(!0);ce.setInnerPeer({peerId:t})}static import(e){C.managers.appChatInvitesManager.importChatInvite(e).then(t=>{this.openChat(t)},t=>{t.type==="INVITE_REQUEST_SENT"&&Re({langPackKey:"RequestToJoinSent"})})}static async open(e,t){t._==="chatInviteAlready"?(await C.managers.appChatInvitesManager.checkChatInvite(e),this.openChat(t.chat.id)):t._==="chatInvitePeek"?this.openChat(t.chat.id):J.createPopup(ac,e,t)}async construct(){this.header.remove();const{chatInvite:e,managers:t,hash:s}=this,i=ls({middleware:this.middlewareHelper.get(),size:100,isDialog:!1});e.photo?._==="photo"?(e.photo=await t.appPhotosManager.savePhoto(e.photo),await XI(i,e.photo)):(i.render({peerTitle:e.title}),await i.readyThumbPromise);const n=document.createElement("div");n.classList.add("peer-title","chat-title");const a=await up({peerId:Vt,noVerifiedIcon:!1,noFakeIcon:!1,noPremiumIcon:!1,peer:{_:"channel",pFlags:{verified:e.pFlags.verified,scam:e.pFlags.scam,fake:e.pFlags.fake},date:0,id:0,photo:void 0,title:""},wrapOptions:{middleware:this.middlewareHelper.get()}}),r=Pe(e.title);if(a.length){n.classList.add("with-icons");const d=document.createElement("span");d.classList.add("peer-title-inner"),d.append(r),n.append(d,...a)}else St(n,r);e.about?this.description.replaceChildren(Pe(e.about)):(this.description.remove(),this.description=void 0);const l=e.pFlags.broadcast,c=_(l?"Subscribers":"Members",[_o(e.participants_count)]);if(c.classList.add("chat-participants-count"),this.body.append(...[i.node,n,c,this.description].filter(Boolean)),e.pFlags.request_needed){const d=document.createElement("div");$t(d,l?"RequestToJoinChannelDescription":"RequestToJoinGroupDescription"),d.classList.add("chat-participants-count","request-caption"),this.body.append(d)}this.show()}}var gt=(o=>(o[o.MESSAGE=0]="MESSAGE",o[o.PRIVATE_POST=1]="PRIVATE_POST",o[o.STICKER_SET=2]="STICKER_SET",o[o.JOIN_CHAT=3]="JOIN_CHAT",o[o.VOICE_CHAT=4]="VOICE_CHAT",o[o.USER_PHONE_NUMBER=5]="USER_PHONE_NUMBER",o[o.INVOICE=6]="INVOICE",o[o.EMOJI_SET=7]="EMOJI_SET",o[o.ATTACH_MENU_BOT=8]="ATTACH_MENU_BOT",o[o.WEB_APP=9]="WEB_APP",o[o.ADD_LIST=10]="ADD_LIST",o[o.STORY=11]="STORY",o[o.BOOST=12]="BOOST",o[o.PREMIUM_FEATURES=13]="PREMIUM_FEATURES",o[o.GIFT_CODE=14]="GIFT_CODE",o))(gt||{});function Zh(o,e){return o.some(t=>t instanceof Promise)?Promise.all(o).then(e):e(o)}function n0(o){return{_:"reactionEmoji",emoticon:o.reaction}}function Ai(o,e){return typeof o!=typeof e?!1:([o,e]=[o,e].map(t=>t._==="availableReaction"?n0(t):t),Li(o,e))}const wa="reaction",a0=wa+"-element";var Ki=(o=>(o.Inline="inline",o.Block="block",o.Tag="tag",o))(Ki||{});const Fp={inline:14,block:22,tag:22},Rp={inline:2,block:4},r0=o=>o;class Bu{constructor(e){this.transformation=e,this.keyframes=this.transformation.k,this.keyframeIndex=0,this.nextKeyframe=this.keyframes[this.keyframeIndex]}withProgress(e){let s=(e-this.keyframe.t)/(this.nextKeyframe.t-this.keyframe.t);const i=Array.isArray(this.beziers);return i||(s=this.beziers(s)),this.keyframe.s.map((n,a)=>n+(this.nextKeyframe.s[a]-n)*(i?this.beziers[a](s):s))}computeAtPoint(e){if(this.nextKeyframe)return e>=this.nextKeyframe.t?(this.keyframe=this.nextKeyframe,this.nextKeyframe=this.keyframes[++this.keyframeIndex],this.keyframe.o&&this.keyframe.i?Array.isArray(this.keyframe.o.x)?new Set(this.keyframe.o.x).size===1?this.beziers=Dd(this.keyframe.o.x[0],this.keyframe.o.y[0],this.keyframe.i.x[0],this.keyframe.i.y[0]):this.beziers=this.keyframe.o.x.map((t,s)=>Dd(this.keyframe.o.x[s],this.keyframe.o.y[s],this.keyframe.i.x[s],this.keyframe.i.y[s])):this.beziers=Dd(this.keyframe.o.x,this.keyframe.o.y,this.keyframe.i.x,this.keyframe.i.y):this.beziers=r0,!this.nextKeyframe||e===this.nextKeyframe.t?this.keyframe.s:this.withProgress(e)):this.keyframe?this.withProgress(e):this.nextKeyframe.s}}function o0(o){const e=o.ks,t=e.a,s=o.op,i=new Array(s-1),n=e.o&&new Bu(e.o),a=e.p&&new Bu(e.p),r=e.s&&new Bu(e.s);for(let l=0;l<s;++l){if(l<o.ip)continue;const c=i[l-1]||{},d={},h=a.computeAtPoint(l);h?(d.translation=h,t&&(d.anchor=t.k)):(d.translation=c.translation,d.anchor=c.anchor);const u=r.computeAtPoint(l);u?d.scale=u:d.scale=c.scale;const p=n.computeAtPoint(l);p?d.opacity=p:d.opacity=c.opacity,(h||u||p)&&(i[l]=d)}return i}let Nu;function l0(){if(Nu)return Nu;const o=Cs.makeAssetUrl("ReactionGeneric");return Nu=Cs.loadAnimationDataFromURL(o,"json").then(t=>{const s=t.layers.filter(n=>n.nm.startsWith("placeholder_")),i=[];for(const n of s)i.push(o0(n));return{layersPositions:i,op:t.op}})}class za extends HTMLElement{constructor(){super(),this.classList.add(wa),this.managers=C.managers}get reactionCount(){return this._reactionCount}set reactionCount(e){this._reactionCount=e}get count(){return this.reactionCount.count}init(e,t){this.type=e,this.classList.add(wa+"-"+e),this.classList.toggle(wa+"-like-block",e==="block"||e==="tag"),this.middleware=t,e==="tag"&&this.insertAdjacentHTML("beforeend",`