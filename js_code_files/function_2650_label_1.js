App.main=function(b,g){function k(I){mxUtils.getAll("1"!=urlParams.dev?[I]:[I,STYLE_PATH+"/default.xml"],function(D){function N(){var p=null!=g?g():new App(new Editor("0"==urlParams.chrome||"min"==uiTheme,null,null,null,"0"!=urlParams.chrome));if(null!=window.mxscript){if("function"===typeof window.DropboxClient&&null==window.Dropbox&&null!=window.DrawDropboxClientCallback&&("1"!=urlParams.embed&&"0"!=urlParams.db||"1"==urlParams.embed&&"1"==urlParams.db)&&isSvgBrowser&&(null==document.documentMode||
9<document.documentMode))mxscript(App.DROPBOX_URL,function(){mxscript(App.DROPINS_URL,function(){DrawDropboxClientCallback()},"dropboxjs",App.DROPBOX_APPKEY)});else if("undefined"===typeof window.Dropbox||"undefined"===typeof window.Dropbox.choose)window.DropboxClient=null;"function"===typeof window.OneDriveClient&&"undefined"===typeof OneDrive&&null!=window.DrawOneDriveClientCallback&&("1"!=urlParams.embed&&"0"!=urlParams.od||"1"==urlParams.embed&&"1"==urlParams.od)&&(null==navigator.userAgent||
0>navigator.userAgent.indexOf("MSIE")||10<=document.documentMode)?mxscript(App.ONEDRIVE_URL,window.DrawOneDriveClientCallback):"undefined"===typeof window.OneDrive&&(window.OneDriveClient=null);"function"===typeof window.TrelloClient&&!mxClient.IS_IE11&&"undefined"===typeof window.Trello&&null!=window.DrawTrelloClientCallback&&"1"==urlParams.tr&&(null==navigator.userAgent||0>navigator.userAgent.indexOf("MSIE")||10<=document.documentMode)?mxscript(App.TRELLO_JQUERY_URL,function(){mxscript(App.TRELLO_URL,
function(){DrawTrelloClientCallback()})}):"undefined"===typeof window.Trello&&(window.TrelloClient=null)}null!=b&&b(p);"0"!=urlParams.chrome&&"1"==urlParams.test&&(EditorUi.debug("App.start",[p,(new Date).getTime()-t0.getTime()+"ms"]),null!=urlParams["export"]&&EditorUi.debug("Export:",EXPORT_URL))}mxResources.parse(D[0].getText());if(isLocalStorage&&null!=localStorage&&null!=window.location.hash&&"#_CONFIG_"==window.location.hash.substring(0,9))try{var c=JSON.parse(Graph.decompress(window.location.hash.substring(9)));
if(null!=c){EditorUi.debug("Setting configuration",JSON.stringify(c));if(null!=c.merge){var e=localStorage.getItem(Editor.configurationKey);if(null!=e)try{var f=JSON.parse(e),n;for(n in c.merge)f[n]=c.merge[n];c=f}catch(p){window.location.hash="",alert(p)}else c=c.merge}confirm(mxResources.get("configLinkWarn"))&&confirm(mxResources.get("configLinkConfirm"))&&(localStorage.setItem(Editor.configurationKey,JSON.stringify(c)),window.location.hash="",window.location.reload())}window.location.hash=""}catch(p){window.location.hash=
"",alert(p)}1<D.length&&(Graph.prototype.defaultThemes["default-style2"]=D[1].getDocumentElement(),Graph.prototype.defaultThemes.darkTheme=D[1].getDocumentElement());"1"==urlParams.dev||EditorUi.isElectronApp?N():(mxStencilRegistry.allowEval=!1,App.loadScripts(["js/shapes-14-6-5.min.js","js/stencils.min.js","js/extensions.min.js"],N))},function(D){D=document.getElementById("geStatus");null!=D&&(D.innerHTML="Error loading page. <a>Please try refreshing.</a>",D.getElementsByTagName("a")[0].onclick=
function(){mxLanguage="en";k(mxResources.getDefaultBundle(RESOURCE_BASE,mxLanguage)||mxResources.getSpecialBundle(RESOURCE_BASE,mxLanguage))})})}function d(){try{if(null!=mxSettings.settings){document.body.style.backgroundColor="atlas"!=Editor.currentTheme&&"kennedy"!=uiTheme&&(Editor.isDarkMode()||mxSettings.settings.darkMode)?Editor.darkColor:"#ffffff";if(null!=mxSettings.settings.autosaveDelay){var I=parseInt(mxSettings.settings.autosaveDelay);!isNaN(I)&&0<I?(DrawioFile.prototype.autosaveDelay=
I,EditorUi.debug("Setting autosaveDelay",I)):EditorUi.debug("Invalid autosaveDelay",I)}null!=mxSettings.settings.defaultEdgeLength&&(I=parseInt(mxSettings.settings.defaultEdgeLength),!isNaN(I)&&0<I?(Graph.prototype.defaultEdgeLength=I,EditorUi.debug("Using defaultEdgeLength",I)):EditorUi.debug("Invalid defaultEdgeLength",I))}}catch(N){null!=window.console&&console.error(N)}if(null!=Menus.prototype.defaultFonts)for(I=0;I<Menus.prototype.defaultFonts.length;I++){var D=Menus.prototype.defaultFonts[I];
"string"!==typeof D&&null!=D.fontFamily&&null!=D.fontUrl&&Graph.addFont(D.fontFamily,D.fontUrl)}mxResources.loadDefaultBundle=!1;k(mxResources.getDefaultBundle(RESOURCE_BASE,mxLanguage)||mxResources.getSpecialBundle(RESOURCE_BASE,mxLanguage))}window.onerror=function(I,D,N,c,e){EditorUi.logError("Global: "+(null!=I?I:""),D,N,c,e,null,!0)};if(window.top!=window.self||"import.diagrams.net"!==window.location.hostname&&"ac.draw.io"!==window.location.hostname&&"aj.draw.io"!==window.location.hostname){if("1"==
urlParams.embed||"1"==urlParams.lightbox){var t=document.getElementById("geInfo");null!=t&&t.parentNode.removeChild(t)}null!=document.referrer&&"aws3"==urlParams.libs&&"https://aws.amazon.com/architecture/icons/"==document.referrer.substring(0,42)&&(urlParams.libs="aws4");if(null!=window.mxscript){if("1"==urlParams.dev&&!mxClient.IS_CHROMEAPP&&!EditorUi.isElectronApp&&null!=CryptoJS&&App.mode!=App.MODE_DROPBOX&&App.mode!=App.MODE_TRELLO){t=document.getElementsByTagName("script");if(null!=t&&0<t.length){var v=
mxUtils.getTextContent(t[0]);"1f536e2400baaa30261b8c3976d6fe06"!=CryptoJS.MD5(v).toString()&&(console.log("Change bootstrap script MD5 in the previous line:",CryptoJS.MD5(v).toString()),alert("[Dev] Bootstrap script change requires update of CSP"))}null!=t&&1<t.length&&(v=mxUtils.getTextContent(t[t.length-1]),"d53805dd6f0bbba2da4966491ca0a505"!=CryptoJS.MD5(v).toString()&&(console.log("Change main script MD5 in the previous line:",CryptoJS.MD5(v).toString()),alert("[Dev] Main script change requires update of CSP")))}try{Editor.enableServiceWorker&&
("0"==urlParams.offline||/www\.draw\.io$/.test(window.location.hostname)||"1"!=urlParams.offline&&"1"==urlParams.dev)?App.clearServiceWorker(function(){"0"==urlParams.offline&&alert("Cache cleared")}):Editor.enableServiceWorker&&navigator.serviceWorker.register("service-worker.js")}catch(I){null!=window.console&&console.error(I)}!("ArrayBuffer"in window)||mxClient.IS_CHROMEAPP||EditorUi.isElectronApp||"auto"!=DrawioFile.SYNC||"1"==urlParams.embed&&"1"!=urlParams.embedRT||"1"==urlParams.local||"0"==
urlParams.chrome&&"1"!=urlParams.rt||"1"==urlParams.stealth||"1"==urlParams.offline||(mxscript(App.PUSHER_URL),"1"==urlParams["fast-sync"]&&mxscript(App.SIMPLE_PEER_URL));if("0"!=urlParams.plugins&&"1"!=urlParams.offline){t=null!=mxSettings.settings?mxSettings.getPlugins():null;if(null==mxSettings.settings&&isLocalStorage&&"undefined"!==typeof JSON)try{var B=JSON.parse(localStorage.getItem(mxSettings.key));null!=B&&(t=B.plugins)}catch(I){}B=urlParams.p;App.initPluginCallback();null!=B&&App.loadPlugins(B.split(";"));
if(null!=t&&0<t.length&&"0"!=urlParams.plugins)for(B=0;B<t.length;B++)try{("/"==t[B].charAt(0)&&(t[B]=PLUGINS_BASE_PATH+t[B]),App.isSameDomain(t[B]))?ALLOW_CUSTOM_PLUGINS||App.isBuiltInPlugin(t[B])?null==App.pluginsLoaded[t[B]]&&(App.pluginsLoaded[t[B]]=!0,App.embedModePluginsCount++,mxscript(t[B])):null!=window.console&&console.log("Unknown plugin:",t[B]):null!=window.console&&console.log("Blocked plugin:",t[B])}catch(I){}}"function"===typeof window.DriveClient&&"undefined"===typeof gapi&&("1"!=
urlParams.embed&&"0"!=urlParams.gapi||"1"==urlParams.embed&&"1"==urlParams.gapi)&&isSvgBrowser&&isLocalStorage&&(null==document.documentMode||10<=document.documentMode)?mxscript("https://apis.google.com/js/api.js?onload=DrawGapiClientCallback",null,null,null,mxClient.IS_SVG):"undefined"===typeof window.gapi&&(window.DriveClient=null)}"0"!=urlParams.math&&Editor.initMath();if("1"==urlParams.configure){var G=window.opener||window.parent,H=function(I){if(I.source==G)try{var D=JSON.parse(I.data);null!=
D&&"configure"==D.action&&(mxEvent.removeListener(window,"message",H),Editor.configure(D.config),mxSettings.load(),D.colorSchemeMeta&&mxmeta("color-scheme","dark light"),d())}catch(N){null!=window.console&&console.log("Error in configure message: "+N,I.data)}};mxEvent.addListener(window,"message",H);G.postMessage(JSON.stringify({event:"configure"}),"*")}else{if(null==Editor.config){if(null!=window.DRAWIO_CONFIG)try{EditorUi.debug("Using global configuration",window.DRAWIO_CONFIG),Editor.configure(window.DRAWIO_CONFIG),
mxSettings.load()}catch(I){null!=window.console&&console.error(I)}if(isLocalStorage&&null!=localStorage&&"1"!=urlParams.embed&&(B=localStorage.getItem(Editor.configurationKey),null!=B))try{B=JSON.parse(B),null!=B&&(EditorUi.debug("Using local configuration",B),Editor.configure(B),mxSettings.load())}catch(I){null!=window.console&&console.error(I)}}d()}}else document.body.innerHTML='<div style="margin-top:10%;text-align:center;">Stand-alone mode not allowed for this domain.</div>'};